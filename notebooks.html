
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>📊 Entrega del Trabajo Final &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notebooks with MyST Markdown" href="markdown-notebooks.html" />
    <link rel="prev" title="Markdown Files" href="markdown.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">📊 Entrega del Trabajo Final</a></li>






<li class="toctree-l1"><a class="reference internal" href="markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>📊 Entrega del Trabajo Final</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">📊 Entrega del Trabajo Final</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jefry-llerena-y-david-lizcano">Jefry Llerena y David Lizcano</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asignatura-series-de-tiempo">Asignatura: Series de Tiempo</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#maestria-en-analitica-de-datos">Maestría en Analítica de Datos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">Análisis y Predicción de las Series Temporales de las Ventas de Pizza</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas">Análisis y Modelización de Ventas Diarias de Pizzas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducción</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-del-proyecto">Estructura del Proyecto</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-datos-10">1. Análisis Exploratorio de Datos (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark-20">2. Modelos Benchmark (20%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposicion-10">3. Exposición (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original-60">4. Modelo Original (60%)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-los-datos">Analisis exploratorio de los datos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-normalidad-y-grafico-boxplot-para-el-eda">Grafico de normalidad y grafico Boxplot para el EDA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-acf"><strong>Análisis de ACF:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-pacf"><strong>Análisis de PACF:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-final"><strong>Conclusión Final:</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prueba-shapiro-wilk-diagnostico-de-curtosis-y-otras-pruebas-de-estacionaliad">Prueba Shapiro Wilk, diagnostico de curtosis y otras pruebas de estacionaliad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-suavizacion-diaria-semanal-de-los-datos-y-grafico-de-medias-y-desviaciones-de-la-serie">Grafico de suavizacion diaria, semanal de los datos y grafico de medias y desviaciones de la serie</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark">Modelos benchmark</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-sarima">Modelo Sarima</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-for-utilizado">Ciclo for utilizado</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-residuos-del-entrenamiento">Analisis de los residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-residuos-de-la-prediccion">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-suavizado-exponencial">Modelo de suavizado exponencial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-for-utilizado-para-optimizar-ses">Ciclo for utilizado para optimizar SES</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-de-entrenamiento">Analisis de residuos de entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-de-la-prediccion">Analisis de residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-holtwinters">Modelo Holtwinters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Ciclo for utilizado</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-del-entrenamiento">Analisis de residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Analisis de residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-red-neuronal-recuerrente">Modelo red neuronal recuerrente</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-for-utilizado-para-optimizar-hiperparametros">Ciclo for utilizado para optimizar hiperparametros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Analisis de los residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-mlp">Modelo MLP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-for-utilizado-para-optimizar-parametros">Ciclo for utilizado para optimizar parametros</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Analisis de los residuos de la prediccion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-lstm">Modelo LSTM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-residuos-del-entrenamiento">Analisis residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original">Modelo original</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enfoque-hibrido-holt-winters-con-una-red-neuronal-de-perceptron-multicapa-mlp">Enfoque híbrido Holt-Winters con una red neuronal de perceptrón multicapa (MLP)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Analisis de los residuos del entrenamiento</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eleccion-mejor-modelo">Eleccion mejor modelo</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="entrega-del-trabajo-final">
<h1>📊 Entrega del Trabajo Final<a class="headerlink" href="#entrega-del-trabajo-final" title="Link to this heading">#</a></h1>
<section id="jefry-llerena-y-david-lizcano">
<h2>Jefry Llerena y David Lizcano<a class="headerlink" href="#jefry-llerena-y-david-lizcano" title="Link to this heading">#</a></h2>
<section id="asignatura-series-de-tiempo">
<h3>Asignatura: Series de Tiempo<a class="headerlink" href="#asignatura-series-de-tiempo" title="Link to this heading">#</a></h3>
<section id="maestria-en-analitica-de-datos">
<h4>Maestría en Analítica de Datos<a class="headerlink" href="#maestria-en-analitica-de-datos" title="Link to this heading">#</a></h4>
</section>
</section>
</section>
<hr class="docutils" />
<section id="analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">
<h2>Análisis y Predicción de las Series Temporales de las Ventas de Pizza<a class="headerlink" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza" title="Link to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analisis-y-modelizacion-de-ventas-diarias-de-pizzas">
<h1>Análisis y Modelización de Ventas Diarias de Pizzas<a class="headerlink" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas" title="Link to this heading">#</a></h1>
<section id="introduccion">
<h2>Introducción<a class="headerlink" href="#introduccion" title="Link to this heading">#</a></h2>
<p>Este proyecto se centra en el análisis y modelización de una serie de tiempo que representa las ventas diarias de pizzas en un restaurante durante un año. El objetivo principal es aplicar diferentes técnicas de series de tiempo para predecir las ventas futuras y mejorar la precisión de las estimaciones, lo que permitirá optimizar la gestión operativa del restaurante.</p>
</section>
<section id="estructura-del-proyecto">
<h2>Estructura del Proyecto<a class="headerlink" href="#estructura-del-proyecto" title="Link to this heading">#</a></h2>
<p>El trabajo está estructurado en cuatro componentes clave:</p>
<section id="analisis-exploratorio-de-datos-10">
<h3>1. Análisis Exploratorio de Datos (10%)<a class="headerlink" href="#analisis-exploratorio-de-datos-10" title="Link to this heading">#</a></h3>
<p>Se realiza una exploración inicial de los datos para identificar patrones de comportamiento, tendencias y estacionalidades en las ventas. Esta fase orienta la selección de los modelos a utilizar.</p>
</section>
<section id="modelos-benchmark-20">
<h3>2. Modelos Benchmark (20%)<a class="headerlink" href="#modelos-benchmark-20" title="Link to this heading">#</a></h3>
<p>Se implementan modelos clásicos como:</p>
<ul class="simple">
<li><p><strong>Suavizado Exponencial (ES)</strong></p></li>
<li><p><strong>Holt-Winters</strong></p></li>
<li><p><strong>ARIMA</strong></p></li>
<li><p><strong>Redes Neuronales Artificiales (ANNs)</strong></p></li>
</ul>
<p>Estos modelos establecen una línea base de comparación.</p>
</section>
<section id="exposicion-10">
<h3>3. Exposición (10%)<a class="headerlink" href="#exposicion-10" title="Link to this heading">#</a></h3>
<p>Se presenta el proceso seguido y los resultados obtenidos en clase del sabado 27</p>
</section>
<section id="modelo-original-60">
<h3>4. Modelo Original (60%)<a class="headerlink" href="#modelo-original-60" title="Link to this heading">#</a></h3>
<p>El núcleo del proyecto radica en desarrollar un modelo propio que logre superar la precisión de los modelos benchmark, optimizando así las predicciones de ventas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">acf</span><span class="p">,</span> <span class="n">pacf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima_model</span> <span class="kn">import</span> <span class="n">ARIMA</span> <span class="k">as</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.tsa.api</span> <span class="k">as</span> <span class="nn">smt</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analisis-exploratorio-de-los-datos">
<h1>Analisis exploratorio de los datos<a class="headerlink" href="#analisis-exploratorio-de-los-datos" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como índice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="c1"># Eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Verificar cuántas observaciones hay en la serie diaria</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Número de observaciones: </span><span class="si">{</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Ajustar el periodo según el número de observaciones</span>
<span class="n">periodo</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">24</span> <span class="k">else</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usando periodo: </span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Usar descomposición aditiva</span>
<span class="n">dec</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;additive&#39;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periodo</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Número de observaciones: 358
Usando periodo: 12
</pre></div>
</div>
<img alt="_images/3912b732d171934dbebc46c5a0446c18d6bd03f937c2c41a079cd13ae0b40bcb.png" src="_images/3912b732d171934dbebc46c5a0446c18d6bd03f937c2c41a079cd13ae0b40bcb.png" />
</div>
</div>
<p>Serie original (total_quantity): Aquí se reflejan las fluctuaciones diarias de las ventas de pizzas en el restaurante durante dos años. Se notan variaciones importantes y picos, que probablemente corresponden a días de alta demanda como fines de semana o eventos especiales.</p>
<p>Tendencia (Trend): La tendencia muestra que las ventas han tenido periodos de crecimiento y decrecimiento. Aunque hay un incremento durante ciertos meses, se ve una caída hacia el final del periodo, lo que podría estar relacionado con una disminución estacional en la demanda o algún factor externo.</p>
<p>Componente estacional (Seasonal): El componente estacional sugiere que las ventas tienen un comportamiento cíclico muy claro. Esto podría estar vinculado a los patrones de consumo regulares, como los fines de semana o feriados, donde se repiten picos de ventas en ciertos días de la semana o en épocas del año.</p>
<p>Residuos (Resid): Los residuos representan las variaciones no explicadas por la tendencia y la estacionalidad. Aunque la mayoría de los puntos están cercanos a cero, hay algunos residuos más grandes que podrían indicar eventos excepcionales o factores fuera de lo habitual que afectaron las ventas, como promociones o cambios inesperados en la demanda.</p>
<p>En conjunto, esta descomposición sugiere que las ventas de pizzas siguen un patrón estacional fuerte, con una tendencia que ha experimentado cambios a lo largo del tiempo y unos residuos que parecen estar mayormente distribuidos de manera aleatoria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Función para realizar la prueba de Dickey-Fuller y graficar la media móvil y desviación estándar</span>
<span class="k">def</span> <span class="nf">test_stationarity</span><span class="p">(</span><span class="n">timeseries</span><span class="p">):</span>
    <span class="c1"># Calcular la media móvil y la desviación estándar móvil</span>
    <span class="n">MA</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Ajusta la ventana si es necesario</span>
    <span class="n">MSTD</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>  <span class="c1"># Ajusta la ventana si es necesario</span>

    <span class="c1"># Graficar los valores originales, la media móvil y la desviación estándar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rolling Mean&#39;</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MSTD</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rolling Std&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Rolling Mean &amp; Standard Deviation&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Realizar la prueba de Dickey-Fuller</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results of Dickey-Fuller Test:&#39;</span><span class="p">)</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">timeseries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">dfoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Test Statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;#Lags Used&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of Observations Used&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dfoutput</span><span class="p">[</span><span class="s1">&#39;Critical Value (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dfoutput</span><span class="p">)</span>

<span class="c1"># Aplicar la prueba de Dickey-Fuller y graficar los estadísticos móviles</span>
<span class="n">test_stationarity</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0a7ed9d08eeb601e136cb84d295a8793fbd92140540bf8e39e8672551aa5c4ee.png" src="_images/0a7ed9d08eeb601e136cb84d295a8793fbd92140540bf8e39e8672551aa5c4ee.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results of Dickey-Fuller Test:
Test Statistic                  -5.220180
p-value                          0.000008
#Lags Used                      15.000000
Number of Observations Used    342.000000
Critical Value (1%)             -3.449616
Critical Value (5%)             -2.870028
Critical Value (10%)            -2.571292
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Con esto, parece que hay suficiente evidencia para rechazar la hipótesis nula de que la serie temporal tiene una raíz unitaria, lo que sugiere que la serie es estacionaria. El estadístico de prueba es mucho menor que los valores críticos, y el p-valor es muy bajo, así que estoy bastante seguro de que puedo considerar la serie como estacionaria. Esto es un buen indicio para los siguientes pasos en el análisis.</p>
<section id="grafico-de-normalidad-y-grafico-boxplot-para-el-eda">
<h2>Grafico de normalidad y grafico Boxplot para el EDA<a class="headerlink" href="#grafico-de-normalidad-y-grafico-boxplot-para-el-eda" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como índice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="c1"># Eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Crear columna de trimestre</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>

<span class="c1"># Gráfico de boxplot por trimestre</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_grouped_quantity_daily</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot de las ventas diarias de pizzas por trimestre&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Trimestre&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Gráfico de distribución</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribución de las ventas diarias de pizzas&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frecuencia&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b100a000ddcdc5fd6984161ede1c75cf58cdbabd08ad2810af53816a0f24eb31.png" src="_images/b100a000ddcdc5fd6984161ede1c75cf58cdbabd08ad2810af53816a0f24eb31.png" />
<img alt="_images/c72bb8645799e13854b3f7253f43104f3f031a2e7476cfa96eaa1916e3cdd7e6.png" src="_images/c72bb8645799e13854b3f7253f43104f3f031a2e7476cfa96eaa1916e3cdd7e6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.tsa.api</span> <span class="k">as</span> <span class="nn">smt</span>
<span class="c1"># Función para graficar la serie de tiempo y las funciones ACF y PACF</span>
<span class="k">def</span> <span class="nf">tsplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;bmh&#39;</span><span class="p">):</span>
    <span class="c1"># Convertir a Series si no lo es ya</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Eliminar valores nulos en la serie</span>
    <span class="n">y_clean</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1"># Verificar que la serie no esté vacía después de eliminar nulos</span>
    <span class="k">if</span> <span class="n">y_clean</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de tiempo está vacía después de eliminar valores nulos.&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el número máximo de lags permitido</span>
    <span class="n">max_lags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_clean</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">lags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">max_lags</span><span class="p">)</span> <span class="k">if</span> <span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_lags</span>

    <span class="c1"># Aplicar estilo y generar los gráficos</span>
    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">style</span><span class="p">):</span>    
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ts_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">acf_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">pacf_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Graficar la serie de tiempo</span>
        <span class="n">y_clean</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ts_ax</span><span class="p">)</span>
        
        <span class="c1"># Prueba de Dickey-Fuller</span>
        <span class="n">p_value</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">stattools</span><span class="o">.</span><span class="n">adfuller</span><span class="p">(</span><span class="n">y_clean</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ts_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time Series Analysis Plots</span><span class="se">\n</span><span class="s1"> Dickey-Fuller: p=</span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
        
        <span class="c1"># Graficar ACF y PACF</span>
        <span class="n">smt</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">y_clean</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">acf_ax</span><span class="p">)</span>
        <span class="n">smt</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">y_clean</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">pacf_ax</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1"># Leer el archivo Excel y preparar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN y rellenar valores faltantes con interpolación</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Verificar cuántas observaciones hay en la serie diaria</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Número de observaciones: </span><span class="si">{</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Ajustar el periodo según el número de observaciones</span>
<span class="n">periodo</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">24</span> <span class="k">else</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usando periodo: </span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Graficar la serie de tiempo, ACF y PACF, ajustando los lags al tamaño de la muestra</span>
<span class="n">tsplot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_7936\159718561.py:55: FutureWarning: Series.interpolate with object dtype is deprecated and will raise in a future version. Call obj.infer_objects(copy=False) before interpolating instead.
  df_grouped_quantity_daily[&#39;total_quantity&#39;] = df_grouped_quantity_daily[&#39;total_quantity&#39;].interpolate(method=&#39;linear&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Número de observaciones: 365
Usando periodo: 12
</pre></div>
</div>
<img alt="_images/c031967a46f16629303ae1d73abd9dcff3a7b23ac56e6d23cfadffce2ca1adf5.png" src="_images/c031967a46f16629303ae1d73abd9dcff3a7b23ac56e6d23cfadffce2ca1adf5.png" />
</div>
</div>
<p>Con los resultados de la prueba <strong>Dickey-Fuller</strong>, que confirman que la serie es estacionaria, el análisis de las gráficas de <strong>ACF</strong> y <strong>PACF</strong> se puede ajustar de la siguiente manera:</p>
<section id="analisis-de-acf">
<h3><strong>Análisis de ACF:</strong><a class="headerlink" href="#analisis-de-acf" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>La ACF muestra un comportamiento de rápida caída, con las autocorrelaciones dentro de las bandas de significancia, salvo por algunos rezagos que parecen apenas cruzar la línea. Considerando que los datos ya son estacionarios y que los <strong>rezagos menores que cruzan la banda de significancia probablemente no sean significativos</strong> (como lo sugieren las fluctuaciones), esto podría indicar que no hay una dependencia fuerte entre los rezagos.</p></li>
<li><p>Dado que la prueba <strong>Dickey-Fuller</strong> confirmó la estacionariedad, estas pequeñas autocorrelaciones son más bien fluctuaciones aleatorias y no un patrón estructurado. En otras palabras, no hay evidencia de autocorrelaciones importantes más allá del primer rezago (que descartamos por tu preferencia de no considerarlo).</p></li>
</ul>
</section>
<section id="analisis-de-pacf">
<h3><strong>Análisis de PACF:</strong><a class="headerlink" href="#analisis-de-pacf" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>En la PACF, después de descartar el primer rezago, observamos que los rezagos posteriores caen rápidamente y no muestran un patrón significativo. Esto refuerza la idea de que un modelo <strong>AR(1)</strong> podría ser suficiente para capturar las dependencias presentes en los datos.</p></li>
<li><p>El hecho de que los rezagos en la PACF no muestren valores significativos sugiere que no es necesario incluir términos autoregresivos adicionales. La prueba <strong>Dickey-Fuller</strong> apoya esta conclusión, ya que no hay evidencia de una raíz unitaria que pudiera requerir un modelo más complejo.</p></li>
</ul>
</section>
<section id="conclusion-final">
<h3><strong>Conclusión Final:</strong><a class="headerlink" href="#conclusion-final" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>La serie es estacionaria, como lo confirma el test de <strong>Dickey-Fuller</strong>. Las pequeñas autocorrelaciones observadas en los gráficos de ACF y PACF probablemente no sean significativas, lo que sugiere que no hay dependencia estructurada en los rezagos más allá de lo que puede ser capturado por un modelo <strong>AR(1)</strong>.</p></li>
<li><p>Si bien las fluctuaciones en las autocorrelaciones podrían indicar algún componente estacional, este no parece ser muy fuerte. Sin embargo, si se sospecha de estacionalidad, un modelo <strong>SARIMA</strong> podría explorarse para capturar este comportamiento, pero de momento un <strong>ARIMA(1, d, 0)</strong> podría ser adecuado.</p></li>
</ul>
<p>Este análisis refuerza la idea de que los rezagos no son significativos y que el modelo que mejor se ajusta a estos datos es uno simple, como <strong>AR(1)</strong>.</p>
</section>
</section>
<hr class="docutils" />
<section id="prueba-shapiro-wilk-diagnostico-de-curtosis-y-otras-pruebas-de-estacionaliad">
<h2>Prueba Shapiro Wilk, diagnostico de curtosis y otras pruebas de estacionaliad<a class="headerlink" href="#prueba-shapiro-wilk-diagnostico-de-curtosis-y-otras-pruebas-de-estacionaliad" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">shapiro</span><span class="p">,</span> <span class="n">kurtosis</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">kpss</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como índice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="c1"># Eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Asegurar que los datos sean numéricos para el cálculo de la curtosis</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>  <span class="c1"># eliminar filas que aún puedan tener NaN</span>

<span class="c1"># Prueba de Shapiro-Wilk para normalidad</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">shapiro</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shapiro-Wilk Test: Estadístico=</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie parece seguir una distribución normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie no sigue una distribución normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># Diagnóstico de curtosis</span>
<span class="n">curtosis_value</span> <span class="o">=</span> <span class="n">kurtosis</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Curtosis: </span><span class="si">{</span><span class="n">curtosis_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">curtosis_value</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie tiene curtosis leptocúrtica (picos altos)&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">curtosis_value</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie tiene curtosis platicúrtica (picos bajos)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie tiene curtosis mesocúrtica (similar a una normal)&quot;</span><span class="p">)</span>

<span class="c1"># Prueba de estacionalidad con ADF</span>
<span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prueba ADF:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-valor: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie es estacionaria&quot;</span> <span class="k">if</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;La serie no es estacionaria&quot;</span><span class="p">)</span>

<span class="c1"># Prueba de estacionalidad con KPSS</span>
<span class="n">kpss_result</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">regression</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prueba KPSS:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-valor: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie no es estacionaria&quot;</span> <span class="k">if</span> <span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;La serie es estacionaria&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shapiro-Wilk Test: Estadístico=0.9159911711264263, p-valor=2.9971844033110664e-13
La serie no sigue una distribución normal (p &lt;= 0.05)
Curtosis: 5.558763683087122
La serie tiene curtosis leptocúrtica (picos altos)

Prueba ADF:
Estadístico: -5.22018024974895
p-valor: 7.995231865646734e-06
La serie es estacionaria

Prueba KPSS:
Estadístico: 0.04324218553214804
p-valor: 0.1
La serie es estacionaria
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_7936\3527988587.py:58: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpss_result = kpss(df_grouped_quantity_daily[&#39;total_quantity&#39;], regression=&#39;c&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="grafico-de-suavizacion-diaria-semanal-de-los-datos-y-grafico-de-medias-y-desviaciones-de-la-serie">
<h2>Grafico de suavizacion diaria, semanal de los datos y grafico de medias y desviaciones de la serie<a class="headerlink" href="#grafico-de-suavizacion-diaria-semanal-de-los-datos-y-grafico-de-medias-y-desviaciones-de-la-serie" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como índice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN y eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Suavización diaria y semanal (medias móviles)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;SMA_1D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Suavización diaria</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;SMA_7D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Suavización semanal</span>

<span class="c1"># Gráfico de la serie de tiempo con suavización diaria y semanal</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;SMA_1D&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Suavización Diaria&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;SMA_7D&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Suavización Semanal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Serie de tiempo con suavización diaria y semanal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Cálculo de la media móvil y desviación estándar móvil semanal</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Mean_7D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Std_7D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="c1"># Gráfico de medias y desviaciones estándar semanales</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Mean_7D&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Media Móvil Semanal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
    <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Mean_7D&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Std_7D&#39;</span><span class="p">],</span>
    <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Mean_7D&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Std_7D&#39;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Desviación Estándar&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Medias móviles semanales con bandas de desviación estándar&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d1de94ae5a7dc37e504ff54a79079156d8c416d01417dd4519cff35abb2f1889.png" src="_images/d1de94ae5a7dc37e504ff54a79079156d8c416d01417dd4519cff35abb2f1889.png" />
<img alt="_images/707c2a99a43da759f53281b14279e44e54f717c3891da51dcfbe0fef98172719.png" src="_images/707c2a99a43da759f53281b14279e44e54f717c3891da51dcfbe0fef98172719.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelos-benchmark">
<h1>Modelos benchmark<a class="headerlink" href="#modelos-benchmark" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<section id="modelo-sarima">
<h2>Modelo Sarima<a class="headerlink" href="#modelo-sarima" title="Link to this heading">#</a></h2>
<section id="ciclo-for-utilizado">
<h3>Ciclo for utilizado<a class="headerlink" href="#ciclo-for-utilizado" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Código de optimización:</p></li>
</ul>
<small>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.statespace.sarimax</span> <span class="kn">import</span> <span class="n">SARIMAX</span>

<span class="c1"># Leer el archivo Excel y preparar la serie temporal</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>

<span class="c1"># Dividir los datos en entrenamiento y prueba</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[:</span><span class="o">-</span><span class="mi">55</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span>

<span class="c1"># Definir los posibles valores de los parámetros SARIMA</span>
<span class="n">p_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
<span class="n">d_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
<span class="n">q_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
<span class="n">P_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
<span class="n">D_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
<span class="n">Q_values</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span> <span class="p">]</span>
<span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">30</span> <span class="p">]</span>  

<span class="c1"># Inicializar variables para almacenar los mejores resultados</span>
<span class="n">best_aic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_order</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_seasonal_order</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Ciclo para optimizar los parámetros SARIMA</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_values</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">d_values</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_values</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="n">P_values</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">D</span> <span class="ow">in</span> <span class="n">D_values</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">Q</span> <span class="ow">in</span> <span class="n">Q_values</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="c1"># Configurar y ajustar el modelo SARIMA</span>
                            <span class="n">model</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">],</span> 
                                            <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> 
                                            <span class="n">seasonal_order</span><span class="o">=</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">S</span><span class="p">))</span>
                            <span class="n">results</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                            
                            <span class="c1"># Evaluar el AIC y almacenar si es el mejor encontrado</span>
                            <span class="k">if</span> <span class="n">results</span><span class="o">.</span><span class="n">aic</span> <span class="o">&lt;</span> <span class="n">best_aic</span><span class="p">:</span>
                                <span class="n">best_aic</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">aic</span>
                                <span class="n">best_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                                <span class="n">best_seasonal_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">S</span><span class="p">)</span>
                                <span class="n">best_model</span> <span class="o">=</span> <span class="n">results</span>
                                
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al ajustar el modelo SARIMA(</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s2">) x (</span><span class="si">{</span><span class="n">P</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">D</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">Q</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">S</span><span class="si">}</span><span class="s2">): </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                            <span class="k">continue</span>

<span class="c1"># Mostrar los mejores parámetros encontrados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor AIC: </span><span class="si">{</span><span class="n">best_aic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor orden: </span><span class="si">{</span><span class="n">best_order</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor orden estacional: </span><span class="si">{</span><span class="n">best_seasonal_order</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.statespace.sarimax</span> <span class="kn">import</span> <span class="n">SARIMAX</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como índice</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Rellenar valores faltantes (opcional)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Asegúrate de que la serie de tiempo no tenga valores nulos</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Transformación logarítmica de los datos para estabilizar la varianza</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>


<span class="c1"># Dividir los datos: Conjunto de entrenamiento y prueba (últimos 55 días)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[:</span><span class="o">-</span><span class="mi">55</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span>

<span class="c1"># Ajustar el modelo SARIMA con los parámetros dados al conjunto de entrenamiento</span>
<span class="n">sarima_model</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">],</span> 
                       <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> 
                       <span class="n">seasonal_order</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">sarima_result</span> <span class="o">=</span> <span class="n">sarima_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Hacer predicciones para los próximos 14 días (conjunto de prueba)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">get_forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>
<span class="n">pred_conf</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span>

<span class="c1"># Convertir las predicciones logarítmicas de vuelta a escala original</span>
<span class="n">predicted_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">predicted_mean</span><span class="p">)</span>

<span class="c1"># Graficar los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Graficar los datos originales (solo hasta la última fecha del conjunto de entrenamiento)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de Entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Graficar los datos reales del conjunto de prueba</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos Reales (Conjunto de Prueba)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Graficar las predicciones</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># Agregar la zona de confianza</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pred_conf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pred_conf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Configurar el gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicciones SARIMAX vs Datos Reales - Ventas Diarias de Pizza (Conjunto de Prueba: 2 Semanas)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Quantity (Escala Original)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Mostrar el gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># AIC y BIC del modelo SARIMA</span>
<span class="n">aic</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">aic</span>
<span class="n">bic</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">bic</span>

<span class="c1"># Calcular las métricas de error (MAE, RMSE)</span>
<span class="c1"># Para esto necesitamos comparar las predicciones con los valores reales (en escala original)</span>
<span class="c1"># Convertir los datos reales de test a escala original</span>
<span class="n">test_data_original_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">])</span>

<span class="c1"># MAE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">)</span>

<span class="c1"># RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">))</span>



<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Supongamos que ya tienes un dataframe llamado df con las columnas &#39;order_date&#39; y &#39;quantity&#39;</span>
<span class="c1"># Agrupar por fecha y sumar la cantidad diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span>

<span class="c1"># Convertir la columna total_quantity en una serie</span>
<span class="n">total_quantity</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span>

<span class="c1"># Obtener los últimos 55 valores de total_quantity</span>
<span class="n">y_observado</span> <span class="o">=</span> <span class="n">total_quantity</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Asegúrate de convertir a array</span>
<span class="n">y_predicho</span> <span class="o">=</span> <span class="n">predicted_means</span>                   <span class="c1"># Valores predichos</span>

<span class="c1"># Verifica que ambas series tengan la misma longitud</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_observado</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_predicho</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La longitud de y_observado y y_predicho debe ser la misma.&quot;</span><span class="p">)</span>

<span class="c1"># Calcular la media de los valores observados</span>
<span class="n">media_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_observado</span><span class="p">)</span>

<span class="c1"># Calcular SS_tot (Suma total de cuadrados)</span>
<span class="n">SS_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_observado</span> <span class="o">-</span> <span class="n">media_y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Calcular SS_res (Suma de cuadrados de los residuos)</span>
<span class="n">SS_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_observado</span> <span class="o">-</span> <span class="n">y_predicho</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Calcular R^2</span>
<span class="n">R_squared</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">SS_res</span> <span class="o">/</span> <span class="n">SS_tot</span><span class="p">)</span>


<span class="c1"># Calcular MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">test_data_original_scale</span> <span class="o">-</span> <span class="n">predicted_means</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_data_original_scale</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Calcular MSE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">)</span>

<span class="c1"># Imprimir los resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC: </span><span class="si">{</span><span class="n">aic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC: </span><span class="si">{</span><span class="n">bic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE: </span><span class="si">{</span><span class="n">mape</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:966: UserWarning: Non-stationary starting autoregressive parameters found. Using zeros as starting parameters.
  warn(&#39;Non-stationary starting autoregressive parameters&#39;
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:978: UserWarning: Non-invertible starting MA parameters found. Using zeros as starting parameters.
  warn(&#39;Non-invertible starting MA parameters found.&#39;
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:997: UserWarning: Non-stationary starting seasonal autoregressive Using zeros as starting parameters.
  warn(&#39;Non-stationary starting seasonal autoregressive&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\base\model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn(&quot;Maximum Likelihood optimization failed to &quot;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:837: ValueWarning: No supported index is available. Prediction results will be given with an integer index beginning at `start`.
  return get_prediction_index(
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:837: FutureWarning: No supported index is available. In the next version, calling this method in a model without a supported index will result in an exception.
  return get_prediction_index(
</pre></div>
</div>
<img alt="_images/d6097943ed60bf0168317b943647c18fc4ff4ec53e256edcc0a3e7f2a9278d01.png" src="_images/d6097943ed60bf0168317b943647c18fc4ff4ec53e256edcc0a3e7f2a9278d01.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC: -268.8597669914309
BIC: -224.29497332531847
MAE: 21.078274466230365
RMSE: 31.85499764381842
MSE: 1014.7408748876773
MAPE: nan%
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_7936\3235105369.py:128: RuntimeWarning: &#39;&lt;&#39; not supported between instances of &#39;int&#39; and &#39;Timestamp&#39;, sort order is undefined for incomparable objects.
  mape = np.mean(np.abs((test_data_original_scale - predicted_means) / test_data_original_scale)) * 100
</pre></div>
</div>
</div>
</div>
<p>El modelo utilizado para predecir las ventas diarias de pizza es un <strong>SARIMAX</strong> con un orden de ( (1, 0, 3) ) y un orden estacional de ( (3, 0, 4, 7) ). Se aplicó una transformación logarítmica para estabilizar la varianza y se dividieron los datos en un conjunto de entrenamiento y otro de prueba.</p>
<p>Los resultados del modelo son positivos: el AIC es de -268.86 y el BIC de -224.29, lo que indica un buen ajuste y parsimonia. Las métricas de error muestran un MAE de 21.08 y un RMSE de 31.85, lo que sugiere que las predicciones son razonablemente precisas. El MSE es de 1014.74, proporcionando otra medida del error cuadrático medio, aunque el MAPE es indeterminado (nan%). En general, el modelo captura bien la estacionalidad y tendencia en los datos, aunque aún hay espacio para mejorar la explicación de la variabilidad en las ventas.</p>
</section>
<section id="analisis-de-los-residuos-del-entrenamiento">
<h3>Analisis de los residuos del entrenamiento<a class="headerlink" href="#analisis-de-los-residuos-del-entrenamiento" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>  <span class="c1"># Asegúrate de importar seaborn</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>  <span class="c1"># Importar stats de scipy para Jarque-Bera</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Suponiendo que ya tienes el modelo SARIMA ajustado y los residuos</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">resid</span>

<span class="c1"># 1. Gráfico de caja de los residuos por trimestres</span>
<span class="n">df_residuos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residuos&#39;</span><span class="p">])</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># Agregar una columna para identificar el trimestre</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Caja de los Residuos por Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Prueba de Jarque-Bera usando scipy</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test: Estadístico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribución normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribución normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Gráficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gráfico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación (ACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="c1"># Gráfico de PACF</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación Parcial (PACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8b3a59200109dddaa8521a624376379f224e0ea629f0ce3d742747c4db621cff.png" src="_images/8b3a59200109dddaa8521a624376379f224e0ea629f0ce3d742747c4db621cff.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test: Estadístico=35532.06236446829, p-valor=0.0
Los residuos no siguen una distribución normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/165b3e75088aa86508bef83c8f402ce14e8c8fe7dc645a57157417a1a38cfb44.png" src="_images/165b3e75088aa86508bef83c8f402ce14e8c8fe7dc645a57157417a1a38cfb44.png" />
</div>
</div>
<p>Al analizar los residuos del modelo SARIMAX, se observa que el boxplot dividido en los cuatro trimestres muestra colas largas, lo que indica una concentración de residuos cercanos a cero, pero con algunos valores atípicos que se extienden hacia abajo. Esto sugiere que, aunque la mayoría de las predicciones son razonablemente precisas, hay ciertas instancias en las que el modelo subestima las ventas de manera significativa, lo que puede estar afectando la variabilidad en las predicciones.Además, la presencia de estos valores atípicos puede ser un indicativo de heterocedasticidad, donde la varianza de los residuos no es constante a lo largo del tiempo.</p>
<p>En cuanto al análisis de autocorrelación, el ACF de los residuos revela algunos lags que se encuentran fuera de la banda de significancia, lo que sugiere que hay patrones de autocorrelación que no han sido completamente modelados. Esto puede indicar que el modelo necesita ajustes adicionales, quizás considerando un orden mayor en los términos autoregresivos o incorporando variables exógenas que puedan ayudar a explicar mejor la variabilidad observada.</p>
<p>Por otro lado, el PACF muestra aún menos lags significativos, lo que podría sugerir que, aunque la parte autoregresiva del modelo se ha ajustado relativamente bien, aún quedan ciertos patrones en los residuos que requieren atención. La combinación de las colas largas en el boxplot y la autocorrelación en los residuos sugiere que, si bien el modelo captura adecuadamente la tendencia y estacionalidad, hay aspectos de la variabilidad en las ventas que aún no se han abordado adecuadamente. Esto abre la puerta a la exploración de alternativas, como ajustar el modelo o considerar nuevos términos para mejorar la precisión predictiva y la capacidad de explicación del modelo.</p>
</section>
<section id="analisis-de-los-residuos-de-la-prediccion">
<h3>Analisis de los residuos de la prediccion<a class="headerlink" href="#analisis-de-los-residuos-de-la-prediccion" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular los residuos del conjunto de prueba</span>
<span class="n">test_data_original_scale</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Valores reales en escala original</span>
<span class="n">residuos_test</span> <span class="o">=</span> <span class="n">test_data_original_scale</span> <span class="o">-</span> <span class="n">predicted_means</span>  <span class="c1"># Residuos</span>

<span class="c1"># Prueba de normalidad (Jarque-Bera)</span>
<span class="n">jb_test_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test de normalidad (Jarque-Bera):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico: </span><span class="si">{</span><span class="n">jb_test_stat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-valor: </span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Prueba de independencia (Ljung-Box)</span>
<span class="n">lb_test_result</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Hasta el lag 10</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test de independencia (Ljung-Box):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lb_test_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test de normalidad (Jarque-Bera):
Estadístico: 51.72877249261495
p-valor: 5.851130378203007e-12
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">12</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-valor: </span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1"># Prueba de independencia (Ljung-Box)</span>
<span class="ne">---&gt; </span><span class="mi">12</span> <span class="n">lb_test_result</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Hasta el lag 10</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test de independencia (Ljung-Box):&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="nb">print</span><span class="p">(</span><span class="n">lb_test_result</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;acorr_ljungbox&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Test de Normalidad (Jarque-Bera)
El estadístico de Jarque-Bera es 44.48 con un p-valor de 2.19e-10, lo que indica un rechazo contundente de la hipótesis nula de normalidad. Esto sugiere que los residuos no siguen una distribución normal, lo que podría indicar patrones no capturados o la influencia de outliers, afectando la validez de las inferencias del modelo.</p>
<p>Test de Independencia (Ljung-Box)
Los resultados del test de Ljung-Box muestran un estadístico de 9.27 y un p-valor de 0.507, lo que sugiere que no hay evidencia de autocorrelación en los residuos hasta el lag considerado. Esto es positivo, ya que indica que el modelo ha capturado adecuadamente las correlaciones en los datos.</p>
</section>
</section>
<section id="modelo-de-suavizado-exponencial">
<h2>Modelo de suavizado exponencial<a class="headerlink" href="#modelo-de-suavizado-exponencial" title="Link to this heading">#</a></h2>
<section id="ciclo-for-utilizado-para-optimizar-ses">
<h3>Ciclo for utilizado para optimizar SES<a class="headerlink" href="#ciclo-for-utilizado-para-optimizar-ses" title="Link to this heading">#</a></h3>
<small>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="c1"># Leer el archivo y preparar la serie temporal</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Función de suavizado exponencial</span>
<span class="k">def</span> <span class="nf">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ytilde</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">ytilde</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">ytilde</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Datos y partición de entrenamiento/prueba</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Inicializar mejor RMSE y lambda</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_lambda</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Ciclo para optimizar lambda</span>
<span class="k">for</span> <span class="n">lambda_</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">):</span>
    <span class="c1"># Suavizado exponencial en el conjunto de entrenamiento</span>
    <span class="n">y_smooth_train</span> <span class="o">=</span> <span class="n">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="n">lambda_</span><span class="p">)</span>
    <span class="c1"># Predicciones para el conjunto de prueba</span>
    <span class="n">y_pred_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span> <span class="n">y_smooth_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># Calcular RMSE</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred_test</span><span class="p">))</span>
    
    <span class="c1"># Actualizar el mejor lambda si el RMSE es menor</span>
    <span class="k">if</span> <span class="n">rmse</span> <span class="o">&lt;</span> <span class="n">best_rmse</span><span class="p">:</span>
        <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>
        <span class="n">best_lambda</span> <span class="o">=</span> <span class="n">lambda_</span>

<span class="c1"># Resultados de optimización</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor valor de lambda: </span><span class="si">{</span><span class="n">best_lambda</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor RMSE obtenido: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como índice</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Rellenar valores faltantes (opcional)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Definir la función de suavizado exponencial</span>
<span class="k">def</span> <span class="nf">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ytilde</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">ytilde</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">ytilde</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Aplicar el suavizado exponencial a los datos de ventas de pizza</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mf">0.13</span>

<span class="c1"># Calcular el índice de división (85% para entrenar, 15% para predecir)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento y prueba</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Suavizado sobre el conjunto de entrenamiento</span>
<span class="n">pizza_smooth1_train</span> <span class="o">=</span> <span class="n">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="n">lambda_</span><span class="p">)</span>

<span class="c1"># Hacer predicciones para el último 15% (suavizado exponencial simple)</span>
<span class="n">pizza_smooth1_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span> <span class="n">pizza_smooth1_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Calcular el RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Calcular el MAE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Calcular el AIC y BIC</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>  <span class="c1"># Número de observaciones de prueba</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># Número de parámetros (lambda y nivel inicial)</span>
<span class="n">aic_ses</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span>
<span class="n">bic_ses</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>



<span class="c1"># Graficar los datos de entrenamiento, prueba y las predicciones</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ventas de Pizza (Entrenamiento)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">pizza_smooth1_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SES $\lambda=</span><span class="si">{</span><span class="n">lambda_</span><span class="si">}</span><span class="s1">$ (Entrenamiento)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="c1"># Mostrar el comportamiento real del último 15%</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">train_size</span><span class="p">:],</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ventas de Pizza (Real - Último 15%)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Mostrar las predicciones del último 15%</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">train_size</span><span class="p">:],</span> <span class="n">pizza_smooth1_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicción SES (Último 15%)&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cantidad de Ventas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="c1"># Calcular el MSE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE</span>
<span class="c1"># Asegúrate de manejar divisiones por cero en el cálculo</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_test</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Imprimir las métricas</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE del modelo SES: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE del modelo SES: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE del modelo SES: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE del modelo SES: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Calcular el R² entre los valores reales (y_test) y las predicciones (pizza_smooth1_test)</span>
<span class="n">r_squared</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Imprimir el R²</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R² del modelo SES: </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8dae767b719eaf282e9351a007824f5fccf1800f1f3e30273d4ed11b7ddbe2fe.png" src="_images/8dae767b719eaf282e9351a007824f5fccf1800f1f3e30273d4ed11b7ddbe2fe.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE del modelo SES: 22.037037037037038
RMSE del modelo SES: 33.605555096342826
MSE del modelo SES: 1129.3333333333333
MAPE del modelo SES: 16.59%
R² del modelo SES: -0.0000
</pre></div>
</div>
</div>
</div>
<p>En este análisis, se utilizó un modelo de suavizado exponencial simple (SES) para predecir las ventas diarias de pizza. Los datos se cargaron desde un archivo Excel y se agruparon por fecha, manejando los valores faltantes mediante interpolación. Se aplicó el suavizado exponencial con un parámetro (\lambda = 0.13).</p>
<p>Los datos se dividieron en un conjunto de entrenamiento (85%) y otro de prueba (15%). Las métricas de error del modelo fueron:</p>
<ul class="simple">
<li><p><strong>MAE</strong>: 22.04, indicando que las predicciones se desvían, en promedio, en 22 ventas.</p></li>
<li><p><strong>RMSE</strong>: 33.61, sugiriendo que los errores son más significativos que lo indicado por el MAE.</p></li>
<li><p><strong>MSE</strong>: 1129.33, reflejando una alta variabilidad en las predicciones.</p></li>
<li><p><strong>MAPE</strong>: 16.59%, mostrando que las predicciones se desvían un 16.59% de los valores reales.</p></li>
<li><p><strong>R²</strong>: -0.0000, indicando que el modelo no explica la variabilidad en los datos.</p></li>
</ul>
<p>Las predicciones se visualizaron junto con las ventas reales, lo que mostró cómo se ajustan a los datos. Aunque el SES ofrece un enfoque básico, sus métricas sugieren que se podrían explorar modelos más complejos para mejorar la precisión en las predicciones.</p>
</section>
<section id="analisis-de-residuos-de-entrenamiento">
<h3>Analisis de residuos de entrenamiento<a class="headerlink" href="#analisis-de-residuos-de-entrenamiento" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>  <span class="c1"># Asegúrate de importar seaborn</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Suponiendo que ya tienes los residuos calculados</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">resid</span>

<span class="c1"># 1. Gráfico de caja de los residuos por trimestres</span>
<span class="n">df_residuos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residuos&#39;</span><span class="p">])</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)]</span>  <span class="c1"># Asegúrate de que las fechas coincidan</span>

<span class="c1"># Agregar una columna para identificar el trimestre</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Caja de los Residuos por Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Prueba de Jarque-Bera</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test: Estadístico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribución normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribución normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Gráficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gráfico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Cambia 30 por 10 (o menos si es necesario)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación (ACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="c1"># Gráfico de PACF</span>
<span class="n">max_lags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># Asegúrate de que lags es menor que la mitad de la longitud de residuos</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Cambia 30 por max_lags</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación Parcial (PACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4bb80fd3803a78e97dbd34ba1d4bc2b14cde3d4dbbc4bc891929167f38301fa1.png" src="_images/4bb80fd3803a78e97dbd34ba1d4bc2b14cde3d4dbbc4bc891929167f38301fa1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test: Estadístico=49258.92963963724, p-valor=0.0
Los residuos no siguen una distribución normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/8e5e540f6ce512696b991d030bbf0d0879882091f23cb3f9bd9165c3a51bad2f.png" src="_images/8e5e540f6ce512696b991d030bbf0d0879882091f23cb3f9bd9165c3a51bad2f.png" />
</div>
</div>
<p>En el boxplot de los residuos, si el gráfico es simétrico y no hay outliers, eso sugiere que los residuos están bien centrados. Sin embargo, si hay puntos fuera de los bigotes, esto podría indicar que el modelo no está capturando toda la variabilidad. Además, si la mediana está descentrada o la caja es asimétrica, podría haber un sesgo en el modelo.</p>
<p>En el gráfico de ACF, si veo picos significativos en los primeros lags, eso indicaría que el modelo no ha capturado todas las dependencias. Lo ideal sería que el ACF se asemeje a un ruido blanco, donde la mayoría de los valores estén cerca de cero. Una caída gradual o picos en lags distantes pueden señalar dependencias a largo plazo no capturadas.</p>
<p>Por otro lado, en el gráfico de PACF, en un buen modelo, los valores deberían caer rápidamente a cero tras los primeros lags. Si hay picos significativos en lags posteriores, esto sugiere que hay información que el modelo no está capturando, lo que podría ser un problema de especificación.</p>
</section>
<section id="analisis-de-residuos-de-la-prediccion">
<h3>Analisis de residuos de la prediccion<a class="headerlink" href="#analisis-de-residuos-de-la-prediccion" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular los residuos para entrenamiento y prueba</span>
<span class="n">residuos_train</span> <span class="o">=</span> <span class="n">y_train</span> <span class="o">-</span> <span class="n">pizza_smooth1_train</span>
<span class="n">residuos_test</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">pizza_smooth1_test</span>

<span class="c1"># Prueba de normalidad (Jarque-Bera) para residuos de prueba</span>
<span class="n">jb_test_stat</span><span class="p">,</span> <span class="n">jb_p_value_test</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test de normalidad (Jarque-Bera) para residuos de prueba:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico: </span><span class="si">{</span><span class="n">jb_test_stat</span><span class="si">}</span><span class="s2">, p-valor: </span><span class="si">{</span><span class="n">jb_p_value_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Prueba de independencia (Ljung-Box) para residuos de prueba</span>
<span class="n">lb_test_result_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test de independencia (Ljung-Box) para residuos de prueba:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lb_test_result_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test de normalidad (Jarque-Bera) para residuos de prueba:
Estadístico: 97.74901587508569, p-valor: 5.943891825597542e-22

Test de independencia (Ljung-Box) para residuos de prueba:
      lb_stat  lb_pvalue
10  12.461416   0.255361
</pre></div>
</div>
</div>
</div>
<p>A partir de los resultados sobre los residuos de la predicción, podemos hacer algunas inferencias clave sobre su normalidad e independencia. En el Test de normalidad de Jarque-Bera, el estadístico es 97.75 y el p-valor es 5.94e-22. Esto indica que los residuos no siguen una distribución normal, ya que el p-valor es extremadamente bajo, lo que sugiere que el modelo no captura completamente la estructura de los datos y que hay asimetría o curtosis elevada.</p>
<p>Por otro lado, en el Test de independencia de Ljung-Box, el estadístico es 12.46 para 10 lags y el p-valor es 0.255. Esto indica que no hay autocorrelación significativa en los residuos, lo que es positivo, ya que sugiere que el modelo ha capturado bien la estructura temporal de los datos</p>
</section>
</section>
<section id="modelo-holtwinters">
<h2>Modelo Holtwinters<a class="headerlink" href="#modelo-holtwinters" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>Ciclo for utilizado<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<small>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="c1"># Leer el archivo y preparar la serie temporal</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_ventas</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span>

<span class="c1"># Dividir en conjunto de entrenamiento y prueba</span>
<span class="n">test_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_grouped</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[:</span><span class="o">-</span><span class="n">test_size</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="o">-</span><span class="n">test_size</span><span class="p">:]</span>

<span class="c1"># Inicializar mejor RMSE y combinación de parámetros</span>
<span class="n">best_rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Valores posibles para parámetros estacionales y de tendencia</span>
<span class="n">seasonal_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;mul&#39;</span><span class="p">]</span>
<span class="n">trend_options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="s1">&#39;mul&#39;</span><span class="p">]</span>
<span class="n">seasonal_periods</span> <span class="o">=</span> <span class="mi">7</span>  <span class="c1"># Período estacional de 7 días (semanal)</span>

<span class="c1"># Ciclo para optimizar los parámetros</span>
<span class="k">for</span> <span class="n">seasonal</span> <span class="ow">in</span> <span class="n">seasonal_options</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">trend</span> <span class="ow">in</span> <span class="n">trend_options</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Ajustar modelo Holt-Winters con la combinación actual de parámetros</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span>
                                         <span class="n">seasonal</span><span class="o">=</span><span class="n">seasonal</span><span class="p">,</span>
                                         <span class="n">seasonal_periods</span><span class="o">=</span><span class="n">seasonal_periods</span><span class="p">,</span>
                                         <span class="n">trend</span><span class="o">=</span><span class="n">trend</span><span class="p">)</span>
            <span class="n">hw_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
            <span class="c1"># Predecir y calcular RMSE</span>
            <span class="n">forecast</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>
            <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">))</span>

            <span class="c1"># Guardar si es el mejor RMSE encontrado</span>
            <span class="k">if</span> <span class="n">rmse</span> <span class="o">&lt;</span> <span class="n">best_rmse</span><span class="p">:</span>
                <span class="n">best_rmse</span> <span class="o">=</span> <span class="n">rmse</span>
                <span class="n">best_params</span> <span class="o">=</span> <span class="p">(</span><span class="n">seasonal</span><span class="p">,</span> <span class="n">trend</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error en combinación </span><span class="si">{</span><span class="n">seasonal</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">trend</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">continue</span>

<span class="c1"># Resultados de optimización</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor RMSE: </span><span class="si">{</span><span class="n">best_rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor combinación de parámetros (Estacional, Tendencia): </span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha, permitiendo que pandas infiera el formato</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad de ventas diarias (Quantity)</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_ventas</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Ordenar por fecha en caso de que no esté ordenado</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span>

<span class="c1"># Definir el tamaño del conjunto de prueba (último 15%)</span>
<span class="n">test_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_grouped</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento (85%) y prueba (15%)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[:</span><span class="o">-</span><span class="n">test_size</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="o">-</span><span class="n">test_size</span><span class="p">:]</span>

<span class="c1"># Ajustar el modelo Holt-Winters con los parámetros especificados</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> 
                             <span class="n">seasonal</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span>  <span class="c1"># Estacionalidad aditiva</span>
                             <span class="n">seasonal_periods</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="c1"># Período estacional de 7 días (semanal)</span>
                             <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;mul&#39;</span><span class="p">)</span>  <span class="c1"># Tendencia multiplicativa</span>
<span class="n">hw_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Calcular el AIC y BIC del modelo Holt-Winters</span>
<span class="n">aic</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">aic</span>
<span class="n">bic</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">bic</span>

<span class="c1"># Realizar predicción para el tamaño del conjunto de prueba</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>

<span class="c1"># Calcular MAE y RMSE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">))</span>

<span class="c1"># Calcular el R² entre los valores reales y las predicciones</span>
<span class="n">r_squared</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>



<span class="c1"># Graficar los datos originales, el conjunto de prueba y la predicción</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Datos de entrenamiento</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Conjunto de prueba</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Conjunto de prueba real&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Predicción</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicción Holt-Winters&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Etiquetas y título</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predicción de Ventas usando Holt-Winters con conjunto de prueba&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total de Ventas&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Rotar etiquetas del eje X</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Mostrar el gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calcular MSE y MAPE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">forecast</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># MAPE en porcentaje</span>

<span class="c1"># Imprimir las métricas calculadas</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC del modelo Holt-Winters: </span><span class="si">{</span><span class="n">aic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC del modelo Holt-Winters: </span><span class="si">{</span><span class="n">bic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>  <span class="c1"># Formato en porcentaje</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R² del modelo Holt-Winters: </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\holtwinters\model.py:84: RuntimeWarning: overflow encountered in matmul
  return err.T @ err
</pre></div>
</div>
<img alt="_images/9ed320a11622a0476ca7e71c58e48760815c1ab8aa4d1d3f0321b621b3caea06.png" src="_images/9ed320a11622a0476ca7e71c58e48760815c1ab8aa4d1d3f0321b621b3caea06.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC del modelo Holt-Winters: 1843.572415497852
BIC del modelo Holt-Winters: 1884.4958450405336
MAE del modelo Holt-Winters: 20.854868339222346
RMSE del modelo Holt-Winters: 31.777808583971765
MSE del modelo Holt-Winters: 1009.8291183995495
MAPE del modelo Holt-Winters: 16.20%
R² del modelo Holt-Winters: 0.1170
</pre></div>
</div>
</div>
</div>
<p>El modelo Holt-Winters se ha implementado para pronosticar las ventas de pizza utilizando datos diarios, permitiendo capturar tanto la tendencia como la estacionalidad. Los resultados del modelo indican un <strong>AIC</strong> de 1843.68 y un <strong>BIC</strong> de 1884.60, lo que sugiere un ajuste razonable a los datos, aunque valores más bajos son preferibles para la comparación con otros modelos. En cuanto a los errores de predicción, el <strong>MAE</strong> es de 20.63, lo que indica que, en promedio, las predicciones del modelo se desvían de las ventas reales en aproximadamente 20.63 unidades, sugiriendo un error moderado. El <strong>RMSE</strong> es de 31.62, lo que refleja que las desviaciones de las predicciones son significativas, aunque no extremas. Además, el <strong>MSE</strong> es de 999.56, señalando un error considerable en las predicciones.</p>
<p>Respecto a la precisión del modelo, el <strong>MAPE</strong> es del 15.96%, lo que indica un error promedio de aproximadamente 15.96% en las predicciones, un nivel que podría considerarse aceptable en algunas aplicaciones, pero que podría ser mejorado. Por último, el <strong>R²</strong> es de 0.1259, lo que sugiere que el modelo explica solo alrededor del 12.59% de la variabilidad total de las ventas. Esto implica que hay otros factores o variaciones en los datos que el modelo no está capturando adecuadamente. En conclusión, aunque el modelo Holt-Winters ha proporcionado un ajuste moderado a los datos de ventas de pizza, los errores de predicción sugieren que se puede mejorar, y el bajo valor de R² indica que no está capturando bien la variabilidad en los datos, lo que podría llevar a explorar otros enfoques de modelado o la inclusión de variables adicionales para mejorar el pronóstico.</p>
</section>
<section id="analisis-de-residuos-del-entrenamiento">
<h3>Analisis de residuos del entrenamiento<a class="headerlink" href="#analisis-de-residuos-del-entrenamiento" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">fittedvalues</span>

<span class="c1"># 1. Gráfico de caja de los residuos por trimestres</span>
<span class="n">df_residuos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residuos&#39;</span><span class="p">])</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span>  <span class="c1"># Asegúrate de que las fechas coincidan</span>

<span class="c1"># Agregar una columna para identificar el trimestre</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Caja de los Residuos por Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Prueba de Jarque-Bera</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test: Estadístico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribución normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribución normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Gráficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gráfico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Cambia 30 por 10 (o menos si es necesario)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación (ACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="c1"># Gráfico de PACF</span>
<span class="n">max_lags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># Asegúrate de que lags es menor que la mitad de la longitud de residuos</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Cambia 30 por max_lags</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación Parcial (PACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/65db526d6b18010dd11c80f9b95132c1f416a11ed9127031d10d62d2832acd6a.png" src="_images/65db526d6b18010dd11c80f9b95132c1f416a11ed9127031d10d62d2832acd6a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test: Estadístico=1377.9616452064433, p-valor=6.017701013834668e-300
Los residuos no siguen una distribución normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/f2c54217c4d02247011518dce01489fce2320c809797db645343400a850b81a1.png" src="_images/f2c54217c4d02247011518dce01489fce2320c809797db645343400a850b81a1.png" />
</div>
</div>
<p>En el análisis de los residuos del modelo Holt-Winters, el <strong>boxplot trimestral</strong> muestra que los residuos en los tres primeros trimestres son más estables y cercanos a cero, pero en el último trimestre presentan mayor dispersión, lo que sugiere que el modelo pierde algo de precisión en ese periodo. A pesar de esto, la <strong>ACF y PACF</strong> de los residuos muestran que no hay autocorrelaciones significativas en los rezagos, lo que indica que los residuos se comportan como ruido blanco y no hay patrones de dependencia temporal no explicados por el modelo.</p>
<p>En resumen, el modelo captura bien la estructura temporal de los datos, pero es posible que enfrente dificultades en el último trimestre. Esto podría deberse a una mayor variabilidad o a cambios en los datos que el modelo no capta completamente, por lo que sería recomendable ajustar parámetros o explorar posibles outliers en ese periodo para mejorar el ajuste.</p>
</section>
<section id="id2">
<h3>Analisis de residuos de la prediccion<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular los residuos de las predicciones</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">forecast</span>

<span class="c1"># Realizar la prueba de Ljung-Box</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>
<span class="n">ljung_box_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prueba de Ljung-Box:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ljung_box_test</span><span class="p">)</span>

<span class="c1"># Realizar la prueba de Jarque-Bera</span>
<span class="n">jarque_bera_test</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prueba de Jarque-Bera:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico: </span><span class="si">{</span><span class="n">jarque_bera_test</span><span class="o">.</span><span class="n">statistic</span><span class="si">}</span><span class="s2">, p-valor: </span><span class="si">{</span><span class="n">jarque_bera_test</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prueba de Ljung-Box:
     lb_stat  lb_pvalue
10  9.901357    0.44919

Prueba de Jarque-Bera:
Estadístico: 76.57160269867782, p-valor: 2.3587816401526902e-17
</pre></div>
</div>
</div>
</div>
<p>Los resultados de la prueba de <strong>Ljung-Box</strong> (p-valor: 0.255) indican que no existe autocorrelación significativa en los residuos para los primeros 10 rezagos, lo que sugiere que el modelo captura bien la dependencia temporal. Por otro lado, la prueba de <strong>Jarque-Bera</strong> (estadístico: 97.75, p-valor: 5.94e-22) revela que los residuos no siguen una distribución normal, lo cual podría ser una señal de problemas con la suposición de normalidad en el modelo, lo que puede afectar las estimaciones de error y la interpretación de los intervalos de confianza.</p>
</section>
</section>
<section id="modelo-red-neuronal-recuerrente">
<h2>Modelo red neuronal recuerrente<a class="headerlink" href="#modelo-red-neuronal-recuerrente" title="Link to this heading">#</a></h2>
<section id="ciclo-for-utilizado-para-optimizar-hiperparametros">
<h3>Ciclo for utilizado para optimizar hiperparametros<a class="headerlink" href="#ciclo-for-utilizado-para-optimizar-hiperparametros" title="Link to this heading">#</a></h3>
<small>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Definir los valores de hiperparámetros a probar</span>
<span class="n">hidden_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>  <span class="c1"># Puedes añadir más valores si deseas</span>
<span class="n">learning_rates</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Ciclo para la optimización de hiperparámetros</span>
<span class="k">for</span> <span class="n">hidden_size</span> <span class="ow">in</span> <span class="n">hidden_sizes</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">learning_rate</span> <span class="ow">in</span> <span class="n">learning_rates</span><span class="p">:</span>
        <span class="c1"># Inicializar la red RNN con los hiperparámetros actuales</span>
        <span class="n">rnn</span> <span class="o">=</span> <span class="n">RNN_BPTT</span><span class="p">(</span><span class="n">input_size</span><span class="o">=</span><span class="n">look_back</span><span class="p">,</span> <span class="n">hidden_size</span><span class="o">=</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

        <span class="c1"># Entrenar el modelo</span>
        <span class="n">rnn</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

        <span class="c1"># Realizar predicciones en el conjunto de prueba</span>
        <span class="n">predictions_test</span> <span class="o">=</span> <span class="n">rnn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">predictions_test_descaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions_test</span><span class="p">)</span>

        <span class="c1"># Calcular el R^2 en el conjunto de prueba</span>
        <span class="n">y_test_true</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>
        <span class="n">r2_test</span> <span class="o">=</span> <span class="n">calculate_r_squared</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">predictions_test_descaled</span><span class="p">)</span>

        <span class="c1"># Guardar el mejor modelo y sus hiperparámetros</span>
        <span class="k">if</span> <span class="n">r2_test</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
            <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2_test</span>
            <span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;hidden_size&#39;</span><span class="p">:</span> <span class="n">hidden_size</span><span class="p">,</span>
                <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="n">learning_rate</span>
            <span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejores hiperparámetros: </span><span class="si">{</span><span class="n">best_params</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mejor R^2: </span><span class="si">{</span><span class="n">best_r2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="c1"># Leer el archivo y procesar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Convertimos la serie de tiempo a un array</span>
<span class="n">time_series</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Normalizar los datos para que estén en un rango adecuado</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">time_series_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">time_series</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Crear el dataset para la RNN con look_back = 28</span>
<span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">look_back</span><span class="o">=</span><span class="mi">28</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">-</span> <span class="n">look_back</span><span class="p">):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">look_back</span> <span class="o">=</span> <span class="mi">28</span>  <span class="c1"># Ajuste de parámetro</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">time_series_scaled</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>

<span class="c1"># Reshape para el formato adecuado</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Dividir el conjunto de datos en entrenamiento y prueba (85% entrenamiento, 15% prueba)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Definir la red RNN y entrenarla con hidden_size = 20 y learning_rate = 0.005</span>
<span class="k">def</span> <span class="nf">relu</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">relu_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">RNN_BPTT</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">truncation</span> <span class="o">=</span> <span class="n">truncation</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">relu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span>

    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">dU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">)</span>
        <span class="n">dW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="n">dV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="n">dh_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>  <span class="c1"># Derivada de la pérdida (MSE)</span>
            <span class="n">dV</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">dy</span><span class="p">)</span>
            <span class="n">dc</span> <span class="o">+=</span> <span class="n">dy</span>
            <span class="n">dh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">dh_next</span>
            <span class="n">dh_raw</span> <span class="o">=</span> <span class="n">dh</span> <span class="o">*</span> <span class="n">relu_derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="n">dU</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">dh_raw</span><span class="p">)</span>
            <span class="n">dW</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dh_raw</span><span class="p">)</span>
            <span class="n">db</span> <span class="o">+=</span> <span class="n">dh_raw</span>
            <span class="n">dh_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dh_raw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        
        <span class="c1"># Clipping de gradientes para evitar explosión</span>
        <span class="k">for</span> <span class="n">dparam</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dU</span><span class="p">,</span> <span class="n">dW</span><span class="p">,</span> <span class="n">dV</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">dc</span><span class="p">]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dparam</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">dparam</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dc</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">output</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Inicializar la red con los parámetros indicados</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="n">look_back</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Ajuste de parámetro</span>
<span class="n">output_size</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.005</span>  <span class="c1"># Ajuste de parámetro</span>
<span class="n">rnn</span> <span class="o">=</span> <span class="n">RNN_BPTT</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span>
<span class="n">rnn</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Hacer predicciones en el conjunto de entrenamiento y prueba</span>
<span class="n">predictions_train</span> <span class="o">=</span> <span class="n">rnn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">predictions_test</span> <span class="o">=</span> <span class="n">rnn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Desnormalizar las predicciones para obtener los valores originales</span>
<span class="n">predictions_train_descaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)</span>
<span class="n">predictions_test_descaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions_test</span><span class="p">)</span>

<span class="c1"># Graficar las predicciones y la serie original</span>
<span class="k">def</span> <span class="nf">plot_predictions</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">predictions_train</span><span class="p">,</span> <span class="n">predictions_test</span><span class="p">,</span> <span class="n">look_back</span><span class="p">):</span>
    <span class="n">predictions_train</span> <span class="o">=</span> <span class="n">predictions_train</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">predictions_test</span> <span class="o">=</span> <span class="n">predictions_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Crear una serie de tiempo para las predicciones alineada con la serie original</span>
    <span class="n">prediction_train_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
    <span class="n">prediction_train_shifted</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># Inicializar con NaN para dejar huecos</span>
    <span class="n">prediction_train_shifted</span><span class="p">[</span><span class="n">look_back</span><span class="p">:</span><span class="n">look_back</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)]</span> <span class="o">=</span> <span class="n">predictions_train</span>  <span class="c1"># Desplazar predicciones del conjunto de entrenamiento</span>

    <span class="n">prediction_test_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
    <span class="n">prediction_test_shifted</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># Inicializar con NaN para dejar huecos</span>
    <span class="n">prediction_test_shifted</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">:]</span> <span class="o">=</span> <span class="n">predictions_test</span>  <span class="c1"># Desplazar predicciones del conjunto de prueba</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Serie de tiempo original&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction_train_shifted</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicciones - Entrenamiento&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction_test_shifted</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicciones - Prueba&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparación de la serie de tiempo y las predicciones (Entrenamiento vs Prueba)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Graficar las predicciones</span>
<span class="n">plot_predictions</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">predictions_train_descaled</span><span class="p">,</span> <span class="n">predictions_test_descaled</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Calcular el R^2</span>
<span class="k">def</span> <span class="nf">calculate_r_squared</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el MSE</span>
<span class="k">def</span> <span class="nf">calculate_mse</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el RMSE</span>
<span class="k">def</span> <span class="nf">calculate_rmse</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

<span class="c1"># Calcular el AIC</span>
<span class="k">def</span> <span class="nf">calculate_aic</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">aic</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num_params</span>
    <span class="k">return</span> <span class="n">aic</span>

<span class="c1"># Calcular el BIC</span>
<span class="k">def</span> <span class="nf">calculate_bic</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">bic</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_params</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bic</span>

<span class="c1"># Predicciones desnormalizadas (usadas para evaluar en la escala original)</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">predictions_train_descaled</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">predictions_test_descaled</span>

<span class="c1"># Valores reales (sin escalar, para compararlos correctamente con las predicciones desnormalizadas)</span>
<span class="n">y_train_true</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_test_true</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>

<span class="c1"># Número de parámetros del modelo RNN: U, W, V, b, c</span>
<span class="n">num_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Calcular métricas para el conjunto de entrenamiento</span>
<span class="n">r2_train</span> <span class="o">=</span> <span class="n">calculate_r_squared</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">mse_train</span> <span class="o">=</span> <span class="n">calculate_mse</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">rmse_train</span> <span class="o">=</span> <span class="n">calculate_rmse</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">aic_train</span> <span class="o">=</span> <span class="n">calculate_aic</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>
<span class="n">bic_train</span> <span class="o">=</span> <span class="n">calculate_bic</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>

<span class="c1"># Calcular métricas para el conjunto de prueba</span>
<span class="n">r2_test</span> <span class="o">=</span> <span class="n">calculate_r_squared</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">mse_test</span> <span class="o">=</span> <span class="n">calculate_mse</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">rmse_test</span> <span class="o">=</span> <span class="n">calculate_rmse</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">aic_test</span> <span class="o">=</span> <span class="n">calculate_aic</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>
<span class="n">bic_test</span> <span class="o">=</span> <span class="n">calculate_bic</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>



<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Unir las predicciones y los valores reales de entrenamiento y prueba</span>
<span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">predictions_train_descaled</span><span class="p">,</span> <span class="n">predictions_test_descaled</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_true_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Calcular el R^2 para el conjunto total</span>
<span class="n">r2_total</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true_total</span><span class="p">,</span> <span class="n">y_pred_total</span><span class="p">)</span>

<span class="c1"># Mostrar el R^2 total</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R^2 total: </span><span class="si">{</span><span class="n">r2_total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

<span class="c1"># Calcular el MAE</span>
<span class="k">def</span> <span class="nf">calculate_mae</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE</span>
<span class="k">def</span> <span class="nf">calculate_mape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_true</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># MAPE como porcentaje</span>

<span class="c1"># Calcular métricas para el conjunto de entrenamiento</span>
<span class="n">mae_train</span> <span class="o">=</span> <span class="n">calculate_mae</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">mape_train</span> <span class="o">=</span> <span class="n">calculate_mape</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>

<span class="c1"># Calcular métricas para el conjunto de prueba</span>
<span class="n">mae_test</span> <span class="o">=</span> <span class="n">calculate_mae</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">mape_test</span> <span class="o">=</span> <span class="n">calculate_mape</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>




<span class="c1"># Mostrar las métricas totales</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Métricas totales:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R^2 total: </span><span class="si">{</span><span class="n">r2_total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 0, Loss: 0.12202312165158294
Epoch 100, Loss: 0.01359642777387532
Epoch 200, Loss: 0.012344530068833386
Epoch 300, Loss: 0.01168961727572708
Epoch 400, Loss: 0.011329617519078239
Epoch 500, Loss: 0.011023879851695553
Epoch 600, Loss: 0.0108390412612204
Epoch 700, Loss: 0.010675242353569248
Epoch 800, Loss: 0.01053721156905347
Epoch 900, Loss: 0.010399682247022752
</pre></div>
</div>
<img alt="_images/fb9f0ae4694f96a4113acccbd4665052653a69e49f15ae2d95d444e848623485.png" src="_images/fb9f0ae4694f96a4113acccbd4665052653a69e49f15ae2d95d444e848623485.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R^2 total: 0.22530504636153814

Métricas totales:
R^2 total: 0.22530504636153814
RMSE: 33.20006150535171
MAE: 22.819214393339777
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h3>Analisis de los residuos del entrenamiento<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>La evaluación de la red neuronal recurrente (RNN) reveló un coeficiente de determinación (R²) de 0.2179, lo que significa que el modelo es capaz de explicar aproximadamente el 21.79% de la variabilidad observada en las ventas de pizza. Esto indica que, aunque la RNN logra capturar alguna relación entre los datos, una gran parte de la variabilidad, que corresponde al 78.21%, sigue sin ser explicada, lo que puede sugerir la influencia de factores externos o patrones no identificados en los datos.</p>
<p>Además, se calcularon métricas adicionales que complementan la evaluación del rendimiento del modelo. El error cuadrático medio (RMSE) fue de 33.65, lo que refleja la magnitud promedio de los errores en las predicciones. Este valor sugiere que las predicciones de ventas de pizza pueden desviarse significativamente de los valores reales. Por otro lado, el error absoluto medio (MAE) fue de 23.60, indicando que, en promedio, el modelo se desvió de las ventas reales por esta cantidad.</p>
<p>En conjunto, estas métricas proporcionan una visión general del rendimiento de la RNN, sugiriendo que, aunque el modelo tiene alguna capacidad predictiva, también enfrenta limitaciones significativas en su precisión y en la explicación de la variabilidad de las ventas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">residuos_train</span> <span class="o">=</span> <span class="n">y_train_true</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Residuos del conjunto de entrenamiento</span>
<span class="n">residuos_test</span> <span class="o">=</span> <span class="n">y_test_true</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>      <span class="c1"># Residuos del conjunto de prueba</span>

<span class="c1"># 1. Gráfico de caja de los residuos por trimestres</span>
<span class="c1"># Asegúrate de que el índice de los datos de entrenamiento tenga las fechas correctas</span>
<span class="n">df_residuos_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;residuos&#39;</span><span class="p">:</span> <span class="n">residuos_train</span><span class="p">,</span> <span class="s1">&#39;fecha&#39;</span><span class="p">:</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">look_back</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">]})</span>
<span class="n">df_residuos_train</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos_train</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos_train</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Caja de los Residuos por Trimestres - Entrenamiento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Prueba de Jarque-Bera</span>
<span class="n">jb_stat_train</span><span class="p">,</span> <span class="n">jb_p_value_train</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test (Entrenamiento): Estadístico=</span><span class="si">{</span><span class="n">jb_stat_train</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value_train</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value_train</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos de entrenamiento parecen seguir una distribución normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos de entrenamiento no siguen una distribución normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Gráficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gráfico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Cambia 10 por el número de lags que prefieras</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación (ACF) de los Residuos - Entrenamiento&#39;</span><span class="p">)</span>

<span class="c1"># Gráfico de PACF</span>
<span class="n">max_lags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Cambia max_lags si es necesario</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación Parcial (PACF) de los Residuos - Entrenamiento&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/df267a2a07848d2c3399c1e3fbcafe9d29db9bca5d513fb0887bdf56649ae0b0.png" src="_images/df267a2a07848d2c3399c1e3fbcafe9d29db9bca5d513fb0887bdf56649ae0b0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test (Entrenamiento): Estadístico=646.5299119443438, p-valor=4.0533436779340375e-141
Los residuos de entrenamiento no siguen una distribución normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/83679544c4edc87d07ac335c1c0e6a810d52d4246fb0e7b9f0ceccde1044c019.png" src="_images/83679544c4edc87d07ac335c1c0e6a810d52d4246fb0e7b9f0ceccde1044c019.png" />
</div>
</div>
</section>
<section id="id4">
<h3>Analisis de los residuos de la prediccion<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">residuos_train</span> <span class="o">=</span> <span class="n">y_train_true</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Residuos del conjunto de entrenamiento</span>



<span class="c1"># 2. Prueba de Jarque-Bera</span>
<span class="n">jb_stat_train</span><span class="p">,</span> <span class="n">jb_p_value_train</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test (Entrenamiento): Estadístico=</span><span class="si">{</span><span class="n">jb_stat_train</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value_train</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value_train</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos de entrenamiento parecen seguir una distribución normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos de entrenamiento no siguen una distribución normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Prueba de Ljung-Box</span>
<span class="n">ljung_box_results</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Cambia 10 por el número de lags que prefieras</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ljung_box_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test (Entrenamiento): Estadístico=618.5676618715746, p-valor=4.7834240494947976e-135
Los residuos de entrenamiento no siguen una distribución normal (p &lt;= 0.05)
     lb_stat  lb_pvalue
10  2.330921   0.993117
</pre></div>
</div>
</div>
</div>
<p>Los resultados de la prueba de Jarque-Bera muestran un estadístico de 618.57 y un p-valor de 4.78e-135, lo que indica que los residuos de entrenamiento no siguen una distribución normal (p &lt;= 0.05). Esto sugiere que el modelo no ha capturado adecuadamente la dinámica de los datos, por lo que podría ser necesario ajustar el modelo o considerar variables adicionales. Por otro lado, la prueba de Ljung-Box presenta un estadístico de 2.33 y un p-valor de 0.9931, lo que indica que no hay autocorrelación significativa en los residuos hasta el rezago especificado. Esto es positivo, ya que sugiere que los errores de predicción son aleatorios. En resumen, aunque el modelo muestra alguna capacidad predictiva, hay espacio para mejorar su precisión y capturar mejor la dinámica de los datos.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-mlp">
<h1>Modelo MLP<a class="headerlink" href="#modelo-mlp" title="Link to this heading">#</a></h1>
<section id="ciclo-for-utilizado-para-optimizar-parametros">
<h2>Ciclo for utilizado para optimizar parametros<a class="headerlink" href="#ciclo-for-utilizado-para-optimizar-parametros" title="Link to this heading">#</a></h2>
<small>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="c1"># Definir hiperparámetros posibles</span>
<span class="n">units_1_options</span> <span class="o">=</span> <span class="p">[</span><span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
<span class="n">units_2_options</span> <span class="o">=</span> <span class="p">[</span><span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">96</span><span class="p">]</span>
<span class="n">units_3_options</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">48</span><span class="p">]</span>
<span class="n">dropout_options</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">batch_size_options</span> <span class="o">=</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>
<span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">best_r2</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span>
<span class="n">best_params</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># Loop de optimización de hiperparámetros</span>
<span class="k">for</span> <span class="n">units_1</span> <span class="ow">in</span> <span class="n">units_1_options</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">units_2</span> <span class="ow">in</span> <span class="n">units_2_options</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">units_3</span> <span class="ow">in</span> <span class="n">units_3_options</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dropout_rate</span> <span class="ow">in</span> <span class="n">dropout_options</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">batch_size</span> <span class="ow">in</span> <span class="n">batch_size_options</span><span class="p">:</span>
                    <span class="n">input_layer</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,))</span>
                    <span class="n">dense1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units_1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">input_layer</span><span class="p">)</span>
                    <span class="n">dense2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units_2</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">dense1</span><span class="p">)</span>
                    <span class="n">dense3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="n">units_3</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">dense2</span><span class="p">)</span>
                    <span class="n">dropout_layer</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_rate</span><span class="p">)(</span><span class="n">dense3</span><span class="p">)</span>
                    <span class="n">output_layer</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">dropout_layer</span><span class="p">)</span>
                    
                    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_layer</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">)</span>
                    <span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>
                    
                    <span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    
                    <span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> 
                                        <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>
                    
                    <span class="c1"># Evaluar en conjunto de validación</span>
                    <span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
                    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">)</span>
                    
                    <span class="c1"># Actualizar si se obtiene mejor R²</span>
                    <span class="k">if</span> <span class="n">r2</span> <span class="o">&gt;</span> <span class="n">best_r2</span><span class="p">:</span>
                        <span class="n">best_r2</span> <span class="o">=</span> <span class="n">r2</span>
                        <span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s1">&#39;units_1&#39;</span><span class="p">:</span> <span class="n">units_1</span><span class="p">,</span>
                            <span class="s1">&#39;units_2&#39;</span><span class="p">:</span> <span class="n">units_2</span><span class="p">,</span>
                            <span class="s1">&#39;units_3&#39;</span><span class="p">:</span> <span class="n">units_3</span><span class="p">,</span>
                            <span class="s1">&#39;dropout&#39;</span><span class="p">:</span> <span class="n">dropout_rate</span><span class="p">,</span>
                            <span class="s1">&#39;batch_size&#39;</span><span class="p">:</span> <span class="n">batch_size</span>
                        <span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mejores parámetros:&quot;</span><span class="p">,</span> <span class="n">best_params</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mejor R-cuadrado:&quot;</span><span class="p">,</span> <span class="n">best_r2</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como índice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria y eliminar los valores nulos</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN y luego eliminar filas con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Escalar los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Asegurarse de eliminar posibles NaN en las series</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Dividir en conjuntos de entrenamiento y validación (85% entrenamiento, 15% validación)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">df_val</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Crear las ventanas de tiempo (7 días)</span>
<span class="k">def</span> <span class="nf">makeXy</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">nb_timesteps</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_timesteps</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">nb_timesteps</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>

<span class="c1"># Definir el modelo MLP con los mejores hiperparámetros</span>
<span class="n">input_layer</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,))</span>
<span class="n">dense1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">input_layer</span><span class="p">)</span>  <span class="c1"># units_1 = 256</span>
<span class="n">dense2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">dense1</span><span class="p">)</span>        <span class="c1"># units_2 = 96</span>
<span class="n">dense3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">dense2</span><span class="p">)</span>        <span class="c1"># units_3 = 48</span>
<span class="n">dropout_layer</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)(</span><span class="n">dense3</span><span class="p">)</span>                 <span class="c1"># dropout = 0.3</span>
<span class="n">output_layer</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">dropout_layer</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_layer</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="c1"># Implementar Early Stopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrenar el modelo</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

<span class="c1"># Predecir los valores en el conjunto de entrenamiento y validación</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">pred_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_train</span><span class="p">)</span>

<span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">pred_val_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_val</span><span class="p">)</span>

<span class="c1"># Concatenar las predicciones y los valores reales (entrenamiento + validación)</span>
<span class="n">pred_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pred_train_quantity</span><span class="p">,</span> <span class="n">pred_val_quantity</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">real_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>



<span class="c1"># Graficar resultados (entrenamiento + validación)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Graficar el conjunto de entrenamiento</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Entrenamiento Real&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">pred_train_quantity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Entrenamiento Predicho&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># Graficar el conjunto de validación</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_val</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validación Real&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_val</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">pred_val_quantity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validación Predicho&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ventas Reales vs Predichas (Entrenamiento y Validación)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ventas de Pizzas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calcular MAE y RMSE para todo el conjunto</span>
<span class="n">mae_total</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">real_total</span><span class="p">,</span> <span class="n">pred_total</span><span class="p">)</span>
<span class="n">rmse_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">real_total</span><span class="p">,</span> <span class="n">pred_total</span><span class="p">))</span>

<span class="c1"># Calcular MAPE</span>
<span class="n">mape_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">real_total</span> <span class="o">-</span> <span class="n">pred_total</span><span class="p">)</span> <span class="o">/</span> <span class="n">real_total</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>



<span class="n">r2_val</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">pred_val_quantity</span><span class="p">)</span>

<span class="c1"># Imprimir los resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAE total: </span><span class="si">{</span><span class="n">mae_total</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RMSE total: </span><span class="si">{</span><span class="n">rmse_total</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAPE total: </span><span class="si">{</span><span class="n">mape_total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R-cuadrado (validación): </span><span class="si">{</span><span class="n">r2_val</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/100
19/19 - 2s - 129ms/step - loss: 0.0377 - val_loss: 0.0373
Epoch 2/100
19/19 - 0s - 19ms/step - loss: 0.0203 - val_loss: 0.0347
Epoch 3/100
19/19 - 0s - 9ms/step - loss: 0.0185 - val_loss: 0.0327
Epoch 4/100
19/19 - 0s - 7ms/step - loss: 0.0170 - val_loss: 0.0325
Epoch 5/100
19/19 - 0s - 8ms/step - loss: 0.0154 - val_loss: 0.0336
Epoch 6/100
19/19 - 0s - 9ms/step - loss: 0.0146 - val_loss: 0.0326
Epoch 7/100
19/19 - 0s - 7ms/step - loss: 0.0150 - val_loss: 0.0312
Epoch 8/100
19/19 - 0s - 9ms/step - loss: 0.0152 - val_loss: 0.0309
Epoch 9/100
19/19 - 0s - 10ms/step - loss: 0.0158 - val_loss: 0.0314
Epoch 10/100
19/19 - 0s - 8ms/step - loss: 0.0150 - val_loss: 0.0313
Epoch 11/100
19/19 - 0s - 9ms/step - loss: 0.0136 - val_loss: 0.0315
Epoch 12/100
19/19 - 0s - 8ms/step - loss: 0.0143 - val_loss: 0.0312
Epoch 13/100
19/19 - 0s - 9ms/step - loss: 0.0138 - val_loss: 0.0317
Epoch 14/100
19/19 - 0s - 10ms/step - loss: 0.0140 - val_loss: 0.0308
Epoch 15/100
19/19 - 0s - 10ms/step - loss: 0.0139 - val_loss: 0.0325
Epoch 16/100
19/19 - 0s - 9ms/step - loss: 0.0136 - val_loss: 0.0305
Epoch 17/100
19/19 - 0s - 8ms/step - loss: 0.0128 - val_loss: 0.0292
Epoch 18/100
19/19 - 0s - 9ms/step - loss: 0.0126 - val_loss: 0.0303
Epoch 19/100
19/19 - 0s - 10ms/step - loss: 0.0118 - val_loss: 0.0298
Epoch 20/100
19/19 - 0s - 8ms/step - loss: 0.0134 - val_loss: 0.0307
Epoch 21/100
19/19 - 0s - 9ms/step - loss: 0.0127 - val_loss: 0.0311
Epoch 22/100
19/19 - 0s - 9ms/step - loss: 0.0131 - val_loss: 0.0315
Epoch 23/100
19/19 - 0s - 9ms/step - loss: 0.0123 - val_loss: 0.0303
Epoch 24/100
19/19 - 0s - 7ms/step - loss: 0.0127 - val_loss: 0.0303
Epoch 25/100
19/19 - 0s - 9ms/step - loss: 0.0129 - val_loss: 0.0307
Epoch 26/100
19/19 - 0s - 9ms/step - loss: 0.0117 - val_loss: 0.0310
Epoch 27/100
19/19 - 0s - 8ms/step - loss: 0.0109 - val_loss: 0.0307
Epoch 28/100
19/19 - 0s - 10ms/step - loss: 0.0117 - val_loss: 0.0298
Epoch 29/100
19/19 - 0s - 9ms/step - loss: 0.0110 - val_loss: 0.0302
Epoch 30/100
19/19 - 0s - 9ms/step - loss: 0.0130 - val_loss: 0.0302
Epoch 31/100
19/19 - 0s - 9ms/step - loss: 0.0119 - val_loss: 0.0305
Epoch 32/100
19/19 - 0s - 9ms/step - loss: 0.0111 - val_loss: 0.0307
Epoch 33/100
19/19 - 0s - 9ms/step - loss: 0.0115 - val_loss: 0.0297
Epoch 34/100
19/19 - 0s - 9ms/step - loss: 0.0110 - val_loss: 0.0297
Epoch 35/100
19/19 - 0s - 9ms/step - loss: 0.0124 - val_loss: 0.0304
Epoch 36/100
19/19 - 0s - 9ms/step - loss: 0.0104 - val_loss: 0.0305
Epoch 37/100
19/19 - 0s - 9ms/step - loss: 0.0104 - val_loss: 0.0313
<span class=" -Color -Color-Bold">10/10</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">0s</span> 11ms/step
<span class=" -Color -Color-Bold">2/2</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step 
</pre></div>
</div>
<img alt="_images/a401635a853561c5d2cd515508c9974068ec223ffdfeb88412c902c320924008.png" src="_images/a401635a853561c5d2cd515508c9974068ec223ffdfeb88412c902c320924008.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE total: 15.2861
RMSE total: 21.6112
MAPE total: 13.84%
R-cuadrado (validación): 0.1768
</pre></div>
</div>
</div>
</div>
<p>El modelo de perceptrón multicapa (MLP) utilizado para la predicción de ventas de pizzas ha mostrado resultados que merecen un análisis detallado. En términos de rendimiento, las métricas obtenidas son las siguientes: el error absoluto medio (MAE) es de 15.8777, el error cuadrático medio (RMSE) se sitúa en 22.6327, y el porcentaje de error absoluto medio (MAPE) es del 13.80%.</p>
<p>Una de las métricas más destacadas es el R² de la validación, que se ha registrado en 0.1251. Este valor indica que el modelo es capaz de explicar aproximadamente el 12.51% de la variabilidad en las ventas de pizzas. Aunque esto sugiere que hay un potencial para mejorar la capacidad del modelo en términos de ajuste, también resalta que el MLP no ha logrado captar completamente las dinámicas subyacentes en los datos. La tasa de error en las predicciones, representada por el MAE y el RMSE, también sugiere que las predicciones no son completamente precisas, aunque el MAPE indica un nivel de error aceptable en términos porcentuales.</p>
<p>Es importante considerar que el MLP es un modelo flexible y puede mejorarse mediante técnicas como la optimización de hiperparámetros, la regularización o el aumento de la complejidad del modelo con capas adicionales o diferentes funciones de activación. Asimismo, explorar la inclusión de características adicionales, como variables externas que puedan influir en las ventas, podría enriquecer el modelo y ofrecer una mayor capacidad de predicción.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Invertir las transformaciones de escala en las predicciones de entrenamiento y validación</span>
<span class="n">pred_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_train</span><span class="p">)</span>
<span class="n">pred_val_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_val</span><span class="p">)</span>

<span class="c1"># Asegurarse de que real_total y pred_total sean unidimensionales</span>
<span class="n">real_train_total</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
<span class="n">real_val_total</span> <span class="o">=</span> <span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Concatenar predicciones y valores reales, verificando las longitudes</span>
<span class="n">pred_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pred_train_quantity</span><span class="p">,</span> <span class="n">pred_val_quantity</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">real_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">real_train_total</span><span class="p">,</span> <span class="n">real_val_total</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Asegurarse de que real_total y pred_total tengan la misma longitud</span>
<span class="n">min_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">real_total</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_total</span><span class="p">))</span>
<span class="n">real_total</span> <span class="o">=</span> <span class="n">real_total</span><span class="p">[:</span><span class="n">min_length</span><span class="p">]</span>
<span class="n">pred_total</span> <span class="o">=</span> <span class="n">pred_total</span><span class="p">[:</span><span class="n">min_length</span><span class="p">]</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">real_total</span> <span class="o">-</span> <span class="n">pred_total</span>

<span class="c1"># Imprimir longitudes para depuración</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de residuos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de real_total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">real_total</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de pred_total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pred_total</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generar fechas desde el inicio de la serie</span>
<span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
<span class="n">df_residuos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;residuos&#39;</span><span class="p">:</span> <span class="n">residuos</span><span class="p">})</span>

<span class="c1"># Generar un rango de fechas que coincide con la longitud de residuos</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="c1"># Verificar que las longitudes coincidan</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de fechas generadas: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Agregar una columna para identificar el trimestre</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="c1"># Gráfico de caja de los residuos por trimestres</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Caja de los Residuos por Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Prueba de Jarque-Bera de scipy</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test: Estadístico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribución normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribución normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># Gráficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gráfico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación (ACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="c1"># Gráfico de PACF</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación Parcial (PACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Longitud de residuos: 344
Longitud de real_total: 344
Longitud de pred_total: 344
Longitud de fechas generadas: 344
</pre></div>
</div>
<img alt="_images/41288ae68f13c5f0e7c7ab1f1e28cfade2a58db280ad3c8f501bb0a3ec704b67.png" src="_images/41288ae68f13c5f0e7c7ab1f1e28cfade2a58db280ad3c8f501bb0a3ec704b67.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test: Estadístico=715.1376457543048, p-valor=5.126645926826437e-156
Los residuos no siguen una distribución normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/f1c1ff94edf1949ad91379c1da5f531e3a5d5f26f08b891f24ea4d8ca361b63a.png" src="_images/f1c1ff94edf1949ad91379c1da5f531e3a5d5f26f08b891f24ea4d8ca361b63a.png" />
</div>
</div>
<p>Los resultados del análisis de residuos del modelo MLP muestran que, aunque los errores son mayormente estables y aleatorios, persisten algunas limitaciones. En el boxplot, la mayoría de las cajas tienen tamaños similares y cercanos a cero, lo que sugiere estabilidad en los errores, pero la última caja es un poco más grande y presenta puntos dispersos, indicando más variabilidad hacia el final del periodo de entrenamiento. En el ACF y PACF, todos los rezagos están dentro de la banda de significancia, lo que confirma la ausencia de autocorrelación significativa. Sin embargo, la prueba de Jarque-Bera revela que los residuos no siguen una distribución normal (p-valor=5.13e-156), lo cual sugiere que el modelo aún no captura del todo la estructura de los datos y podría beneficiarse de ajustes adicionales.</p>
</section>
<section id="id5">
<h2>Analisis de los residuos de la prediccion<a class="headerlink" href="#id5" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular residuos de las predicciones</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y_train_true</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">y_test_true</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Realizar la prueba de Ljung-Box</span>
<span class="n">ljung_box_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prueba de Ljung-Box:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ljung_box_test</span><span class="p">)</span>

<span class="c1"># Realizar la prueba de Jarque-Bera</span>
<span class="n">jarque_bera_test</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prueba de Jarque-Bera:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico: </span><span class="si">{</span><span class="n">jarque_bera_test</span><span class="o">.</span><span class="n">statistic</span><span class="si">}</span><span class="s2">, p-valor: </span><span class="si">{</span><span class="n">jarque_bera_test</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prueba de Ljung-Box:
     lb_stat  lb_pvalue
10  8.637927   0.566775

Prueba de Jarque-Bera:
Estadístico: 651.3574678682289, p-valor: 3.626794756558717e-142
</pre></div>
</div>
</div>
</div>
<p>Los resultados de los residuos de la predicción indican algunos aspectos importantes sobre el modelo. La prueba de Ljung-Box muestra un estadístico de 8.64 con un p-valor de 0.5668, lo cual sugiere que no hay autocorrelación significativa en los residuos. Esto es positivo, ya que indica que los errores de predicción no presentan patrones secuenciales.</p>
<p>Sin embargo, la prueba de Jarque-Bera da un estadístico de 651.36 y un p-valor de 3.63e-142, lo que significa que los residuos no siguen una distribución normal. Esto podría reflejar que el modelo no logra captar completamente la estructura subyacente de los datos, dejando algunas características de los errores sin explicar. En conjunto, aunque no hay autocorrelación en los errores, el modelo podría beneficiarse de ajustes adicionales para mejorar su capacidad predictiva.</p>
</section>
<section id="modelo-lstm">
<h2>Modelo LSTM<a class="headerlink" href="#modelo-lstm" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Bidirectional</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">LSTM</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">load_model</span>
<span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="kn">import</span> <span class="n">ModelCheckpoint</span><span class="p">,</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Paso 1: Leer y procesar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Escalar los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">)</span>

<span class="c1"># Paso 2: Crear secuencias para la LSTM</span>
<span class="k">def</span> <span class="nf">makeXy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">steps</span><span class="p">):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">steps</span><span class="p">])</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">steps</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Definir pasos de tiempo (7 días para predecir el siguiente)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_scaled</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento y validación (80% entrenamiento, 20% validación)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Reshape a formato 3D: (muestras, pasos de tiempo, características)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">X_val</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Paso 3: Crear el modelo Bidirectional LSTM con las configuraciones especificadas</span>
<span class="n">input_layer</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">lstm_layer1</span> <span class="o">=</span> <span class="n">Bidirectional</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))(</span><span class="n">input_layer</span><span class="p">)</span>  <span class="c1"># 75 unidades LSTM en la capa Bidirectional</span>
<span class="n">lstm_layer2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">lstm_layer1</span><span class="p">)</span>  <span class="c1"># 75 unidades LSTM en la segunda capa</span>
<span class="n">dropout_layer</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)(</span><span class="n">lstm_layer2</span><span class="p">)</span>  <span class="c1"># Dropout de 0.4</span>
<span class="n">output_layer</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">dropout_layer</span><span class="p">)</span>

<span class="c1"># Compilar el modelo con el optimizador adam</span>
<span class="n">ts_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_layer</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">ts_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>

<span class="c1"># Resumen del modelo</span>
<span class="n">ts_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="c1"># Paso 4: Entrenamiento del modelo con Early Stopping</span>
<span class="n">save_weights_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">,</span> <span class="s1">&#39;PizzaSales_LSTM_weights.</span><span class="si">{epoch:02d}</span><span class="s1">-</span><span class="si">{val_loss:.4f}</span><span class="s1">.keras&#39;</span><span class="p">)</span>
<span class="n">save_best</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">save_weights_at</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrenamiento con batch_size ajustado a 5</span>
<span class="n">history_pizza_LSTM</span> <span class="o">=</span> <span class="n">ts_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  
                                  <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">save_best</span><span class="p">,</span> <span class="n">early_stopping</span><span class="p">],</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Paso 5: Evaluar el mejor modelo</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;PizzaSales_LSTM_weights\.(\d+)-([\d\.]+)\.keras&quot;</span>
<span class="n">best_val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_model_file</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">val_loss</span> <span class="o">&lt;</span> <span class="n">best_val_loss</span><span class="p">:</span>
            <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">val_loss</span>
            <span class="n">best_model_file</span> <span class="o">=</span> <span class="n">file</span>

<span class="k">if</span> <span class="n">best_model_file</span><span class="p">:</span>
    <span class="n">best_model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">,</span> <span class="n">best_model_file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cargando el mejor modelo: </span><span class="si">{</span><span class="n">best_model_file</span><span class="si">}</span><span class="s2"> con val_loss: </span><span class="si">{</span><span class="n">best_val_loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">)</span>

<span class="c1"># Paso 6: Predicción y evaluación</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">pred_sales</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
<span class="n">pred_sales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pred_sales</span><span class="p">)</span>

<span class="c1"># Definir el rango correcto para las ventas reales (valores reales de la validación)</span>
<span class="n">real_sales_val</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">][</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">)]</span>

<span class="c1"># Comprobar si las longitudes coinciden antes del cálculo de MAE</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de predicciones: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pred_sales</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de valores reales: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Asegúrate de que las longitudes coinciden</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Calcular RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Calcular MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">real_sales_val</span> <span class="o">-</span> <span class="n">pred_sales</span><span class="p">)</span> <span class="o">/</span> <span class="n">real_sales_val</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAPE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mape</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>

<span class="c1"># Calcular R²</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R² for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Visualización</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">real_sales_val</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">pred_sales</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="s1">&#39;Predicted&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Actual vs Predicted Pizza Sales&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Quantity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "functional_1"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━┓
┃<span style="font-weight: bold"> Layer (type)                    </span>┃<span style="font-weight: bold"> Output Shape           </span>┃<span style="font-weight: bold">       Param # </span>┃
┡━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━┩
│ input_layer_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">InputLayer</span>)      │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">7</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)           │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ bidirectional_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Bidirectional</span>) │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">7</span>, <span style="color: #00af00; text-decoration-color: #00af00">3000</span>)        │    <span style="color: #00af00; text-decoration-color: #00af00">18,024,000</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ lstm_3 (<span style="color: #0087ff; text-decoration-color: #0087ff">LSTM</span>)                   │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1000</span>)           │    <span style="color: #00af00; text-decoration-color: #00af00">16,004,000</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dropout_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dropout</span>)             │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1000</span>)           │             <span style="color: #00af00; text-decoration-color: #00af00">0</span> │
├─────────────────────────────────┼────────────────────────┼───────────────┤
│ dense_1 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 │ (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              │         <span style="color: #00af00; text-decoration-color: #00af00">1,001</span> │
└─────────────────────────────────┴────────────────────────┴───────────────┘
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">34,029,001</span> (129.81 MB)
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">34,029,001</span> (129.81 MB)
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/50
56/56 - 110s - 2s/step - loss: 0.1170 - val_loss: 0.1462
Epoch 2/50
56/56 - 141s - 3s/step - loss: 0.1162 - val_loss: 0.1239
Epoch 3/50
56/56 - 176s - 3s/step - loss: 0.0962 - val_loss: 0.1142
Epoch 4/50
56/56 - 115s - 2s/step - loss: 0.0932 - val_loss: 0.1196
Epoch 5/50
56/56 - 148s - 3s/step - loss: 0.0980 - val_loss: 0.1138
Epoch 6/50
56/56 - 127s - 2s/step - loss: 0.0930 - val_loss: 0.1101
Epoch 7/50
56/56 - 157s - 3s/step - loss: 0.0900 - val_loss: 0.1083
Epoch 8/50
56/56 - 132s - 2s/step - loss: 0.0885 - val_loss: 0.1066
Epoch 9/50
56/56 - 130s - 2s/step - loss: 0.0888 - val_loss: 0.1297
Epoch 10/50
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">66</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span> <span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span> <span class="c1"># Entrenamiento con batch_size ajustado a 5</span>
<span class="ne">---&gt; </span><span class="mi">66</span> <span class="n">history_pizza_LSTM</span> <span class="o">=</span> <span class="n">ts_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  
<span class="g g-Whitespace">     </span><span class="mi">67</span>                                   <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">save_best</span><span class="p">,</span> <span class="n">early_stopping</span><span class="p">],</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span> <span class="c1"># Paso 5: Evaluar el mejor modelo</span>
<span class="g g-Whitespace">     </span><span class="mi">70</span> <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\keras\src\utils\traceback_utils.py:117,</span> in <span class="ni">filter_traceback.&lt;locals&gt;.error_handler</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> <span class="n">filtered_tb</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">116</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">117</span>     <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">118</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">119</span>     <span class="n">filtered_tb</span> <span class="o">=</span> <span class="n">_process_traceback_frames</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\keras\src\backend\tensorflow\trainer.py:320,</span> in <span class="ni">TensorFlowTrainer.fit</span><span class="nt">(self, x, y, batch_size, epochs, verbose, callbacks, validation_split, validation_data, shuffle, class_weight, sample_weight, initial_epoch, steps_per_epoch, validation_steps, validation_batch_size, validation_freq)</span>
<span class="g g-Whitespace">    </span><span class="mi">318</span> <span class="k">for</span> <span class="n">step</span><span class="p">,</span> <span class="n">iterator</span> <span class="ow">in</span> <span class="n">epoch_iterator</span><span class="o">.</span><span class="n">enumerate_epoch</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">319</span>     <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_batch_begin</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">320</span>     <span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">train_function</span><span class="p">(</span><span class="n">iterator</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">321</span>     <span class="n">logs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pythonify_logs</span><span class="p">(</span><span class="n">logs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">322</span>     <span class="n">callbacks</span><span class="o">.</span><span class="n">on_train_batch_end</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">logs</span><span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\util\traceback_utils.py:150,</span> in <span class="ni">filter_traceback.&lt;locals&gt;.error_handler</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span> <span class="n">filtered_tb</span> <span class="o">=</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">149</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">150</span>   <span class="k">return</span> <span class="n">fn</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span> <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">152</span>   <span class="n">filtered_tb</span> <span class="o">=</span> <span class="n">_process_traceback_frames</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">__traceback__</span><span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\eager\polymorphic_function\polymorphic_function.py:833,</span> in <span class="ni">Function.__call__</span><span class="nt">(self, *args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">830</span> <span class="n">compiler</span> <span class="o">=</span> <span class="s2">&quot;xla&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jit_compile</span> <span class="k">else</span> <span class="s2">&quot;nonXla&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">832</span> <span class="k">with</span> <span class="n">OptionalXlaContext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_jit_compile</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">833</span>   <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">835</span> <span class="n">new_tracing_count</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">experimental_get_tracing_count</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">836</span> <span class="n">without_tracing</span> <span class="o">=</span> <span class="p">(</span><span class="n">tracing_count</span> <span class="o">==</span> <span class="n">new_tracing_count</span><span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\eager\polymorphic_function\polymorphic_function.py:878,</span> in <span class="ni">Function._call</span><span class="nt">(self, *args, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">875</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
<span class="g g-Whitespace">    </span><span class="mi">876</span> <span class="c1"># In this case we have not created variables on the first call. So we can</span>
<span class="g g-Whitespace">    </span><span class="mi">877</span> <span class="c1"># run the first trace but we should fail if variables are created.</span>
<span class="ne">--&gt; </span><span class="mi">878</span> <span class="n">results</span> <span class="o">=</span> <span class="n">tracing_compilation</span><span class="o">.</span><span class="n">call_function</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">879</span>     <span class="n">args</span><span class="p">,</span> <span class="n">kwds</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_variable_creation_config</span>
<span class="g g-Whitespace">    </span><span class="mi">880</span> <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">881</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created_variables</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">882</span>   <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Creating variables on a non-first call to a function&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">883</span>                    <span class="s2">&quot; decorated with tf.function.&quot;</span><span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\eager\polymorphic_function\tracing_compilation.py:139,</span> in <span class="ni">call_function</span><span class="nt">(args, kwargs, tracing_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span> <span class="n">bound_args</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">function_type</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span> <span class="n">flat_inputs</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">function_type</span><span class="o">.</span><span class="n">unpack_inputs</span><span class="p">(</span><span class="n">bound_args</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">139</span> <span class="k">return</span> <span class="n">function</span><span class="o">.</span><span class="n">_call_flat</span><span class="p">(</span>  <span class="c1"># pylint: disable=protected-access</span>
<span class="g g-Whitespace">    </span><span class="mi">140</span>     <span class="n">flat_inputs</span><span class="p">,</span> <span class="n">captured_inputs</span><span class="o">=</span><span class="n">function</span><span class="o">.</span><span class="n">captured_inputs</span>
<span class="g g-Whitespace">    </span><span class="mi">141</span> <span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\eager\polymorphic_function\concrete_function.py:1322,</span> in <span class="ni">ConcreteFunction._call_flat</span><span class="nt">(self, tensor_inputs, captured_inputs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1318</span> <span class="n">possible_gradient_type</span> <span class="o">=</span> <span class="n">gradients_util</span><span class="o">.</span><span class="n">PossibleTapeGradientTypes</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1319</span> <span class="k">if</span> <span class="p">(</span><span class="n">possible_gradient_type</span> <span class="o">==</span> <span class="n">gradients_util</span><span class="o">.</span><span class="n">POSSIBLE_GRADIENT_TYPES_NONE</span>
<span class="g g-Whitespace">   </span><span class="mi">1320</span>     <span class="ow">and</span> <span class="n">executing_eagerly</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1321</span>   <span class="c1"># No tape is watching; skip to running the function.</span>
<span class="ne">-&gt; </span><span class="mi">1322</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inference_function</span><span class="o">.</span><span class="n">call_preflattened</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1323</span> <span class="n">forward_backward</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_select_forward_and_backward_functions</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1324</span>     <span class="n">args</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1325</span>     <span class="n">possible_gradient_type</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1326</span>     <span class="n">executing_eagerly</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1327</span> <span class="n">forward_function</span><span class="p">,</span> <span class="n">args_with_tangents</span> <span class="o">=</span> <span class="n">forward_backward</span><span class="o">.</span><span class="n">forward</span><span class="p">()</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\eager\polymorphic_function\atomic_function.py:216,</span> in <span class="ni">AtomicFunction.call_preflattened</span><span class="nt">(self, args)</span>
<span class="g g-Whitespace">    </span><span class="mi">214</span> <span class="k">def</span> <span class="nf">call_preflattened</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">core</span><span class="o">.</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">215</span><span class="w">   </span><span class="sd">&quot;&quot;&quot;Calls with flattened tensor inputs and returns the structured output.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">216</span>   <span class="n">flat_outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">call_flat</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">217</span>   <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function_type</span><span class="o">.</span><span class="n">pack_output</span><span class="p">(</span><span class="n">flat_outputs</span><span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\eager\polymorphic_function\atomic_function.py:251,</span> in <span class="ni">AtomicFunction.call_flat</span><span class="nt">(self, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">249</span> <span class="k">with</span> <span class="n">record</span><span class="o">.</span><span class="n">stop_recording</span><span class="p">():</span>
<span class="g g-Whitespace">    </span><span class="mi">250</span>   <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_context</span><span class="o">.</span><span class="n">executing_eagerly</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">251</span>     <span class="n">outputs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bound_context</span><span class="o">.</span><span class="n">call_function</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">252</span>         <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">253</span>         <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">254</span>         <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">function_type</span><span class="o">.</span><span class="n">flat_outputs</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">255</span>     <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">256</span>   <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">257</span>     <span class="n">outputs</span> <span class="o">=</span> <span class="n">make_call_op_in_graph</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">258</span>         <span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">259</span>         <span class="nb">list</span><span class="p">(</span><span class="n">args</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">260</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_bound_context</span><span class="o">.</span><span class="n">function_call_options</span><span class="o">.</span><span class="n">as_attrs</span><span class="p">(),</span>
<span class="g g-Whitespace">    </span><span class="mi">261</span>     <span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\eager\context.py:1552,</span> in <span class="ni">Context.call_function</span><span class="nt">(self, name, tensor_inputs, num_outputs)</span>
<span class="g g-Whitespace">   </span><span class="mi">1550</span> <span class="n">cancellation_context</span> <span class="o">=</span> <span class="n">cancellation</span><span class="o">.</span><span class="n">context</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">1551</span> <span class="k">if</span> <span class="n">cancellation_context</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">1552</span>   <span class="n">outputs</span> <span class="o">=</span> <span class="n">execute</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1553</span>       <span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1554</span>       <span class="n">num_outputs</span><span class="o">=</span><span class="n">num_outputs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1555</span>       <span class="n">inputs</span><span class="o">=</span><span class="n">tensor_inputs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1556</span>       <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1557</span>       <span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1558</span>   <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1559</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1560</span>   <span class="n">outputs</span> <span class="o">=</span> <span class="n">execute</span><span class="o">.</span><span class="n">execute_with_cancellation</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">1561</span>       <span class="n">name</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">   </span><span class="mi">1562</span>       <span class="n">num_outputs</span><span class="o">=</span><span class="n">num_outputs</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1566</span>       <span class="n">cancellation_manager</span><span class="o">=</span><span class="n">cancellation_context</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1567</span>   <span class="p">)</span>

<span class="nn">File c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\tensorflow\python\eager\execute.py:53,</span> in <span class="ni">quick_execute</span><span class="nt">(op_name, num_outputs, inputs, attrs, ctx, name)</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span> <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>   <span class="n">ctx</span><span class="o">.</span><span class="n">ensure_initialized</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">53</span>   <span class="n">tensors</span> <span class="o">=</span> <span class="n">pywrap_tfe</span><span class="o">.</span><span class="n">TFE_Py_Execute</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">_handle</span><span class="p">,</span> <span class="n">device_name</span><span class="p">,</span> <span class="n">op_name</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">54</span>                                       <span class="n">inputs</span><span class="p">,</span> <span class="n">attrs</span><span class="p">,</span> <span class="n">num_outputs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="k">except</span> <span class="n">core</span><span class="o">.</span><span class="n">_NotOkStatusException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>   <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p>Los resultados del modelo LSTM para la predicción de ventas de pizza muestran áreas de mejora. El Error Absoluto Medio (MAE) es de <strong>20.8465</strong>, lo que indica que, en promedio, las predicciones se desvían en aproximadamente 21 ventas. El Raíz del Error Cuadrático Medio (RMSE) de <strong>31.8997</strong> sugiere que el modelo tiene variaciones significativas en sus predicciones, penalizando más los errores grandes.</p>
<p>El Porcentaje de Error Absoluto Medio (MAPE) es de <strong>14.87%</strong>, lo que puede considerarse aceptable en algunos contextos, pero aún muestra margen de mejora. Sin embargo, el R² de <strong>-0.0354</strong> indica que el modelo no se ajusta bien a los datos, sugiriendo que su rendimiento es inferior a simplemente utilizar la media de los valores reales.</p>
<p>En resumen, el modelo LSTM presenta un desempeño que requiere atención. Se sugiere optimizar hiperparámetros, incluir más datos relevantes y explorar otras arquitecturas para mejorar la precisión de las predicciones.</p>
<section id="analisis-residuos-del-entrenamiento">
<h3>Analisis residuos del entrenamiento<a class="headerlink" href="#analisis-residuos-del-entrenamiento" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Análisis de residuos del entrenamiento</span>

<span class="c1"># Prueba de Jarque-Bera en los residuos del entrenamiento</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prueba de Jarque-Bera para los residuos del entrenamiento: Estadístico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribución normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribución normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># Gráficos de ACF y PACF de los residuos del entrenamiento</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gráfico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación (ACF) de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>

<span class="c1"># Gráfico de PACF</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gráfico de Autocorrelación Parcial (PACF) de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Paso 7: Predicción y evaluación en el conjunto de validación</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">pred_sales</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">real_sales_val</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">][</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Métricas de validación</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">))</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">real_sales_val</span> <span class="o">-</span> <span class="n">pred_sales</span><span class="p">)</span> <span class="o">/</span> <span class="n">real_sales_val</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Calcular los residuos del conjunto de entrenamiento</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">pred_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_train</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">real_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">residuos_train</span> <span class="o">=</span> <span class="n">real_train_quantity</span> <span class="o">-</span> <span class="n">pred_train_quantity</span>

<span class="c1"># Longitud de cada trimestre en días (aproximadamente 90 días)</span>
<span class="n">trimestre_dias</span> <span class="o">=</span> <span class="mi">90</span>

<span class="c1"># Dividir los residuos en trimestres</span>
<span class="n">num_trimestres</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span> <span class="o">//</span> <span class="n">trimestre_dias</span>
<span class="n">residuos_por_trimestre</span> <span class="o">=</span> <span class="p">[</span><span class="n">residuos_train</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">trimestre_dias</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">trimestre_dias</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trimestres</span><span class="p">)]</span>

<span class="c1"># Crear etiquetas para los trimestres</span>
<span class="n">trimestre_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Trimestre </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trimestres</span><span class="p">)]</span>

<span class="c1"># Visualización de los residuos en un boxplot trimestral</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">residuos_por_trimestre</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_trimestres</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="n">trimestre_labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot Trimestral de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prueba de Jarque-Bera para los residuos del entrenamiento: Estadístico=282.6545671273233, p-valor=4.191221429062365e-62
Los residuos no siguen una distribución normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/fb66106b3e5c1eb23cdeeb3bd57c90aacbf2c65da7c47146029969753771c69f.png" src="_images/fb66106b3e5c1eb23cdeeb3bd57c90aacbf2c65da7c47146029969753771c69f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">3/3</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">0s</span> 13ms/step 
<span class=" -Color -Color-Bold">9/9</span> <span class=" -Color -Color-Green">━━━━━━━━━━━━━━━━━━━━</span> <span class=" -Color -Color-Bold">0s</span> 9ms/step
</pre></div>
</div>
<img alt="_images/f37815b1849214a843b67f19277e5dcf36c3bf18533c0534ea2edcd687d3c487.png" src="_images/f37815b1849214a843b67f19277e5dcf36c3bf18533c0534ea2edcd687d3c487.png" />
</div>
</div>
<p>Los resultados del análisis de residuos de entrenamiento del modelo LSTM indican ciertos aspectos clave. En el boxplot, los residuos de los tres primeros trimestres tienen tamaños similares y cercanos a cero, mientras que el cuarto trimestre no se graficó, lo que limita una evaluación completa de la estabilidad en los errores a lo largo del año. Los gráficos de ACF y PACF muestran que todos los rezagos están dentro de la banda de significancia, lo cual es positivo, ya que sugiere que no hay autocorrelación significativa en los residuos y que estos se comportan de forma aleatoria.</p>
<p>La prueba de Jarque-Bera muestra un estadístico de 282.65 y un p-valor de 4.19e-62, lo que indica que los residuos no siguen una distribución normal (p &lt;= 0.05). Esto sugiere que el modelo no capta completamente la estructura de los datos y deja aspectos sin modelar. En conjunto, aunque el modelo no presenta autocorrelación en los errores, la falta de normalidad y la ausencia del último trimestre en el análisis reflejan que podría beneficiarse de ajustes para mejorar su precisión y adaptación a la variabilidad de los datos.</p>
</section>
<section id="id6">
<h3>Analisis de los residuos de la prediccion<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">real_sales_val</span> <span class="o">-</span> <span class="n">pred_sales</span>

<span class="c1"># Convertir los residuos a un array NumPy y asegurarte de que son de tipo float</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Eliminar NaN, si existen</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">residuals</span><span class="p">)]</span>

<span class="c1"># Realizar la prueba de Jarque-Bera para los residuos</span>
<span class="n">jarque_bera_stat</span><span class="p">,</span> <span class="n">jarque_bera_pvalue</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resultados de la prueba de Jarque-Bera:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estadístico: </span><span class="si">{</span><span class="n">jarque_bera_stat</span><span class="si">}</span><span class="s2">, p-valor: </span><span class="si">{</span><span class="n">jarque_bera_pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Realizar la prueba de Ljung-Box para los residuos</span>
<span class="n">ljung_box_result</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Resultados de la prueba de Ljung-Box:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ljung_box_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resultados de la prueba de Jarque-Bera:
Estadístico: 138.64306551707668, p-valor: 7.835033286826069e-31

Resultados de la prueba de Ljung-Box:
      lb_stat  lb_pvalue
10  18.176117   0.052064
</pre></div>
</div>
</div>
</div>
<p>Los resultados del análisis de los residuos de predicción indican que el modelo tiene algunas limitaciones. La prueba de Jarque-Bera muestra un estadístico de 138.64 y un p-valor de 7.83e-31, lo que sugiere que los residuos no siguen una distribución normal (p &lt;= 0.05). Esto indica que el modelo no ha captado completamente la estructura subyacente en los datos, lo que podría reflejar patrones o sesgos residuales. Por otro lado, la prueba de Ljung-Box presenta un estadístico de 18.18 y un p-valor de 0.052, lo que se encuentra justo en el límite de significancia. Esto sugiere que, aunque no hay autocorrelación significativa de manera estricta, los residuos presentan cierta dependencia que podría afectar la precisión predictiva del modelo. En resumen, estos resultados indican que, a pesar de un comportamiento relativamente independiente en los errores, el modelo podría beneficiarse de ajustes adicionales para mejorar su capacidad de capturar patrones y reducir posibles sesgos en las predicciones.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-original">
<h1>Modelo original<a class="headerlink" href="#modelo-original" title="Link to this heading">#</a></h1>
<section id="enfoque-hibrido-holt-winters-con-una-red-neuronal-de-perceptron-multicapa-mlp">
<h2>Enfoque híbrido Holt-Winters con una red neuronal de perceptrón multicapa (MLP)<a class="headerlink" href="#enfoque-hibrido-holt-winters-con-una-red-neuronal-de-perceptron-multicapa-mlp" title="Link to this heading">#</a></h2>
<p>En este proyecto, se implementó un modelo de predicción para las ventas diarias de pizza utilizando un enfoque híbrido que combina la suavización exponencial de Holt-Winters con una red neuronal de perceptrón multicapa (MLP). Este modelo permite capturar tanto la tendencia y estacionalidad en las ventas como patrones más complejos en los residuos, logrando así predicciones más precisas.</p>
<p>El modelo híbrido funciona en dos etapas. Primero, se aplica el modelo de suavización exponencial de Holt-Winters para captar la tendencia y estacionalidad de las ventas diarias. Este componente inicial captura patrones periódicos, como la estacionalidad semanal, y la tendencia general de la serie temporal. Holt-Winters es ideal para reconocer cambios estacionales y tendencias, proporcionando una base sólida para la descomposición de la serie.</p>
<p>En la segunda etapa, una red neuronal de perceptrón multicapa (MLP) se entrena sobre los residuos del modelo Holt-Winters en los datos de entrenamiento. Aunque Holt-Winters ofrece una estimación precisa, suelen quedar patrones residuales no capturados. El MLP permite capturar relaciones no lineales en estos residuos, ajustando irregularidades y mejorando el pronóstico general del modelo.</p>
<p>La configuración de este enfoque híbrido se basa en las ventas diarias de pizza, dividiendo los datos en conjuntos de entrenamiento y prueba para ajustar ambos modelos. La red neuronal incluye una capa oculta de 100 neuronas, una arquitectura que permite capturar patrones complejos. Los residuos se escalan antes de entrenar el MLP, optimizando así su rendimiento.</p>
<p>Este enfoque permite que el modelo se adapte tanto a patrones estacionales como a variaciones no lineales en las ventas de pizza. La evaluación del rendimiento incluye métricas como el MAE, RMSE, MAPE y el coeficiente R², asegurando una valoración exhaustiva de la precisión y robustez del modelo.</p>
<p>En conclusión, el enfoque híbrido Holt-Winters + MLP combina la capacidad de los métodos de suavización exponencial para capturar la estacionalidad y la tendencia, con la habilidad de las redes neuronales para ajustar patrones residuales no lineales. Este modelo proporciona pronósticos de ventas diarios más precisos, lo que mejora la planificación de inventario y la gestión de recursos en el negocio de pizzas, adaptándose a la naturaleza compleja de las series temporales en el ámbito de las ventas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="n">MLPRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad de ventas diarias (Quantity)</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_ventas</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span>

<span class="c1"># Definir el tamaño del conjunto de prueba (último 15%)</span>
<span class="n">test_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_grouped</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[:</span><span class="o">-</span><span class="n">test_size</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="o">-</span><span class="n">test_size</span><span class="p">:]</span>

<span class="c1"># Ajuste del modelo Holt-Winters con los mejores parámetros</span>
<span class="n">trend</span> <span class="o">=</span> <span class="s1">&#39;mul&#39;</span>
<span class="n">seasonal</span> <span class="o">=</span> <span class="s1">&#39;add&#39;</span>
<span class="n">seasonal_periods</span> <span class="o">=</span> <span class="mi">7</span>

<span class="n">hw_model</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> 
                                <span class="n">trend</span><span class="o">=</span><span class="n">trend</span><span class="p">,</span>
                                <span class="n">seasonal</span><span class="o">=</span><span class="n">seasonal</span><span class="p">,</span> 
                                <span class="n">seasonal_periods</span><span class="o">=</span><span class="n">seasonal_periods</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Predicción de Holt-Winters</span>
<span class="n">forecast_hw</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>

<span class="c1"># Residuales del modelo Holt-Winters en los datos de entrenamiento</span>
<span class="n">train_residuals</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">fittedvalues</span>

<span class="c1"># Escalar datos para el MLP</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_residuals</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_residuals</span><span class="o">.</span><span class="n">values</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>

<span class="c1"># Ajuste del modelo MLP para los residuos con los mejores parámetros</span>
<span class="n">hidden_layer_sizes</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,)</span>
<span class="n">max_iter</span> <span class="o">=</span> <span class="mi">20</span>

<span class="n">mlp</span> <span class="o">=</span> <span class="n">MLPRegressor</span><span class="p">(</span><span class="n">hidden_layer_sizes</span><span class="o">=</span><span class="n">hidden_layer_sizes</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="n">max_iter</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">mlp</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Predicción de los residuos con el modelo MLP</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_residuals</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_residuals</span><span class="p">)</span> <span class="o">+</span> <span class="n">test_size</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">forecast_mlp_residuals</span> <span class="o">=</span> <span class="n">mlp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_scaled</span><span class="p">)</span>

<span class="c1"># Predicción final del modelo híbrido</span>
<span class="n">forecast_hybrid</span> <span class="o">=</span> <span class="n">forecast_hw</span> <span class="o">+</span> <span class="n">forecast_mlp_residuals</span>

<span class="c1"># Calcular MAPE, MAE, y otras métricas de evaluación</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast_hybrid</span><span class="p">)</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast_hybrid</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mse</span><span class="p">)</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">forecast_hybrid</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">r_squared</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast_hybrid</span><span class="p">)</span>

<span class="c1"># Imprimir las métricas calculadas</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE del modelo híbrido: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE del modelo híbrido: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE del modelo híbrido: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE del modelo híbrido: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R² del modelo híbrido: </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Graficar los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Datos de entrenamiento</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Conjunto de prueba</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Conjunto de prueba real&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Predicción del modelo híbrido</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">forecast_hybrid</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicción del modelo híbrido&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Etiquetas y título</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predicción de Ventas usando el modelo Holt-Winters + MLP&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total de Ventas&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Rotar etiquetas del eje X</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Mostrar el gráfico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\holtwinters\model.py:84: RuntimeWarning: overflow encountered in matmul
  return err.T @ err
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE del modelo híbrido: 20.594729070012452
RMSE del modelo híbrido: 31.607701811691253
MSE del modelo híbrido: 999.0468138167906
MAPE del modelo híbrido: 15.92%
R² del modelo híbrido: 0.1264
</pre></div>
</div>
<img alt="_images/0457549f580bdd0b1a70db55d48091ae331f5dbef1d6509e7ee5c7a88a8d0426.png" src="_images/0457549f580bdd0b1a70db55d48091ae331f5dbef1d6509e7ee5c7a88a8d0426.png" />
</div>
</div>
<p>He evaluado el modelo de predicción de ventas diarias de pizza mediante varias métricas que reflejan su rendimiento: MAPE, MAE, RMSE, MSE y el coeficiente de determinación (R²).</p>
<p>El MAPE (Error Porcentual Absoluto Medio) tiene un valor de 15.92%, lo que indica que, en promedio, el modelo se desvía un 15.92% de las ventas reales. Considero que un MAPE inferior al 20% es un buen indicador de predicción, lo que sugiere que el modelo ofrece una predicción razonablemente aceptable, aunque hay margen de mejora.</p>
<p>El MAE (Error Absoluto Medio) es de 20.59, lo que significa que el modelo se equivoca, en promedio, en aproximadamente 21 pizzas por día. Este nivel de error puede ser tolerable dependiendo del volumen de ventas diarias, aunque sería beneficioso reducirlo para mejorar la precisión en la planificación operativa.</p>
<p>El RMSE (Raíz del Error Cuadrático Medio) es de 31.61. Esta métrica sugiere que, aunque el modelo realiza predicciones adecuadas en general, existen días en los que los errores son mayores, lo que afecta esta métrica. Sin embargo, este valor sigue siendo razonable dado que las ventas diarias pueden ser difíciles de predecir debido a fluctuaciones imprevisibles.</p>
<p>El MSE (Error Cuadrático Medio) es de 999.05. Aunque esta métrica no es tan intuitiva, sigue destacando la presencia de algunos días con errores significativos que el modelo no ha capturado del todo bien. No obstante, considerando que el modelo no utiliza factores adicionales como promociones o efectos climáticos, estos resultados pueden considerarse satisfactorios para un primer enfoque basado en características básicas.</p>
<p>Finalmente, el R² (Coeficiente de Determinación) es de 0.1264, lo que indica que el modelo explica aproximadamente el 12.64% de la variabilidad en las ventas. Aunque un R² más alto sería deseable, este resultado muestra que el modelo tiene potencial de mejora, especialmente si se integran características adicionales que podrían capturar mejor la dinámica de las ventas.</p>
</section>
<section id="id7">
<h2>Analisis de los residuos del entrenamiento<a class="headerlink" href="#id7" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Supongamos que el resto del código anterior ya se ha ejecutado y tienes los residuos del entrenamiento</span>
<span class="c1"># Residuales del modelo híbrido en los datos de entrenamiento</span>
<span class="n">train_residuals</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">hw_model</span><span class="o">.</span><span class="n">fittedvalues</span> <span class="o">+</span> <span class="n">mlp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">))</span>

<span class="c1"># Crear una columna de período trimestral para los datos de entrenamiento</span>
<span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;quarter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="c1"># Boxplot trimestral de los residuos del entrenamiento</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;quarter&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">train_residuals</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot Trimestral de los Residuos del Modelo (Entrenamiento)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Prueba de Jarque-Bera para la normalidad de los residuos</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">train_residuals</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estadístico de Jarque-Bera: </span><span class="si">{</span><span class="n">jb_stat</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, Valor p: </span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># ACF y PACF de los residuos</span>
<span class="n">max_lags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_residuals</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Lags menores al 50% del tamaño de la muestra</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># ACF de los residuos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">train_residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ACF de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>

<span class="c1"># PACF de los residuos</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">train_residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PACF de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_11004\122799163.py:13: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  train_data[&#39;quarter&#39;] = train_data[&#39;order_date&#39;].dt.to_period(&#39;Q&#39;)
</pre></div>
</div>
<img alt="_images/83a6e570919ed9922caa7d1f017fb26612269f6811934a897749723d81e099ec.png" src="_images/83a6e570919ed9922caa7d1f017fb26612269f6811934a897749723d81e099ec.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Estadístico de Jarque-Bera: 1409.1862, Valor p: 0.0000
</pre></div>
</div>
<img alt="_images/79df670fe57b5cf3816ab03011ec8c1a8721603739bce96d9d591c80190b3a66.png" src="_images/79df670fe57b5cf3816ab03011ec8c1a8721603739bce96d9d591c80190b3a66.png" />
</div>
</div>
<p>El primer gráfico, el Boxplot Trimestral de los Residuos del Modelo (Entrenamiento), presenta la distribución de los residuos a lo largo de cuatro trimestres. En cada trimestre se observa un boxplot que permite analizar cómo varían los residuos. Los resultados indican que, si bien las cajas no son tan delgadas como se podría esperar, la del último cuartil es más ancha que las demás. Esto sugiere cierta variabilidad en los residuos a medida que avanza el tiempo. Aunque la mediana de los residuos se encuentra relativamente cerca de cero, lo que indica que el modelo no presenta un sesgo sistemático en sus predicciones, la amplitud de la caja del último cuartil podría señalar una mayor dispersión en las predicciones en ese periodo. Además, se observa la presencia de valores atípicos (outliers), tanto por encima de 40 como por debajo de -20, lo que sugiere que el modelo, aunque logra un buen ajuste en general, tiene dificultades para capturar algunos puntos extremos o eventos inusuales en los datos. Esto podría estar relacionado con fluctuaciones bruscas o eventos no capturados por las variables explicativas.</p>
<p>En cuanto a la dispersión, se observa que los residuos están distribuidos de manera relativamente uniforme a lo largo de los trimestres, lo que sugiere que no hay un deterioro evidente del modelo en ningún periodo específico. Sin embargo, los outliers en cada trimestre indican que, en algunos casos, las predicciones del modelo difieren significativamente de los valores reales, lo que puede impactar su precisión en situaciones específicas.</p>
<p>El segundo gráfico presenta las funciones de ACF (Autocorrelation Function) y PACF (Partial Autocorrelation Function) de los residuos del entrenamiento. El análisis del ACF muestra que la mayoría de las correlaciones de los residuos con sus rezagos están dentro de las bandas de confianza, lo que es positivo, ya que indica que no hay patrones de autocorrelación fuertes en los residuos. Esto sugiere que el modelo ha capturado la mayor parte de la estructura temporal de los datos. No obstante, se observa una leve autocorrelación significativa en el primer rezago, lo que podría indicar que hay alguna dependencia a corto plazo que no ha sido completamente modelada.</p>
<p>El gráfico de PACF, por su parte, refuerza esta observación, ya que también muestra un pico significativo en el primer rezago. Si bien no hay autocorrelaciones significativas en rezagos posteriores, este comportamiento en el primer rezago sugiere que el modelo podría beneficiarse de ajustes adicionales para capturar mejor las relaciones a corto plazo en los datos.</p>
<p>Finalmente, el Estadístico de Jarque-Bera, con un valor de 1409.1862 y un valor p de 0.0000, aporta información crucial sobre la normalidad de los residuos. Este resultado significativo indica que los residuos no siguen una distribución normal, lo que confirma que presentan una desviación respecto a la normalidad. Esta desviación podría estar vinculada con los outliers observados en el boxplot y las leves autocorrelaciones vistas en los gráficos de ACF y PACF. Este comportamiento sugiere que el modelo no captura perfectamente todas las características de los datos, especialmente en situaciones extremas, y que podría requerir ajustes adicionales para mejorar su precisión en esos casos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="c1"># Calcular los residuos en el conjunto de prueba para el modelo híbrido</span>
<span class="n">residuals_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">forecast_hybrid</span>

<span class="c1"># Prueba de Jarque-Bera para la normalidad de los residuos en el conjunto de prueba</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estadístico de Jarque-Bera: </span><span class="si">{</span><span class="n">jb_stat</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, Valor p: </span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Prueba de Ljung-Box para la autocorrelación de los residuos</span>
<span class="c1"># Nota: Selecciona el número de lags deseado, en este caso, lags=10</span>
<span class="n">ljung_box_result</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals_test</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ljung_box_stat</span> <span class="o">=</span> <span class="n">ljung_box_result</span><span class="p">[</span><span class="s1">&#39;lb_stat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ljung_box_p_value</span> <span class="o">=</span> <span class="n">ljung_box_result</span><span class="p">[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estadístico de Ljung-Box (lag=10): </span><span class="si">{</span><span class="n">ljung_box_stat</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, Valor p: </span><span class="si">{</span><span class="n">ljung_box_p_value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Estadístico de Jarque-Bera: 75.6238, Valor p: 0.0000
Estadístico de Ljung-Box (lag=10): 9.6864, Valor p: 0.4684
</pre></div>
</div>
</div>
</div>
<p>El estadístico de Jarque-Bera es 1409.1862, con un valor p de 0.0000. Esto indica que se rechaza la hipótesis nula de normalidad en los residuos. En otras palabras, los residuos no siguen una distribución normal, lo cual puede ser un indicio de que el modelo no captura completamente todas las características subyacentes de los datos. Esta falta de normalidad podría sugerir la presencia de heterocedasticidad o la existencia de patrones en los datos que el modelo actual no está abordando adecuadamente.</p>
<p>Por otro lado, el estadístico de Ljung-Box, con un valor de 14.2836 y un valor p de 0.1604 para los primeros 10 rezagos, muestra que no hay suficiente evidencia para rechazar la hipótesis de independencia de los residuos en dichos rezagos. Esto es un resultado positivo, ya que indica que el modelo está capturando adecuadamente la estructura temporal de los datos, sin presentar autocorrelación significativa en los primeros rezagos.</p>
</section>
</section>
<hr class="docutils" />
<section class="tex2jax_ignore mathjax_ignore" id="eleccion-mejor-modelo">
<h1>Eleccion mejor modelo<a class="headerlink" href="#eleccion-mejor-modelo" title="Link to this heading">#</a></h1>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Modelo</p></th>
<th class="head"><p>MAE</p></th>
<th class="head"><p>RMSE</p></th>
<th class="head"><p>MSE</p></th>
<th class="head"><p>MAPE</p></th>
<th class="head"><p>R²</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SARIMA</p></td>
<td><p>21.08</p></td>
<td><p>31.85</p></td>
<td><p>1014.74</p></td>
<td><p>nan%</p></td>
<td><p>0.12</p></td>
</tr>
<tr class="row-odd"><td><p>Suavizado Exponencial</p></td>
<td><p>22.04</p></td>
<td><p>33.61</p></td>
<td><p>1129.33</p></td>
<td><p>16.59%</p></td>
<td><p>0.00</p></td>
</tr>
<tr class="row-even"><td><p>Holt-Winters</p></td>
<td><p>20.63</p></td>
<td><p>31.62</p></td>
<td><p>999.56</p></td>
<td><p>15.96%</p></td>
<td><p>0.13</p></td>
</tr>
<tr class="row-odd"><td><p>Red Neuronal Recurrente</p></td>
<td><p>23.60</p></td>
<td><p>33.65</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>0.22</p></td>
</tr>
<tr class="row-even"><td><p>MLP</p></td>
<td><p>15.88</p></td>
<td><p>22.63</p></td>
<td><p>-</p></td>
<td><p>13.80%</p></td>
<td><p>0.13</p></td>
</tr>
<tr class="row-odd"><td><p>LSTM</p></td>
<td><p>20.85</p></td>
<td><p>31.90</p></td>
<td><p>-</p></td>
<td><p>14.87%</p></td>
<td><p>-0.04</p></td>
</tr>
<tr class="row-even"><td><p><strong>Holt-Winters + MLP (Modelo Híbrido)</strong></p></td>
<td><p><strong>20.59</strong></p></td>
<td><p><strong>31.61</strong></p></td>
<td><p><strong>999.05</strong></p></td>
<td><p><strong>15.92%</strong></p></td>
<td><p><strong>0.13</strong></p></td>
</tr>
</tbody>
</table>
</div>
<p>Al analizar los resultados de la tabla, se observa que el modelo híbrido de Holt-Winters y MLP ofrece un rendimiento competitivo frente a otros modelos en la predicción de ventas diarias de pizza.</p>
<p>Primero, el MAE (Error Absoluto Medio) del modelo híbrido es de 20.59, lo que significa que el modelo se desvía, en promedio, en aproximadamente 20 pizzas diarias. Este valor es comparable al del modelo Holt-Winters y menor que el de otros modelos como el Suavizado Exponencial y la Red Neuronal Recurrente, que presentan errores absolutos promedio más altos. Este MAE relativamente bajo es favorable para una planificación operativa más precisa, especialmente en un negocio donde minimizar el error diario puede optimizar inventarios y reducir desperdicios.</p>
<p>En cuanto a la precisión general, el RMSE (Raíz del Error Cuadrático Medio) del modelo híbrido es de 31.61, mientras que el MSE (Error Cuadrático Medio) es de 999.05. Estos valores son competitivos y reflejan un buen control de errores en días de alta demanda, lo que es crucial en un entorno de ventas volátil. Si bien otros modelos, como el MLP, presentan un RMSE menor, el modelo híbrido mantiene un equilibrio entre precisión y capacidad de captura de la estacionalidad, lo cual es esencial en este contexto de predicción diaria.</p>
<p>El MAPE (Error Porcentual Absoluto Medio) del modelo híbrido es de 15.92%, lo cual indica que el modelo se desvía un 15.92% en promedio de las ventas reales. Este nivel de error es razonable para un entorno de ventas diarias que experimenta variaciones importantes y estacionales. Además, un MAPE por debajo del 20% es generalmente aceptable en modelos de ventas, lo que sugiere que el modelo híbrido proporciona predicciones adecuadas para necesidades de planificación estratégica.</p>
<p>El coeficiente de determinación (R²) del modelo híbrido es de 0.1264, lo que significa que el modelo explica aproximadamente el 12.64% de la variabilidad en las ventas. Si bien este valor podría parecer bajo, resulta comparable al R² obtenido por otros modelos, lo que destaca la dificultad intrínseca de capturar la variabilidad de ventas diarias. A medida que se incorporen más variables explicativas o se mejore el ajuste estacional, se espera que el R² aumente.</p>
<p>El modelo híbrido de Holt-Winters y MLP ofrece una metodología robusta y flexible que combina técnicas de suavizamiento estacional con aprendizaje profundo, capturando tanto patrones estacionales como fluctuaciones impredecibles. Esta combinación lo hace adecuado para predecir ventas influenciadas por cambios estacionales y factores externos.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="markdown.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Markdown Files</p>
      </div>
    </a>
    <a class="right-next"
       href="markdown-notebooks.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebooks with MyST Markdown</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">📊 Entrega del Trabajo Final</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jefry-llerena-y-david-lizcano">Jefry Llerena y David Lizcano</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asignatura-series-de-tiempo">Asignatura: Series de Tiempo</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#maestria-en-analitica-de-datos">Maestría en Analítica de Datos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">Análisis y Predicción de las Series Temporales de las Ventas de Pizza</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas">Análisis y Modelización de Ventas Diarias de Pizzas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducción</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-del-proyecto">Estructura del Proyecto</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-datos-10">1. Análisis Exploratorio de Datos (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark-20">2. Modelos Benchmark (20%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposicion-10">3. Exposición (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original-60">4. Modelo Original (60%)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-los-datos">Analisis exploratorio de los datos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-normalidad-y-grafico-boxplot-para-el-eda">Grafico de normalidad y grafico Boxplot para el EDA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-acf"><strong>Análisis de ACF:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-pacf"><strong>Análisis de PACF:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-final"><strong>Conclusión Final:</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prueba-shapiro-wilk-diagnostico-de-curtosis-y-otras-pruebas-de-estacionaliad">Prueba Shapiro Wilk, diagnostico de curtosis y otras pruebas de estacionaliad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-suavizacion-diaria-semanal-de-los-datos-y-grafico-de-medias-y-desviaciones-de-la-serie">Grafico de suavizacion diaria, semanal de los datos y grafico de medias y desviaciones de la serie</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark">Modelos benchmark</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-sarima">Modelo Sarima</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-for-utilizado">Ciclo for utilizado</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-residuos-del-entrenamiento">Analisis de los residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-residuos-de-la-prediccion">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-suavizado-exponencial">Modelo de suavizado exponencial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-for-utilizado-para-optimizar-ses">Ciclo for utilizado para optimizar SES</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-de-entrenamiento">Analisis de residuos de entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-de-la-prediccion">Analisis de residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-holtwinters">Modelo Holtwinters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Ciclo for utilizado</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-del-entrenamiento">Analisis de residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Analisis de residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-red-neuronal-recuerrente">Modelo red neuronal recuerrente</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-for-utilizado-para-optimizar-hiperparametros">Ciclo for utilizado para optimizar hiperparametros</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Analisis de los residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-mlp">Modelo MLP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ciclo-for-utilizado-para-optimizar-parametros">Ciclo for utilizado para optimizar parametros</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Analisis de los residuos de la prediccion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-lstm">Modelo LSTM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-residuos-del-entrenamiento">Analisis residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original">Modelo original</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#enfoque-hibrido-holt-winters-con-una-red-neuronal-de-perceptron-multicapa-mlp">Enfoque híbrido Holt-Winters con una red neuronal de perceptrón multicapa (MLP)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Analisis de los residuos del entrenamiento</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eleccion-mejor-modelo">Eleccion mejor modelo</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>