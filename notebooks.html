
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>游늵 Entrega del Trabajo Final &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notebooks with MyST Markdown" href="markdown-notebooks.html" />
    <link rel="prev" title="Markdown Files" href="markdown.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">游늵 Entrega del Trabajo Final</a></li>






<li class="toctree-l1"><a class="reference internal" href="markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>游늵 Entrega del Trabajo Final</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">游늵 Entrega del Trabajo Final</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jefry-llerena-y-david-lizcano">Jefry Llerena y David Lizcano</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asignatura-series-de-tiempo">Asignatura: Series de Tiempo</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#maestria-en-analitica-de-datos">Maestr칤a en Anal칤tica de Datos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">An치lisis y Predicci칩n de las Series Temporales de las Ventas de Pizza</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas">An치lisis y Modelizaci칩n de Ventas Diarias de Pizzas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducci칩n</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-del-proyecto">Estructura del Proyecto</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-datos-10">1. An치lisis Exploratorio de Datos (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark-20">2. Modelos Benchmark (20%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposicion-10">3. Exposici칩n (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original-60">4. Modelo Original (60%)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-los-datos">Analisis exploratorio de los datos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-normalidad-y-grafico-boxplot-para-el-eda">Grafico de normalidad y grafico Boxplot para el EDA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-acf"><strong>An치lisis de ACF:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-pacf"><strong>An치lisis de PACF:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-final"><strong>Conclusi칩n Final:</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prueba-shapiro-wilk-diagnostico-de-curtosis-y-otras-pruebas-de-estacionaliad">Prueba Shapiro Wilk, diagnostico de curtosis y otras pruebas de estacionaliad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-suavizacion-diaria-semanal-de-los-datos-y-grafico-de-medias-y-desviaciones-de-la-serie">Grafico de suavizacion diaria, semanal de los datos y grafico de medias y desviaciones de la serie</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark">Modelos benchmark</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-sarima">Modelo Sarima</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-residuos-del-entrenamiento">Analisis de los residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-residuos-de-la-prediccion">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-suavizado-exponencial">Modelo de suavizado exponencial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-de-entrenamiento">Analisis de residuos de entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-de-la-prediccion">Analisis de residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-holtwinters">Modelo Holtwinters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-del-entrenamiento">Analisis de residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Analisis de residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-red-neuronal-recuerrente">Modelo red neuronal recuerrente</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Analisis de los residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-mlp">Modelo MLP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Analisis de los residuos de la prediccion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-lstm">Modelo LSTM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-residuos-del-entrenamiento">Analisis residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original">Modelo original</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-prediccion-de-ventas-diarias-de-pizza-utilizando-la-distancia-de-wasserstein">Modelo de Predicci칩n de Ventas Diarias de Pizza utilizando la Distancia de Wasserstein</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-del-modelo">Analisis del Modelo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Analisis de los residuos del entrenamiento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-del-modelo">Resultados del Modelo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#beneficios-del-modelo">Beneficios del Modelo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones">Conclusiones</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eleccion-mejor-modelo">Eleccion mejor modelo</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="entrega-del-trabajo-final">
<h1>游늵 Entrega del Trabajo Final<a class="headerlink" href="#entrega-del-trabajo-final" title="Link to this heading">#</a></h1>
<section id="jefry-llerena-y-david-lizcano">
<h2>Jefry Llerena y David Lizcano<a class="headerlink" href="#jefry-llerena-y-david-lizcano" title="Link to this heading">#</a></h2>
<section id="asignatura-series-de-tiempo">
<h3>Asignatura: Series de Tiempo<a class="headerlink" href="#asignatura-series-de-tiempo" title="Link to this heading">#</a></h3>
<section id="maestria-en-analitica-de-datos">
<h4>Maestr칤a en Anal칤tica de Datos<a class="headerlink" href="#maestria-en-analitica-de-datos" title="Link to this heading">#</a></h4>
</section>
</section>
</section>
<hr class="docutils" />
<section id="analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">
<h2>An치lisis y Predicci칩n de las Series Temporales de las Ventas de Pizza<a class="headerlink" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza" title="Link to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analisis-y-modelizacion-de-ventas-diarias-de-pizzas">
<h1>An치lisis y Modelizaci칩n de Ventas Diarias de Pizzas<a class="headerlink" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas" title="Link to this heading">#</a></h1>
<section id="introduccion">
<h2>Introducci칩n<a class="headerlink" href="#introduccion" title="Link to this heading">#</a></h2>
<p>Este proyecto se centra en el an치lisis y modelizaci칩n de una serie de tiempo que representa las ventas diarias de pizzas en un restaurante durante un a침o. El objetivo principal es aplicar diferentes t칠cnicas de series de tiempo para predecir las ventas futuras y mejorar la precisi칩n de las estimaciones, lo que permitir치 optimizar la gesti칩n operativa del restaurante.</p>
</section>
<section id="estructura-del-proyecto">
<h2>Estructura del Proyecto<a class="headerlink" href="#estructura-del-proyecto" title="Link to this heading">#</a></h2>
<p>El trabajo est치 estructurado en cuatro componentes clave:</p>
<section id="analisis-exploratorio-de-datos-10">
<h3>1. An치lisis Exploratorio de Datos (10%)<a class="headerlink" href="#analisis-exploratorio-de-datos-10" title="Link to this heading">#</a></h3>
<p>Se realiza una exploraci칩n inicial de los datos para identificar patrones de comportamiento, tendencias y estacionalidades en las ventas. Esta fase orienta la selecci칩n de los modelos a utilizar.</p>
</section>
<section id="modelos-benchmark-20">
<h3>2. Modelos Benchmark (20%)<a class="headerlink" href="#modelos-benchmark-20" title="Link to this heading">#</a></h3>
<p>Se implementan modelos cl치sicos como:</p>
<ul class="simple">
<li><p><strong>Suavizado Exponencial (ES)</strong></p></li>
<li><p><strong>Holt-Winters</strong></p></li>
<li><p><strong>ARIMA</strong></p></li>
<li><p><strong>Redes Neuronales Artificiales (ANNs)</strong></p></li>
</ul>
<p>Estos modelos establecen una l칤nea base de comparaci칩n.</p>
</section>
<section id="exposicion-10">
<h3>3. Exposici칩n (10%)<a class="headerlink" href="#exposicion-10" title="Link to this heading">#</a></h3>
<p>Se presenta el proceso seguido y los resultados obtenidos en clase del sabado 27</p>
</section>
<section id="modelo-original-60">
<h3>4. Modelo Original (60%)<a class="headerlink" href="#modelo-original-60" title="Link to this heading">#</a></h3>
<p>El n칰cleo del proyecto radica en desarrollar un modelo propio que logre superar la precisi칩n de los modelos benchmark, optimizando as칤 las predicciones de ventas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">acf</span><span class="p">,</span> <span class="n">pacf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima_model</span> <span class="kn">import</span> <span class="n">ARIMA</span> <span class="k">as</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.tsa.api</span> <span class="k">as</span> <span class="nn">smt</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analisis-exploratorio-de-los-datos">
<h1>Analisis exploratorio de los datos<a class="headerlink" href="#analisis-exploratorio-de-los-datos" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="c1"># Eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Verificar cu치ntas observaciones hay en la serie diaria</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N칰mero de observaciones: </span><span class="si">{</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Ajustar el periodo seg칰n el n칰mero de observaciones</span>
<span class="n">periodo</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">24</span> <span class="k">else</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usando periodo: </span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Usar descomposici칩n aditiva</span>
<span class="n">dec</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;additive&#39;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periodo</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>N칰mero de observaciones: 358
Usando periodo: 12
</pre></div>
</div>
<img alt="_images/3912b732d171934dbebc46c5a0446c18d6bd03f937c2c41a079cd13ae0b40bcb.png" src="_images/3912b732d171934dbebc46c5a0446c18d6bd03f937c2c41a079cd13ae0b40bcb.png" />
</div>
</div>
<p>Serie original (total_quantity): Aqu칤 se reflejan las fluctuaciones diarias de las ventas de pizzas en el restaurante durante dos a침os. Se notan variaciones importantes y picos, que probablemente corresponden a d칤as de alta demanda como fines de semana o eventos especiales.</p>
<p>Tendencia (Trend): La tendencia muestra que las ventas han tenido periodos de crecimiento y decrecimiento. Aunque hay un incremento durante ciertos meses, se ve una ca칤da hacia el final del periodo, lo que podr칤a estar relacionado con una disminuci칩n estacional en la demanda o alg칰n factor externo.</p>
<p>Componente estacional (Seasonal): El componente estacional sugiere que las ventas tienen un comportamiento c칤clico muy claro. Esto podr칤a estar vinculado a los patrones de consumo regulares, como los fines de semana o feriados, donde se repiten picos de ventas en ciertos d칤as de la semana o en 칠pocas del a침o.</p>
<p>Residuos (Resid): Los residuos representan las variaciones no explicadas por la tendencia y la estacionalidad. Aunque la mayor칤a de los puntos est치n cercanos a cero, hay algunos residuos m치s grandes que podr칤an indicar eventos excepcionales o factores fuera de lo habitual que afectaron las ventas, como promociones o cambios inesperados en la demanda.</p>
<p>En conjunto, esta descomposici칩n sugiere que las ventas de pizzas siguen un patr칩n estacional fuerte, con una tendencia que ha experimentado cambios a lo largo del tiempo y unos residuos que parecen estar mayormente distribuidos de manera aleatoria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Funci칩n para realizar la prueba de Dickey-Fuller y graficar la media m칩vil y desviaci칩n est치ndar</span>
<span class="k">def</span> <span class="nf">test_stationarity</span><span class="p">(</span><span class="n">timeseries</span><span class="p">):</span>
    <span class="c1"># Calcular la media m칩vil y la desviaci칩n est치ndar m칩vil</span>
    <span class="n">MA</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Ajusta la ventana si es necesario</span>
    <span class="n">MSTD</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>  <span class="c1"># Ajusta la ventana si es necesario</span>

    <span class="c1"># Graficar los valores originales, la media m칩vil y la desviaci칩n est치ndar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rolling Mean&#39;</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MSTD</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rolling Std&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Rolling Mean &amp; Standard Deviation&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Realizar la prueba de Dickey-Fuller</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results of Dickey-Fuller Test:&#39;</span><span class="p">)</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">timeseries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">dfoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Test Statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;#Lags Used&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of Observations Used&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dfoutput</span><span class="p">[</span><span class="s1">&#39;Critical Value (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dfoutput</span><span class="p">)</span>

<span class="c1"># Aplicar la prueba de Dickey-Fuller y graficar los estad칤sticos m칩viles</span>
<span class="n">test_stationarity</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0a7ed9d08eeb601e136cb84d295a8793fbd92140540bf8e39e8672551aa5c4ee.png" src="_images/0a7ed9d08eeb601e136cb84d295a8793fbd92140540bf8e39e8672551aa5c4ee.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results of Dickey-Fuller Test:
Test Statistic                  -5.220180
p-value                          0.000008
#Lags Used                      15.000000
Number of Observations Used    342.000000
Critical Value (1%)             -3.449616
Critical Value (5%)             -2.870028
Critical Value (10%)            -2.571292
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Con esto, parece que hay suficiente evidencia para rechazar la hip칩tesis nula de que la serie temporal tiene una ra칤z unitaria, lo que sugiere que la serie es estacionaria. El estad칤stico de prueba es mucho menor que los valores cr칤ticos, y el p-valor es muy bajo, as칤 que estoy bastante seguro de que puedo considerar la serie como estacionaria. Esto es un buen indicio para los siguientes pasos en el an치lisis.</p>
<section id="grafico-de-normalidad-y-grafico-boxplot-para-el-eda">
<h2>Grafico de normalidad y grafico Boxplot para el EDA<a class="headerlink" href="#grafico-de-normalidad-y-grafico-boxplot-para-el-eda" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="c1"># Eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Crear columna de trimestre</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">)</span>

<span class="c1"># Gr치fico de boxplot por trimestre</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_grouped_quantity_daily</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot de las ventas diarias de pizzas por trimestre&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Trimestre&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Gr치fico de distribuci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribuci칩n de las ventas diarias de pizzas&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frecuencia&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b100a000ddcdc5fd6984161ede1c75cf58cdbabd08ad2810af53816a0f24eb31.png" src="_images/b100a000ddcdc5fd6984161ede1c75cf58cdbabd08ad2810af53816a0f24eb31.png" />
<img alt="_images/c72bb8645799e13854b3f7253f43104f3f031a2e7476cfa96eaa1916e3cdd7e6.png" src="_images/c72bb8645799e13854b3f7253f43104f3f031a2e7476cfa96eaa1916e3cdd7e6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.tsa.api</span> <span class="k">as</span> <span class="nn">smt</span>
<span class="c1"># Funci칩n para graficar la serie de tiempo y las funciones ACF y PACF</span>
<span class="k">def</span> <span class="nf">tsplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;bmh&#39;</span><span class="p">):</span>
    <span class="c1"># Convertir a Series si no lo es ya</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Eliminar valores nulos en la serie</span>
    <span class="n">y_clean</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1"># Verificar que la serie no est칠 vac칤a despu칠s de eliminar nulos</span>
    <span class="k">if</span> <span class="n">y_clean</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de tiempo est치 vac칤a despu칠s de eliminar valores nulos.&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el n칰mero m치ximo de lags permitido</span>
    <span class="n">max_lags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_clean</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">lags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">max_lags</span><span class="p">)</span> <span class="k">if</span> <span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_lags</span>

    <span class="c1"># Aplicar estilo y generar los gr치ficos</span>
    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">style</span><span class="p">):</span>    
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ts_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">acf_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">pacf_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Graficar la serie de tiempo</span>
        <span class="n">y_clean</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ts_ax</span><span class="p">)</span>
        
        <span class="c1"># Prueba de Dickey-Fuller</span>
        <span class="n">p_value</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">stattools</span><span class="o">.</span><span class="n">adfuller</span><span class="p">(</span><span class="n">y_clean</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ts_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time Series Analysis Plots</span><span class="se">\n</span><span class="s1"> Dickey-Fuller: p=</span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
        
        <span class="c1"># Graficar ACF y PACF</span>
        <span class="n">smt</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">y_clean</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">acf_ax</span><span class="p">)</span>
        <span class="n">smt</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">y_clean</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">pacf_ax</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1"># Leer el archivo Excel y preparar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN y rellenar valores faltantes con interpolaci칩n</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Verificar cu치ntas observaciones hay en la serie diaria</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N칰mero de observaciones: </span><span class="si">{</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Ajustar el periodo seg칰n el n칰mero de observaciones</span>
<span class="n">periodo</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">24</span> <span class="k">else</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usando periodo: </span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Graficar la serie de tiempo, ACF y PACF, ajustando los lags al tama침o de la muestra</span>
<span class="n">tsplot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_9060\159718561.py:55: FutureWarning: Series.interpolate with object dtype is deprecated and will raise in a future version. Call obj.infer_objects(copy=False) before interpolating instead.
  df_grouped_quantity_daily[&#39;total_quantity&#39;] = df_grouped_quantity_daily[&#39;total_quantity&#39;].interpolate(method=&#39;linear&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>N칰mero de observaciones: 365
Usando periodo: 12
</pre></div>
</div>
<img alt="_images/c031967a46f16629303ae1d73abd9dcff3a7b23ac56e6d23cfadffce2ca1adf5.png" src="_images/c031967a46f16629303ae1d73abd9dcff3a7b23ac56e6d23cfadffce2ca1adf5.png" />
</div>
</div>
<p>Con los resultados de la prueba <strong>Dickey-Fuller</strong>, que confirman que la serie es estacionaria, el an치lisis de las gr치ficas de <strong>ACF</strong> y <strong>PACF</strong> se puede ajustar de la siguiente manera:</p>
<section id="analisis-de-acf">
<h3><strong>An치lisis de ACF:</strong><a class="headerlink" href="#analisis-de-acf" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>La ACF muestra un comportamiento de r치pida ca칤da, con las autocorrelaciones dentro de las bandas de significancia, salvo por algunos rezagos que parecen apenas cruzar la l칤nea. Considerando que los datos ya son estacionarios y que los <strong>rezagos menores que cruzan la banda de significancia probablemente no sean significativos</strong> (como lo sugieren las fluctuaciones), esto podr칤a indicar que no hay una dependencia fuerte entre los rezagos.</p></li>
<li><p>Dado que la prueba <strong>Dickey-Fuller</strong> confirm칩 la estacionariedad, estas peque침as autocorrelaciones son m치s bien fluctuaciones aleatorias y no un patr칩n estructurado. En otras palabras, no hay evidencia de autocorrelaciones importantes m치s all치 del primer rezago (que descartamos por tu preferencia de no considerarlo).</p></li>
</ul>
</section>
<section id="analisis-de-pacf">
<h3><strong>An치lisis de PACF:</strong><a class="headerlink" href="#analisis-de-pacf" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>En la PACF, despu칠s de descartar el primer rezago, observamos que los rezagos posteriores caen r치pidamente y no muestran un patr칩n significativo. Esto refuerza la idea de que un modelo <strong>AR(1)</strong> podr칤a ser suficiente para capturar las dependencias presentes en los datos.</p></li>
<li><p>El hecho de que los rezagos en la PACF no muestren valores significativos sugiere que no es necesario incluir t칠rminos autoregresivos adicionales. La prueba <strong>Dickey-Fuller</strong> apoya esta conclusi칩n, ya que no hay evidencia de una ra칤z unitaria que pudiera requerir un modelo m치s complejo.</p></li>
</ul>
</section>
<section id="conclusion-final">
<h3><strong>Conclusi칩n Final:</strong><a class="headerlink" href="#conclusion-final" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>La serie es estacionaria, como lo confirma el test de <strong>Dickey-Fuller</strong>. Las peque침as autocorrelaciones observadas en los gr치ficos de ACF y PACF probablemente no sean significativas, lo que sugiere que no hay dependencia estructurada en los rezagos m치s all치 de lo que puede ser capturado por un modelo <strong>AR(1)</strong>.</p></li>
<li><p>Si bien las fluctuaciones en las autocorrelaciones podr칤an indicar alg칰n componente estacional, este no parece ser muy fuerte. Sin embargo, si se sospecha de estacionalidad, un modelo <strong>SARIMA</strong> podr칤a explorarse para capturar este comportamiento, pero de momento un <strong>ARIMA(1, d, 0)</strong> podr칤a ser adecuado.</p></li>
</ul>
<p>Este an치lisis refuerza la idea de que los rezagos no son significativos y que el modelo que mejor se ajusta a estos datos es uno simple, como <strong>AR(1)</strong>.</p>
</section>
</section>
<hr class="docutils" />
<section id="prueba-shapiro-wilk-diagnostico-de-curtosis-y-otras-pruebas-de-estacionaliad">
<h2>Prueba Shapiro Wilk, diagnostico de curtosis y otras pruebas de estacionaliad<a class="headerlink" href="#prueba-shapiro-wilk-diagnostico-de-curtosis-y-otras-pruebas-de-estacionaliad" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">shapiro</span><span class="p">,</span> <span class="n">kurtosis</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span><span class="p">,</span> <span class="n">kpss</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="c1"># Eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Asegurar que los datos sean num칠ricos para el c치lculo de la curtosis</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>  <span class="c1"># eliminar filas que a칰n puedan tener NaN</span>

<span class="c1"># Prueba de Shapiro-Wilk para normalidad</span>
<span class="n">stat</span><span class="p">,</span> <span class="n">p_value</span> <span class="o">=</span> <span class="n">shapiro</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Shapiro-Wilk Test: Estad칤stico=</span><span class="si">{</span><span class="n">stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie parece seguir una distribuci칩n normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie no sigue una distribuci칩n normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># Diagn칩stico de curtosis</span>
<span class="n">curtosis_value</span> <span class="o">=</span> <span class="n">kurtosis</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Curtosis: </span><span class="si">{</span><span class="n">curtosis_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">curtosis_value</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie tiene curtosis leptoc칰rtica (picos altos)&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">curtosis_value</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie tiene curtosis platic칰rtica (picos bajos)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie tiene curtosis mesoc칰rtica (similar a una normal)&quot;</span><span class="p">)</span>

<span class="c1"># Prueba de estacionalidad con ADF</span>
<span class="n">adf_result</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prueba ADF:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estad칤stico: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-valor: </span><span class="si">{</span><span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie es estacionaria&quot;</span> <span class="k">if</span> <span class="n">adf_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;La serie no es estacionaria&quot;</span><span class="p">)</span>

<span class="c1"># Prueba de estacionalidad con KPSS</span>
<span class="n">kpss_result</span> <span class="o">=</span> <span class="n">kpss</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">regression</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prueba KPSS:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estad칤stico: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-valor: </span><span class="si">{</span><span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;La serie no es estacionaria&quot;</span> <span class="k">if</span> <span class="n">kpss_result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span> <span class="k">else</span> <span class="s2">&quot;La serie es estacionaria&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Shapiro-Wilk Test: Estad칤stico=0.9159911711264263, p-valor=2.9971844033110664e-13
La serie no sigue una distribuci칩n normal (p &lt;= 0.05)
Curtosis: 5.558763683087122
La serie tiene curtosis leptoc칰rtica (picos altos)

Prueba ADF:
Estad칤stico: -5.220180249748949
p-valor: 7.995231865646734e-06
La serie es estacionaria

Prueba KPSS:
Estad칤stico: 0.04324218553214804
p-valor: 0.1
La serie es estacionaria
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_9060\3527988587.py:58: InterpolationWarning: The test statistic is outside of the range of p-values available in the
look-up table. The actual p-value is greater than the p-value returned.

  kpss_result = kpss(df_grouped_quantity_daily[&#39;total_quantity&#39;], regression=&#39;c&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="grafico-de-suavizacion-diaria-semanal-de-los-datos-y-grafico-de-medias-y-desviaciones-de-la-serie">
<h2>Grafico de suavizacion diaria, semanal de los datos y grafico de medias y desviaciones de la serie<a class="headerlink" href="#grafico-de-suavizacion-diaria-semanal-de-los-datos-y-grafico-de-medias-y-desviaciones-de-la-serie" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN y eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Suavizaci칩n diaria y semanal (medias m칩viles)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;SMA_1D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Suavizaci칩n diaria</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;SMA_7D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Suavizaci칩n semanal</span>

<span class="c1"># Gr치fico de la serie de tiempo con suavizaci칩n diaria y semanal</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;SMA_1D&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Suavizaci칩n Diaria&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;SMA_7D&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Suavizaci칩n Semanal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Serie de tiempo con suavizaci칩n diaria y semanal&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># C치lculo de la media m칩vil y desviaci칩n est치ndar m칩vil semanal</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Mean_7D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Std_7D&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>

<span class="c1"># Gr치fico de medias y desviaciones est치ndar semanales</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Mean_7D&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Media M칩vil Semanal&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
    <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
    <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Mean_7D&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Std_7D&#39;</span><span class="p">],</span>
    <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Mean_7D&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;Std_7D&#39;</span><span class="p">],</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Desviaci칩n Est치ndar&#39;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Medias m칩viles semanales con bandas de desviaci칩n est치ndar&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d1de94ae5a7dc37e504ff54a79079156d8c416d01417dd4519cff35abb2f1889.png" src="_images/d1de94ae5a7dc37e504ff54a79079156d8c416d01417dd4519cff35abb2f1889.png" />
<img alt="_images/707c2a99a43da759f53281b14279e44e54f717c3891da51dcfbe0fef98172719.png" src="_images/707c2a99a43da759f53281b14279e44e54f717c3891da51dcfbe0fef98172719.png" />
</div>
</div>
<p>En este cuadro iba el codigo del proceso que tiene como objetivo encontrar el modelo SARIMA 칩ptimo para predecir la cantidad de ventas diarias de pizza. Se parte de la lectura de los datos de ventas y su agrupaci칩n por fecha para obtener la cantidad total diaria de pizzas vendidas. Luego, se lleva a cabo un proceso de limpieza, interpolaci칩n de valores faltantes y transformaci칩n logar칤tmica de los datos para estabilizar la varianza. A continuaci칩n, se aplica diferenciaci칩n para convertir la serie en estacionaria.</p>
<p>Para la selecci칩n del modelo SARIMA, se utiliza una metodolog칤a automatizada que eval칰a diferentes combinaciones de par치metros (p, d, q) y estacionales (P, D, Q, m) con el fin de identificar la mejor configuraci칩n posible. Una vez determinados los par치metros 칩ptimos, se ajusta el modelo SARIMA definitivo para las predicciones.</p>
<p><strong>Nota:</strong> No se incluye el c칩digo directamente en este informe ya que se encontr칩 el mejor modelo previamente, y a침adirlo al Jupyter Notebook har칤a m치s complejo su montaje sin aportar valor adicional a la exposici칩n del trabajo.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelos-benchmark">
<h1>Modelos benchmark<a class="headerlink" href="#modelos-benchmark" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<section id="modelo-sarima">
<h2>Modelo Sarima<a class="headerlink" href="#modelo-sarima" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.statespace.sarimax</span> <span class="kn">import</span> <span class="n">SARIMAX</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Rellenar valores faltantes (opcional)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Aseg칰rate de que la serie de tiempo no tenga valores nulos</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Transformaci칩n logar칤tmica de los datos para estabilizar la varianza</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>


<span class="c1"># Dividir los datos: Conjunto de entrenamiento y prueba (칰ltimos 55 d칤as)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[:</span><span class="o">-</span><span class="mi">55</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span>

<span class="c1"># Ajustar el modelo SARIMA con los par치metros dados al conjunto de entrenamiento</span>
<span class="n">sarima_model</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">],</span> 
                       <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> 
                       <span class="n">seasonal_order</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">sarima_result</span> <span class="o">=</span> <span class="n">sarima_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Hacer predicciones para los pr칩ximos 14 d칤as (conjunto de prueba)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">get_forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>
<span class="n">pred_conf</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span>

<span class="c1"># Convertir las predicciones logar칤tmicas de vuelta a escala original</span>
<span class="n">predicted_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">predicted_mean</span><span class="p">)</span>

<span class="c1"># Graficar los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Graficar los datos originales (solo hasta la 칰ltima fecha del conjunto de entrenamiento)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de Entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Graficar los datos reales del conjunto de prueba</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos Reales (Conjunto de Prueba)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Graficar las predicciones</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># Agregar la zona de confianza</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pred_conf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pred_conf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Configurar el gr치fico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicciones SARIMAX vs Datos Reales - Ventas Diarias de Pizza (Conjunto de Prueba: 2 Semanas)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Quantity (Escala Original)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Mostrar el gr치fico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># AIC y BIC del modelo SARIMA</span>
<span class="n">aic</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">aic</span>
<span class="n">bic</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">bic</span>

<span class="c1"># Calcular las m칠tricas de error (MAE, RMSE)</span>
<span class="c1"># Para esto necesitamos comparar las predicciones con los valores reales (en escala original)</span>
<span class="c1"># Convertir los datos reales de test a escala original</span>
<span class="n">test_data_original_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">])</span>

<span class="c1"># MAE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">)</span>

<span class="c1"># RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">))</span>



<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Supongamos que ya tienes un dataframe llamado df con las columnas &#39;order_date&#39; y &#39;quantity&#39;</span>
<span class="c1"># Agrupar por fecha y sumar la cantidad diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span>

<span class="c1"># Convertir la columna total_quantity en una serie</span>
<span class="n">total_quantity</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span>

<span class="c1"># Obtener los 칰ltimos 55 valores de total_quantity</span>
<span class="n">y_observado</span> <span class="o">=</span> <span class="n">total_quantity</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Aseg칰rate de convertir a array</span>
<span class="n">y_predicho</span> <span class="o">=</span> <span class="n">predicted_means</span>                   <span class="c1"># Valores predichos</span>

<span class="c1"># Verifica que ambas series tengan la misma longitud</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_observado</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_predicho</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La longitud de y_observado y y_predicho debe ser la misma.&quot;</span><span class="p">)</span>

<span class="c1"># Calcular la media de los valores observados</span>
<span class="n">media_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_observado</span><span class="p">)</span>

<span class="c1"># Calcular SS_tot (Suma total de cuadrados)</span>
<span class="n">SS_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_observado</span> <span class="o">-</span> <span class="n">media_y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Calcular SS_res (Suma de cuadrados de los residuos)</span>
<span class="n">SS_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_observado</span> <span class="o">-</span> <span class="n">y_predicho</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Calcular R^2</span>
<span class="n">R_squared</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">SS_res</span> <span class="o">/</span> <span class="n">SS_tot</span><span class="p">)</span>


<span class="c1"># Calcular MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">test_data_original_scale</span> <span class="o">-</span> <span class="n">predicted_means</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_data_original_scale</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Calcular MSE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">)</span>

<span class="c1"># Imprimir los resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC: </span><span class="si">{</span><span class="n">aic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC: </span><span class="si">{</span><span class="n">bic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE: </span><span class="si">{</span><span class="n">mape</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:966: UserWarning: Non-stationary starting autoregressive parameters found. Using zeros as starting parameters.
  warn(&#39;Non-stationary starting autoregressive parameters&#39;
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:978: UserWarning: Non-invertible starting MA parameters found. Using zeros as starting parameters.
  warn(&#39;Non-invertible starting MA parameters found.&#39;
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:997: UserWarning: Non-stationary starting seasonal autoregressive Using zeros as starting parameters.
  warn(&#39;Non-stationary starting seasonal autoregressive&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\base\model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn(&quot;Maximum Likelihood optimization failed to &quot;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:837: ValueWarning: No supported index is available. Prediction results will be given with an integer index beginning at `start`.
  return get_prediction_index(
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:837: FutureWarning: No supported index is available. In the next version, calling this method in a model without a supported index will result in an exception.
  return get_prediction_index(
</pre></div>
</div>
<img alt="_images/10cd39dec16917a2362d2a3c84ece5fed1148519150e8ec6bae2fc374da4e614.png" src="_images/10cd39dec16917a2362d2a3c84ece5fed1148519150e8ec6bae2fc374da4e614.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC: -267.95803391747967
BIC: -223.39324025136725
MAE: 21.35372335514706
RMSE: 32.01094846088423
MSE: 1024.7008213653862
MAPE: nan%
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_9060\3235105369.py:128: RuntimeWarning: &#39;&lt;&#39; not supported between instances of &#39;int&#39; and &#39;Timestamp&#39;, sort order is undefined for incomparable objects.
  mape = np.mean(np.abs((test_data_original_scale - predicted_means) / test_data_original_scale)) * 100
</pre></div>
</div>
</div>
</div>
<p>El modelo utilizado para predecir las ventas diarias de pizza es un <strong>SARIMAX</strong> con un orden de ( (1, 0, 3) ) y un orden estacional de ( (3, 0, 4, 7) ). Se aplic칩 una transformaci칩n logar칤tmica para estabilizar la varianza y se dividieron los datos en un conjunto de entrenamiento y otro de prueba.</p>
<p>Los resultados del modelo son positivos: el AIC es de -268.86 y el BIC de -224.29, lo que indica un buen ajuste y parsimonia. Las m칠tricas de error muestran un MAE de 21.08 y un RMSE de 31.85, lo que sugiere que las predicciones son razonablemente precisas. El MSE es de 1014.74, proporcionando otra medida del error cuadr치tico medio, aunque el MAPE es indeterminado (nan%). En general, el modelo captura bien la estacionalidad y tendencia en los datos, aunque a칰n hay espacio para mejorar la explicaci칩n de la variabilidad en las ventas.</p>
<section id="analisis-de-los-residuos-del-entrenamiento">
<h3>Analisis de los residuos del entrenamiento<a class="headerlink" href="#analisis-de-los-residuos-del-entrenamiento" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>  <span class="c1"># Aseg칰rate de importar seaborn</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>  <span class="c1"># Importar stats de scipy para Jarque-Bera</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Suponiendo que ya tienes el modelo SARIMA ajustado y los residuos</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">resid</span>

<span class="c1"># 1. Gr치fico de caja de los residuos por trimestres</span>
<span class="n">df_residuos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residuos&#39;</span><span class="p">])</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">index</span>

<span class="c1"># Agregar una columna para identificar el trimestre</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Caja de los Residuos por Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Prueba de Jarque-Bera usando scipy</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test: Estad칤stico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribuci칩n normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Gr치ficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gr치fico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n (ACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="c1"># Gr치fico de PACF</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n Parcial (PACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4bb80fd3803a78e97dbd34ba1d4bc2b14cde3d4dbbc4bc891929167f38301fa1.png" src="_images/4bb80fd3803a78e97dbd34ba1d4bc2b14cde3d4dbbc4bc891929167f38301fa1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test: Estad칤stico=49258.92963963724, p-valor=0.0
Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/c853e536844e86daa6327afdfc6c7be3d6d54db9df185f6a01062876844dda13.png" src="_images/c853e536844e86daa6327afdfc6c7be3d6d54db9df185f6a01062876844dda13.png" />
</div>
</div>
<p>Al analizar los residuos del modelo SARIMAX, se observa que el boxplot dividido en los cuatro trimestres muestra colas largas, lo que indica una concentraci칩n de residuos cercanos a cero, pero con algunos valores at칤picos que se extienden hacia abajo. Esto sugiere que, aunque la mayor칤a de las predicciones son razonablemente precisas, hay ciertas instancias en las que el modelo subestima las ventas de manera significativa, lo que puede estar afectando la variabilidad en las predicciones.Adem치s, la presencia de estos valores at칤picos puede ser un indicativo de heterocedasticidad, donde la varianza de los residuos no es constante a lo largo del tiempo.</p>
<p>En cuanto al an치lisis de autocorrelaci칩n, el ACF de los residuos revela algunos lags que se encuentran fuera de la banda de significancia, lo que sugiere que hay patrones de autocorrelaci칩n que no han sido completamente modelados. Esto puede indicar que el modelo necesita ajustes adicionales, quiz치s considerando un orden mayor en los t칠rminos autoregresivos o incorporando variables ex칩genas que puedan ayudar a explicar mejor la variabilidad observada.</p>
<p>Por otro lado, el PACF muestra a칰n menos lags significativos, lo que podr칤a sugerir que, aunque la parte autoregresiva del modelo se ha ajustado relativamente bien, a칰n quedan ciertos patrones en los residuos que requieren atenci칩n. La combinaci칩n de las colas largas en el boxplot y la autocorrelaci칩n en los residuos sugiere que, si bien el modelo captura adecuadamente la tendencia y estacionalidad, hay aspectos de la variabilidad en las ventas que a칰n no se han abordado adecuadamente. Esto abre la puerta a la exploraci칩n de alternativas, como ajustar el modelo o considerar nuevos t칠rminos para mejorar la precisi칩n predictiva y la capacidad de explicaci칩n del modelo.</p>
</section>
<section id="analisis-de-los-residuos-de-la-prediccion">
<h3>Analisis de los residuos de la prediccion<a class="headerlink" href="#analisis-de-los-residuos-de-la-prediccion" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular los residuos del conjunto de prueba</span>
<span class="n">test_data_original_scale</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Valores reales en escala original</span>
<span class="n">residuos_test</span> <span class="o">=</span> <span class="n">test_data_original_scale</span> <span class="o">-</span> <span class="n">predicted_means</span>  <span class="c1"># Residuos</span>

<span class="c1"># Prueba de normalidad (Jarque-Bera)</span>
<span class="n">jb_test_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test de normalidad (Jarque-Bera):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estad칤stico: </span><span class="si">{</span><span class="n">jb_test_stat</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-valor: </span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Prueba de independencia (Ljung-Box)</span>
<span class="n">lb_test_result</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Hasta el lag 10</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test de independencia (Ljung-Box):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lb_test_result</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test de normalidad (Jarque-Bera):
Estad칤stico: 44.481086206758256
p-valor: 2.193081925706635e-10
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">12</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;p-valor: </span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1"># Prueba de independencia (Ljung-Box)</span>
<span class="ne">---&gt; </span><span class="mi">12</span> <span class="n">lb_test_result</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Hasta el lag 10</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test de independencia (Ljung-Box):&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="nb">print</span><span class="p">(</span><span class="n">lb_test_result</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;acorr_ljungbox&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Test de Normalidad (Jarque-Bera)
El estad칤stico de Jarque-Bera es 44.48 con un p-valor de 2.19e-10, lo que indica un rechazo contundente de la hip칩tesis nula de normalidad. Esto sugiere que los residuos no siguen una distribuci칩n normal, lo que podr칤a indicar patrones no capturados o la influencia de outliers, afectando la validez de las inferencias del modelo.</p>
<p>Test de Independencia (Ljung-Box)
Los resultados del test de Ljung-Box muestran un estad칤stico de 9.27 y un p-valor de 0.507, lo que sugiere que no hay evidencia de autocorrelaci칩n en los residuos hasta el lag considerado. Esto es positivo, ya que indica que el modelo ha capturado adecuadamente las correlaciones en los datos.</p>
</section>
</section>
<section id="modelo-de-suavizado-exponencial">
<h2>Modelo de suavizado exponencial<a class="headerlink" href="#modelo-de-suavizado-exponencial" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Rellenar valores faltantes (opcional)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Definir la funci칩n de suavizado exponencial</span>
<span class="k">def</span> <span class="nf">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ytilde</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">ytilde</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">ytilde</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Aplicar el suavizado exponencial a los datos de ventas de pizza</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mf">0.13</span>

<span class="c1"># Calcular el 칤ndice de divisi칩n (85% para entrenar, 15% para predecir)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento y prueba</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Suavizado sobre el conjunto de entrenamiento</span>
<span class="n">pizza_smooth1_train</span> <span class="o">=</span> <span class="n">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="n">lambda_</span><span class="p">)</span>

<span class="c1"># Hacer predicciones para el 칰ltimo 15% (suavizado exponencial simple)</span>
<span class="n">pizza_smooth1_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span> <span class="n">pizza_smooth1_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Calcular el RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Calcular el MAE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Calcular el AIC y BIC</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>  <span class="c1"># N칰mero de observaciones de prueba</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># N칰mero de par치metros (lambda y nivel inicial)</span>
<span class="n">aic_ses</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span>
<span class="n">bic_ses</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>



<span class="c1"># Graficar los datos de entrenamiento, prueba y las predicciones</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ventas de Pizza (Entrenamiento)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">pizza_smooth1_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SES $\lambda=</span><span class="si">{</span><span class="n">lambda_</span><span class="si">}</span><span class="s1">$ (Entrenamiento)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="c1"># Mostrar el comportamiento real del 칰ltimo 15%</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">train_size</span><span class="p">:],</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ventas de Pizza (Real - 칔ltimo 15%)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Mostrar las predicciones del 칰ltimo 15%</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">train_size</span><span class="p">:],</span> <span class="n">pizza_smooth1_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicci칩n SES (칔ltimo 15%)&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cantidad de Ventas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="c1"># Calcular el MSE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE</span>
<span class="c1"># Aseg칰rate de manejar divisiones por cero en el c치lculo</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_test</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Imprimir las m칠tricas</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE del modelo SES: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE del modelo SES: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE del modelo SES: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE del modelo SES: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Calcular el R entre los valores reales (y_test) y las predicciones (pizza_smooth1_test)</span>
<span class="n">r_squared</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Imprimir el R</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R del modelo SES: </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8dae767b719eaf282e9351a007824f5fccf1800f1f3e30273d4ed11b7ddbe2fe.png" src="_images/8dae767b719eaf282e9351a007824f5fccf1800f1f3e30273d4ed11b7ddbe2fe.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE del modelo SES: 22.037037037037038
RMSE del modelo SES: 33.605555096342826
MSE del modelo SES: 1129.3333333333333
MAPE del modelo SES: 16.59%
R del modelo SES: -0.0000
</pre></div>
</div>
</div>
</div>
<p>En este an치lisis, se utiliz칩 un modelo de suavizado exponencial simple (SES) para predecir las ventas diarias de pizza. Los datos se cargaron desde un archivo Excel y se agruparon por fecha, manejando los valores faltantes mediante interpolaci칩n. Se aplic칩 el suavizado exponencial con un par치metro (\lambda = 0.13).</p>
<p>Los datos se dividieron en un conjunto de entrenamiento (85%) y otro de prueba (15%). Las m칠tricas de error del modelo fueron:</p>
<ul class="simple">
<li><p><strong>MAE</strong>: 22.04, indicando que las predicciones se desv칤an, en promedio, en 22 ventas.</p></li>
<li><p><strong>RMSE</strong>: 33.61, sugiriendo que los errores son m치s significativos que lo indicado por el MAE.</p></li>
<li><p><strong>MSE</strong>: 1129.33, reflejando una alta variabilidad en las predicciones.</p></li>
<li><p><strong>MAPE</strong>: 16.59%, mostrando que las predicciones se desv칤an un 16.59% de los valores reales.</p></li>
<li><p><strong>R</strong>: -0.0000, indicando que el modelo no explica la variabilidad en los datos.</p></li>
</ul>
<p>Las predicciones se visualizaron junto con las ventas reales, lo que mostr칩 c칩mo se ajustan a los datos. Aunque el SES ofrece un enfoque b치sico, sus m칠tricas sugieren que se podr칤an explorar modelos m치s complejos para mejorar la precisi칩n en las predicciones.</p>
<section id="analisis-de-residuos-de-entrenamiento">
<h3>Analisis de residuos de entrenamiento<a class="headerlink" href="#analisis-de-residuos-de-entrenamiento" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>  <span class="c1"># Aseg칰rate de importar seaborn</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Suponiendo que ya tienes los residuos calculados</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">resid</span>

<span class="c1"># 1. Gr치fico de caja de los residuos por trimestres</span>
<span class="n">df_residuos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residuos&#39;</span><span class="p">])</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)]</span>  <span class="c1"># Aseg칰rate de que las fechas coincidan</span>

<span class="c1"># Agregar una columna para identificar el trimestre</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Caja de los Residuos por Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Prueba de Jarque-Bera</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test: Estad칤stico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribuci칩n normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Gr치ficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gr치fico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Cambia 30 por 10 (o menos si es necesario)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n (ACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="c1"># Gr치fico de PACF</span>
<span class="n">max_lags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># Aseg칰rate de que lags es menor que la mitad de la longitud de residuos</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Cambia 30 por max_lags</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n Parcial (PACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4bb80fd3803a78e97dbd34ba1d4bc2b14cde3d4dbbc4bc891929167f38301fa1.png" src="_images/4bb80fd3803a78e97dbd34ba1d4bc2b14cde3d4dbbc4bc891929167f38301fa1.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test: Estad칤stico=49258.92963963724, p-valor=0.0
Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/8e5e540f6ce512696b991d030bbf0d0879882091f23cb3f9bd9165c3a51bad2f.png" src="_images/8e5e540f6ce512696b991d030bbf0d0879882091f23cb3f9bd9165c3a51bad2f.png" />
</div>
</div>
<p>En el boxplot de los residuos, si el gr치fico es sim칠trico y no hay outliers, eso sugiere que los residuos est치n bien centrados. Sin embargo, si hay puntos fuera de los bigotes, esto podr칤a indicar que el modelo no est치 capturando toda la variabilidad. Adem치s, si la mediana est치 descentrada o la caja es asim칠trica, podr칤a haber un sesgo en el modelo.</p>
<p>En el gr치fico de ACF, si veo picos significativos en los primeros lags, eso indicar칤a que el modelo no ha capturado todas las dependencias. Lo ideal ser칤a que el ACF se asemeje a un ruido blanco, donde la mayor칤a de los valores est칠n cerca de cero. Una ca칤da gradual o picos en lags distantes pueden se침alar dependencias a largo plazo no capturadas.</p>
<p>Por otro lado, en el gr치fico de PACF, en un buen modelo, los valores deber칤an caer r치pidamente a cero tras los primeros lags. Si hay picos significativos en lags posteriores, esto sugiere que hay informaci칩n que el modelo no est치 capturando, lo que podr칤a ser un problema de especificaci칩n.</p>
</section>
<section id="analisis-de-residuos-de-la-prediccion">
<h3>Analisis de residuos de la prediccion<a class="headerlink" href="#analisis-de-residuos-de-la-prediccion" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular los residuos para entrenamiento y prueba</span>
<span class="n">residuos_train</span> <span class="o">=</span> <span class="n">y_train</span> <span class="o">-</span> <span class="n">pizza_smooth1_train</span>
<span class="n">residuos_test</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">pizza_smooth1_test</span>

<span class="c1"># Prueba de normalidad (Jarque-Bera) para residuos de prueba</span>
<span class="n">jb_test_stat</span><span class="p">,</span> <span class="n">jb_p_value_test</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test de normalidad (Jarque-Bera) para residuos de prueba:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estad칤stico: </span><span class="si">{</span><span class="n">jb_test_stat</span><span class="si">}</span><span class="s2">, p-valor: </span><span class="si">{</span><span class="n">jb_p_value_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Prueba de independencia (Ljung-Box) para residuos de prueba</span>
<span class="n">lb_test_result_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos_test</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Test de independencia (Ljung-Box) para residuos de prueba:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lb_test_result_test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test de normalidad (Jarque-Bera) para residuos de prueba:
Estad칤stico: 97.74901587508569, p-valor: 5.943891825597542e-22

Test de independencia (Ljung-Box) para residuos de prueba:
      lb_stat  lb_pvalue
10  12.461416   0.255361
</pre></div>
</div>
</div>
</div>
<p>A partir de los resultados sobre los residuos de la predicci칩n, podemos hacer algunas inferencias clave sobre su normalidad e independencia. En el Test de normalidad de Jarque-Bera, el estad칤stico es 97.75 y el p-valor es 5.94e-22. Esto indica que los residuos no siguen una distribuci칩n normal, ya que el p-valor es extremadamente bajo, lo que sugiere que el modelo no captura completamente la estructura de los datos y que hay asimetr칤a o curtosis elevada.</p>
<p>Por otro lado, en el Test de independencia de Ljung-Box, el estad칤stico es 12.46 para 10 lags y el p-valor es 0.255. Esto indica que no hay autocorrelaci칩n significativa en los residuos, lo que es positivo, ya que sugiere que el modelo ha capturado bien la estructura temporal de los datos</p>
</section>
</section>
<section id="modelo-holtwinters">
<h2>Modelo Holtwinters<a class="headerlink" href="#modelo-holtwinters" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha, permitiendo que pandas infiera el formato</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad de ventas diarias (Quantity)</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_ventas</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Ordenar por fecha en caso de que no est칠 ordenado</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span>

<span class="c1"># Definir el tama침o del conjunto de prueba (칰ltimo 15%)</span>
<span class="n">test_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_grouped</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento (85%) y prueba (15%)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[:</span><span class="o">-</span><span class="n">test_size</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="o">-</span><span class="n">test_size</span><span class="p">:]</span>

<span class="c1"># Ajustar el modelo Holt-Winters con los par치metros especificados</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> 
                             <span class="n">seasonal</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span>  <span class="c1"># Estacionalidad aditiva</span>
                             <span class="n">seasonal_periods</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="c1"># Per칤odo estacional de 7 d칤as (semanal)</span>
                             <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;mul&#39;</span><span class="p">)</span>  <span class="c1"># Tendencia multiplicativa</span>
<span class="n">hw_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Calcular el AIC y BIC del modelo Holt-Winters</span>
<span class="n">aic</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">aic</span>
<span class="n">bic</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">bic</span>

<span class="c1"># Realizar predicci칩n para el tama침o del conjunto de prueba</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>

<span class="c1"># Calcular MAE y RMSE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">))</span>

<span class="c1"># Calcular el R entre los valores reales y las predicciones</span>
<span class="n">r_squared</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>



<span class="c1"># Graficar los datos originales, el conjunto de prueba y la predicci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Datos de entrenamiento</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Conjunto de prueba</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Conjunto de prueba real&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Predicci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicci칩n Holt-Winters&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Etiquetas y t칤tulo</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predicci칩n de Ventas usando Holt-Winters con conjunto de prueba&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total de Ventas&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Rotar etiquetas del eje X</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Mostrar el gr치fico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calcular MSE y MAPE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">forecast</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># MAPE en porcentaje</span>

<span class="c1"># Imprimir las m칠tricas calculadas</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC del modelo Holt-Winters: </span><span class="si">{</span><span class="n">aic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC del modelo Holt-Winters: </span><span class="si">{</span><span class="n">bic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>  <span class="c1"># Formato en porcentaje</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R del modelo Holt-Winters: </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>c:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\holtwinters\model.py:84: RuntimeWarning: overflow encountered in matmul
  return err.T @ err
</pre></div>
</div>
<img alt="_images/9ed320a11622a0476ca7e71c58e48760815c1ab8aa4d1d3f0321b621b3caea06.png" src="_images/9ed320a11622a0476ca7e71c58e48760815c1ab8aa4d1d3f0321b621b3caea06.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC del modelo Holt-Winters: 1843.572415497852
BIC del modelo Holt-Winters: 1884.4958450405336
MAE del modelo Holt-Winters: 20.854868339222346
RMSE del modelo Holt-Winters: 31.777808583971765
MSE del modelo Holt-Winters: 1009.8291183995495
MAPE del modelo Holt-Winters: 16.20%
R del modelo Holt-Winters: 0.1170
</pre></div>
</div>
</div>
</div>
<p>El modelo Holt-Winters se ha implementado para pronosticar las ventas de pizza utilizando datos diarios, permitiendo capturar tanto la tendencia como la estacionalidad. Los resultados del modelo indican un <strong>AIC</strong> de 1843.68 y un <strong>BIC</strong> de 1884.60, lo que sugiere un ajuste razonable a los datos, aunque valores m치s bajos son preferibles para la comparaci칩n con otros modelos. En cuanto a los errores de predicci칩n, el <strong>MAE</strong> es de 20.63, lo que indica que, en promedio, las predicciones del modelo se desv칤an de las ventas reales en aproximadamente 20.63 unidades, sugiriendo un error moderado. El <strong>RMSE</strong> es de 31.62, lo que refleja que las desviaciones de las predicciones son significativas, aunque no extremas. Adem치s, el <strong>MSE</strong> es de 999.56, se침alando un error considerable en las predicciones.</p>
<p>Respecto a la precisi칩n del modelo, el <strong>MAPE</strong> es del 15.96%, lo que indica un error promedio de aproximadamente 15.96% en las predicciones, un nivel que podr칤a considerarse aceptable en algunas aplicaciones, pero que podr칤a ser mejorado. Por 칰ltimo, el <strong>R</strong> es de 0.1259, lo que sugiere que el modelo explica solo alrededor del 12.59% de la variabilidad total de las ventas. Esto implica que hay otros factores o variaciones en los datos que el modelo no est치 capturando adecuadamente. En conclusi칩n, aunque el modelo Holt-Winters ha proporcionado un ajuste moderado a los datos de ventas de pizza, los errores de predicci칩n sugieren que se puede mejorar, y el bajo valor de R indica que no est치 capturando bien la variabilidad en los datos, lo que podr칤a llevar a explorar otros enfoques de modelado o la inclusi칩n de variables adicionales para mejorar el pron칩stico.</p>
<section id="analisis-de-residuos-del-entrenamiento">
<h3>Analisis de residuos del entrenamiento<a class="headerlink" href="#analisis-de-residuos-del-entrenamiento" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">fittedvalues</span>

<span class="c1"># 1. Gr치fico de caja de los residuos por trimestres</span>
<span class="n">df_residuos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;residuos&#39;</span><span class="p">])</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span>  <span class="c1"># Aseg칰rate de que las fechas coincidan</span>

<span class="c1"># Agregar una columna para identificar el trimestre</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Caja de los Residuos por Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Prueba de Jarque-Bera</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test: Estad칤stico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribuci칩n normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Gr치ficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gr치fico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Cambia 30 por 10 (o menos si es necesario)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n (ACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="c1"># Gr치fico de PACF</span>
<span class="n">max_lags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>  <span class="c1"># Aseg칰rate de que lags es menor que la mitad de la longitud de residuos</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Cambia 30 por max_lags</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n Parcial (PACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/65db526d6b18010dd11c80f9b95132c1f416a11ed9127031d10d62d2832acd6a.png" src="_images/65db526d6b18010dd11c80f9b95132c1f416a11ed9127031d10d62d2832acd6a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test: Estad칤stico=1377.9616452064433, p-valor=6.017701013834668e-300
Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/f2c54217c4d02247011518dce01489fce2320c809797db645343400a850b81a1.png" src="_images/f2c54217c4d02247011518dce01489fce2320c809797db645343400a850b81a1.png" />
</div>
</div>
<p>En el an치lisis de los residuos del modelo Holt-Winters, el <strong>boxplot trimestral</strong> muestra que los residuos en los tres primeros trimestres son m치s estables y cercanos a cero, pero en el 칰ltimo trimestre presentan mayor dispersi칩n, lo que sugiere que el modelo pierde algo de precisi칩n en ese periodo. A pesar de esto, la <strong>ACF y PACF</strong> de los residuos muestran que no hay autocorrelaciones significativas en los rezagos, lo que indica que los residuos se comportan como ruido blanco y no hay patrones de dependencia temporal no explicados por el modelo.</p>
<p>En resumen, el modelo captura bien la estructura temporal de los datos, pero es posible que enfrente dificultades en el 칰ltimo trimestre. Esto podr칤a deberse a una mayor variabilidad o a cambios en los datos que el modelo no capta completamente, por lo que ser칤a recomendable ajustar par치metros o explorar posibles outliers en ese periodo para mejorar el ajuste.</p>
</section>
<section id="id1">
<h3>Analisis de residuos de la prediccion<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular los residuos de las predicciones</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">-</span> <span class="n">forecast</span>

<span class="c1"># Realizar la prueba de Ljung-Box</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>
<span class="n">ljung_box_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prueba de Ljung-Box:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ljung_box_test</span><span class="p">)</span>

<span class="c1"># Realizar la prueba de Jarque-Bera</span>
<span class="n">jarque_bera_test</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prueba de Jarque-Bera:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estad칤stico: </span><span class="si">{</span><span class="n">jarque_bera_test</span><span class="o">.</span><span class="n">statistic</span><span class="si">}</span><span class="s2">, p-valor: </span><span class="si">{</span><span class="n">jarque_bera_test</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prueba de Ljung-Box:
     lb_stat  lb_pvalue
10  9.901357    0.44919

Prueba de Jarque-Bera:
Estad칤stico: 76.57160269867782, p-valor: 2.3587816401526902e-17
</pre></div>
</div>
</div>
</div>
<p>Los resultados de la prueba de <strong>Ljung-Box</strong> (p-valor: 0.255) indican que no existe autocorrelaci칩n significativa en los residuos para los primeros 10 rezagos, lo que sugiere que el modelo captura bien la dependencia temporal. Por otro lado, la prueba de <strong>Jarque-Bera</strong> (estad칤stico: 97.75, p-valor: 5.94e-22) revela que los residuos no siguen una distribuci칩n normal, lo cual podr칤a ser una se침al de problemas con la suposici칩n de normalidad en el modelo, lo que puede afectar las estimaciones de error y la interpretaci칩n de los intervalos de confianza.</p>
</section>
</section>
<section id="modelo-red-neuronal-recuerrente">
<h2>Modelo red neuronal recuerrente<a class="headerlink" href="#modelo-red-neuronal-recuerrente" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="c1"># Leer el archivo y procesar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Convertimos la serie de tiempo a un array</span>
<span class="n">time_series</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Normalizar los datos para que est칠n en un rango adecuado</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">time_series_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">time_series</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Crear el dataset para la RNN con look_back = 28</span>
<span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">look_back</span><span class="o">=</span><span class="mi">28</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">-</span> <span class="n">look_back</span><span class="p">):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">look_back</span> <span class="o">=</span> <span class="mi">28</span>  <span class="c1"># Ajuste de par치metro</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">time_series_scaled</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>

<span class="c1"># Reshape para el formato adecuado</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Dividir el conjunto de datos en entrenamiento y prueba (85% entrenamiento, 15% prueba)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Definir la red RNN y entrenarla con hidden_size = 20 y learning_rate = 0.005</span>
<span class="k">def</span> <span class="nf">relu</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">relu_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">RNN_BPTT</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">truncation</span> <span class="o">=</span> <span class="n">truncation</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">relu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span>

    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">dU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">)</span>
        <span class="n">dW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="n">dV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="n">dh_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>  <span class="c1"># Derivada de la p칠rdida (MSE)</span>
            <span class="n">dV</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">dy</span><span class="p">)</span>
            <span class="n">dc</span> <span class="o">+=</span> <span class="n">dy</span>
            <span class="n">dh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">dh_next</span>
            <span class="n">dh_raw</span> <span class="o">=</span> <span class="n">dh</span> <span class="o">*</span> <span class="n">relu_derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="n">dU</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">dh_raw</span><span class="p">)</span>
            <span class="n">dW</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dh_raw</span><span class="p">)</span>
            <span class="n">db</span> <span class="o">+=</span> <span class="n">dh_raw</span>
            <span class="n">dh_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dh_raw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        
        <span class="c1"># Clipping de gradientes para evitar explosi칩n</span>
        <span class="k">for</span> <span class="n">dparam</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dU</span><span class="p">,</span> <span class="n">dW</span><span class="p">,</span> <span class="n">dV</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">dc</span><span class="p">]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dparam</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">dparam</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dc</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">output</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Inicializar la red con los par치metros indicados</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="n">look_back</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Ajuste de par치metro</span>
<span class="n">output_size</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.005</span>  <span class="c1"># Ajuste de par치metro</span>
<span class="n">rnn</span> <span class="o">=</span> <span class="n">RNN_BPTT</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span>
<span class="n">rnn</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Hacer predicciones en el conjunto de entrenamiento y prueba</span>
<span class="n">predictions_train</span> <span class="o">=</span> <span class="n">rnn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">predictions_test</span> <span class="o">=</span> <span class="n">rnn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Desnormalizar las predicciones para obtener los valores originales</span>
<span class="n">predictions_train_descaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)</span>
<span class="n">predictions_test_descaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions_test</span><span class="p">)</span>

<span class="c1"># Graficar las predicciones y la serie original</span>
<span class="k">def</span> <span class="nf">plot_predictions</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">predictions_train</span><span class="p">,</span> <span class="n">predictions_test</span><span class="p">,</span> <span class="n">look_back</span><span class="p">):</span>
    <span class="n">predictions_train</span> <span class="o">=</span> <span class="n">predictions_train</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">predictions_test</span> <span class="o">=</span> <span class="n">predictions_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Crear una serie de tiempo para las predicciones alineada con la serie original</span>
    <span class="n">prediction_train_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
    <span class="n">prediction_train_shifted</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># Inicializar con NaN para dejar huecos</span>
    <span class="n">prediction_train_shifted</span><span class="p">[</span><span class="n">look_back</span><span class="p">:</span><span class="n">look_back</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)]</span> <span class="o">=</span> <span class="n">predictions_train</span>  <span class="c1"># Desplazar predicciones del conjunto de entrenamiento</span>

    <span class="n">prediction_test_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
    <span class="n">prediction_test_shifted</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># Inicializar con NaN para dejar huecos</span>
    <span class="n">prediction_test_shifted</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">:]</span> <span class="o">=</span> <span class="n">predictions_test</span>  <span class="c1"># Desplazar predicciones del conjunto de prueba</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Serie de tiempo original&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction_train_shifted</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicciones - Entrenamiento&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction_test_shifted</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicciones - Prueba&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparaci칩n de la serie de tiempo y las predicciones (Entrenamiento vs Prueba)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Graficar las predicciones</span>
<span class="n">plot_predictions</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">predictions_train_descaled</span><span class="p">,</span> <span class="n">predictions_test_descaled</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Calcular el R^2</span>
<span class="k">def</span> <span class="nf">calculate_r_squared</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el MSE</span>
<span class="k">def</span> <span class="nf">calculate_mse</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el RMSE</span>
<span class="k">def</span> <span class="nf">calculate_rmse</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

<span class="c1"># Calcular el AIC</span>
<span class="k">def</span> <span class="nf">calculate_aic</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">aic</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num_params</span>
    <span class="k">return</span> <span class="n">aic</span>

<span class="c1"># Calcular el BIC</span>
<span class="k">def</span> <span class="nf">calculate_bic</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">bic</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_params</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bic</span>

<span class="c1"># Predicciones desnormalizadas (usadas para evaluar en la escala original)</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">predictions_train_descaled</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">predictions_test_descaled</span>

<span class="c1"># Valores reales (sin escalar, para compararlos correctamente con las predicciones desnormalizadas)</span>
<span class="n">y_train_true</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_test_true</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>

<span class="c1"># N칰mero de par치metros del modelo RNN: U, W, V, b, c</span>
<span class="n">num_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Calcular m칠tricas para el conjunto de entrenamiento</span>
<span class="n">r2_train</span> <span class="o">=</span> <span class="n">calculate_r_squared</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">mse_train</span> <span class="o">=</span> <span class="n">calculate_mse</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">rmse_train</span> <span class="o">=</span> <span class="n">calculate_rmse</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">aic_train</span> <span class="o">=</span> <span class="n">calculate_aic</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>
<span class="n">bic_train</span> <span class="o">=</span> <span class="n">calculate_bic</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>

<span class="c1"># Calcular m칠tricas para el conjunto de prueba</span>
<span class="n">r2_test</span> <span class="o">=</span> <span class="n">calculate_r_squared</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">mse_test</span> <span class="o">=</span> <span class="n">calculate_mse</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">rmse_test</span> <span class="o">=</span> <span class="n">calculate_rmse</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">aic_test</span> <span class="o">=</span> <span class="n">calculate_aic</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>
<span class="n">bic_test</span> <span class="o">=</span> <span class="n">calculate_bic</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>



<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Unir las predicciones y los valores reales de entrenamiento y prueba</span>
<span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">predictions_train_descaled</span><span class="p">,</span> <span class="n">predictions_test_descaled</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_true_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Calcular el R^2 para el conjunto total</span>
<span class="n">r2_total</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true_total</span><span class="p">,</span> <span class="n">y_pred_total</span><span class="p">)</span>

<span class="c1"># Mostrar el R^2 total</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R^2 total: </span><span class="si">{</span><span class="n">r2_total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

<span class="c1"># Calcular el MAE</span>
<span class="k">def</span> <span class="nf">calculate_mae</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE</span>
<span class="k">def</span> <span class="nf">calculate_mape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_true</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># MAPE como porcentaje</span>

<span class="c1"># Calcular m칠tricas para el conjunto de entrenamiento</span>
<span class="n">mae_train</span> <span class="o">=</span> <span class="n">calculate_mae</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">mape_train</span> <span class="o">=</span> <span class="n">calculate_mape</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>

<span class="c1"># Calcular m칠tricas para el conjunto de prueba</span>
<span class="n">mae_test</span> <span class="o">=</span> <span class="n">calculate_mae</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">mape_test</span> <span class="o">=</span> <span class="n">calculate_mape</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>




<span class="c1"># Mostrar las m칠tricas totales</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">M칠tricas totales:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R^2 total: </span><span class="si">{</span><span class="n">r2_total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 0, Loss: 0.12202312165158294
Epoch 100, Loss: 0.01359642777387532
Epoch 200, Loss: 0.012344530068833386
Epoch 300, Loss: 0.01168961727572708
Epoch 400, Loss: 0.011329617519078239
Epoch 500, Loss: 0.011023879851695553
Epoch 600, Loss: 0.0108390412612204
Epoch 700, Loss: 0.010675242353569248
Epoch 800, Loss: 0.01053721156905347
Epoch 900, Loss: 0.010399682247022752
</pre></div>
</div>
<img alt="_images/fb9f0ae4694f96a4113acccbd4665052653a69e49f15ae2d95d444e848623485.png" src="_images/fb9f0ae4694f96a4113acccbd4665052653a69e49f15ae2d95d444e848623485.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R^2 total: 0.22530504636153814

M칠tricas totales:
R^2 total: 0.22530504636153814
RMSE: 33.20006150535171
MAE: 22.819214393339777
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h3>Analisis de los residuos del entrenamiento<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>La evaluaci칩n de la red neuronal recurrente (RNN) revel칩 un coeficiente de determinaci칩n (R) de 0.2179, lo que significa que el modelo es capaz de explicar aproximadamente el 21.79% de la variabilidad observada en las ventas de pizza. Esto indica que, aunque la RNN logra capturar alguna relaci칩n entre los datos, una gran parte de la variabilidad, que corresponde al 78.21%, sigue sin ser explicada, lo que puede sugerir la influencia de factores externos o patrones no identificados en los datos.</p>
<p>Adem치s, se calcularon m칠tricas adicionales que complementan la evaluaci칩n del rendimiento del modelo. El error cuadr치tico medio (RMSE) fue de 33.65, lo que refleja la magnitud promedio de los errores en las predicciones. Este valor sugiere que las predicciones de ventas de pizza pueden desviarse significativamente de los valores reales. Por otro lado, el error absoluto medio (MAE) fue de 23.60, indicando que, en promedio, el modelo se desvi칩 de las ventas reales por esta cantidad.</p>
<p>En conjunto, estas m칠tricas proporcionan una visi칩n general del rendimiento de la RNN, sugiriendo que, aunque el modelo tiene alguna capacidad predictiva, tambi칠n enfrenta limitaciones significativas en su precisi칩n y en la explicaci칩n de la variabilidad de las ventas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">residuos_train</span> <span class="o">=</span> <span class="n">y_train_true</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Residuos del conjunto de entrenamiento</span>
<span class="n">residuos_test</span> <span class="o">=</span> <span class="n">y_test_true</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>      <span class="c1"># Residuos del conjunto de prueba</span>

<span class="c1"># 1. Gr치fico de caja de los residuos por trimestres</span>
<span class="c1"># Aseg칰rate de que el 칤ndice de los datos de entrenamiento tenga las fechas correctas</span>
<span class="n">df_residuos_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;residuos&#39;</span><span class="p">:</span> <span class="n">residuos_train</span><span class="p">,</span> <span class="s1">&#39;fecha&#39;</span><span class="p">:</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">look_back</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">]})</span>
<span class="n">df_residuos_train</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos_train</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos_train</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Caja de los Residuos por Trimestres - Entrenamiento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># 2. Prueba de Jarque-Bera</span>
<span class="n">jb_stat_train</span><span class="p">,</span> <span class="n">jb_p_value_train</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test (Entrenamiento): Estad칤stico=</span><span class="si">{</span><span class="n">jb_stat_train</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value_train</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value_train</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos de entrenamiento parecen seguir una distribuci칩n normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos de entrenamiento no siguen una distribuci칩n normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Gr치ficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gr치fico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Cambia 10 por el n칰mero de lags que prefieras</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n (ACF) de los Residuos - Entrenamiento&#39;</span><span class="p">)</span>

<span class="c1"># Gr치fico de PACF</span>
<span class="n">max_lags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># Cambia max_lags si es necesario</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n Parcial (PACF) de los Residuos - Entrenamiento&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/df267a2a07848d2c3399c1e3fbcafe9d29db9bca5d513fb0887bdf56649ae0b0.png" src="_images/df267a2a07848d2c3399c1e3fbcafe9d29db9bca5d513fb0887bdf56649ae0b0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test (Entrenamiento): Estad칤stico=646.5299119443438, p-valor=4.0533436779340375e-141
Los residuos de entrenamiento no siguen una distribuci칩n normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/83679544c4edc87d07ac335c1c0e6a810d52d4246fb0e7b9f0ceccde1044c019.png" src="_images/83679544c4edc87d07ac335c1c0e6a810d52d4246fb0e7b9f0ceccde1044c019.png" />
</div>
</div>
</section>
<section id="id3">
<h3>Analisis de los residuos de la prediccion<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">residuos_train</span> <span class="o">=</span> <span class="n">y_train_true</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>  <span class="c1"># Residuos del conjunto de entrenamiento</span>



<span class="c1"># 2. Prueba de Jarque-Bera</span>
<span class="n">jb_stat_train</span><span class="p">,</span> <span class="n">jb_p_value_train</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test (Entrenamiento): Estad칤stico=</span><span class="si">{</span><span class="n">jb_stat_train</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value_train</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value_train</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos de entrenamiento parecen seguir una distribuci칩n normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos de entrenamiento no siguen una distribuci칩n normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># 3. Prueba de Ljung-Box</span>
<span class="n">ljung_box_results</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Cambia 10 por el n칰mero de lags que prefieras</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ljung_box_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test (Entrenamiento): Estad칤stico=618.5676618715746, p-valor=4.7834240494947976e-135
Los residuos de entrenamiento no siguen una distribuci칩n normal (p &lt;= 0.05)
     lb_stat  lb_pvalue
10  2.330921   0.993117
</pre></div>
</div>
</div>
</div>
<p>Los resultados de la prueba de Jarque-Bera muestran un estad칤stico de 618.57 y un p-valor de 4.78e-135, lo que indica que los residuos de entrenamiento no siguen una distribuci칩n normal (p &lt;= 0.05). Esto sugiere que el modelo no ha capturado adecuadamente la din치mica de los datos, por lo que podr칤a ser necesario ajustar el modelo o considerar variables adicionales. Por otro lado, la prueba de Ljung-Box presenta un estad칤stico de 2.33 y un p-valor de 0.9931, lo que indica que no hay autocorrelaci칩n significativa en los residuos hasta el rezago especificado. Esto es positivo, ya que sugiere que los errores de predicci칩n son aleatorios. En resumen, aunque el modelo muestra alguna capacidad predictiva, hay espacio para mejorar su precisi칩n y capturar mejor la din치mica de los datos.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-mlp">
<h1>Modelo MLP<a class="headerlink" href="#modelo-mlp" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria y eliminar los valores nulos</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN y luego eliminar filas con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Escalar los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Asegurarse de eliminar posibles NaN en las series</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Dividir en conjuntos de entrenamiento y validaci칩n (85% entrenamiento, 15% validaci칩n)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">df_val</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Crear las ventanas de tiempo (7 d칤as)</span>
<span class="k">def</span> <span class="nf">makeXy</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">nb_timesteps</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_timesteps</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">nb_timesteps</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>

<span class="c1"># Definir el modelo MLP con los mejores hiperpar치metros</span>
<span class="n">input_layer</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,))</span>
<span class="n">dense1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">input_layer</span><span class="p">)</span>  <span class="c1"># units_1 = 256</span>
<span class="n">dense2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">dense1</span><span class="p">)</span>        <span class="c1"># units_2 = 96</span>
<span class="n">dense3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">dense2</span><span class="p">)</span>        <span class="c1"># units_3 = 48</span>
<span class="n">dropout_layer</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)(</span><span class="n">dense3</span><span class="p">)</span>                 <span class="c1"># dropout = 0.3</span>
<span class="n">output_layer</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">dropout_layer</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_layer</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="c1"># Implementar Early Stopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrenar el modelo</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

<span class="c1"># Predecir los valores en el conjunto de entrenamiento y validaci칩n</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">pred_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_train</span><span class="p">)</span>

<span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">pred_val_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_val</span><span class="p">)</span>

<span class="c1"># Concatenar las predicciones y los valores reales (entrenamiento + validaci칩n)</span>
<span class="n">pred_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pred_train_quantity</span><span class="p">,</span> <span class="n">pred_val_quantity</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">real_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>



<span class="c1"># Graficar resultados (entrenamiento + validaci칩n)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Graficar el conjunto de entrenamiento</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Entrenamiento Real&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">pred_train_quantity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Entrenamiento Predicho&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># Graficar el conjunto de validaci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_val</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validaci칩n Real&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_val</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">pred_val_quantity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validaci칩n Predicho&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ventas Reales vs Predichas (Entrenamiento y Validaci칩n)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ventas de Pizzas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calcular MAE y RMSE para todo el conjunto</span>
<span class="n">mae_total</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">real_total</span><span class="p">,</span> <span class="n">pred_total</span><span class="p">)</span>
<span class="n">rmse_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">real_total</span><span class="p">,</span> <span class="n">pred_total</span><span class="p">))</span>

<span class="c1"># Calcular MAPE</span>
<span class="n">mape_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">real_total</span> <span class="o">-</span> <span class="n">pred_total</span><span class="p">)</span> <span class="o">/</span> <span class="n">real_total</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>



<span class="n">r2_val</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">pred_val_quantity</span><span class="p">)</span>

<span class="c1"># Imprimir los resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAE total: </span><span class="si">{</span><span class="n">mae_total</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RMSE total: </span><span class="si">{</span><span class="n">rmse_total</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAPE total: </span><span class="si">{</span><span class="n">mape_total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R-cuadrado (validaci칩n): </span><span class="si">{</span><span class="n">r2_val</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/100
19/19 - 2s - 129ms/step - loss: 0.0377 - val_loss: 0.0373
Epoch 2/100
19/19 - 0s - 19ms/step - loss: 0.0203 - val_loss: 0.0347
Epoch 3/100
19/19 - 0s - 9ms/step - loss: 0.0185 - val_loss: 0.0327
Epoch 4/100
19/19 - 0s - 7ms/step - loss: 0.0170 - val_loss: 0.0325
Epoch 5/100
19/19 - 0s - 8ms/step - loss: 0.0154 - val_loss: 0.0336
Epoch 6/100
19/19 - 0s - 9ms/step - loss: 0.0146 - val_loss: 0.0326
Epoch 7/100
19/19 - 0s - 7ms/step - loss: 0.0150 - val_loss: 0.0312
Epoch 8/100
19/19 - 0s - 9ms/step - loss: 0.0152 - val_loss: 0.0309
Epoch 9/100
19/19 - 0s - 10ms/step - loss: 0.0158 - val_loss: 0.0314
Epoch 10/100
19/19 - 0s - 8ms/step - loss: 0.0150 - val_loss: 0.0313
Epoch 11/100
19/19 - 0s - 9ms/step - loss: 0.0136 - val_loss: 0.0315
Epoch 12/100
19/19 - 0s - 8ms/step - loss: 0.0143 - val_loss: 0.0312
Epoch 13/100
19/19 - 0s - 9ms/step - loss: 0.0138 - val_loss: 0.0317
Epoch 14/100
19/19 - 0s - 10ms/step - loss: 0.0140 - val_loss: 0.0308
Epoch 15/100
19/19 - 0s - 10ms/step - loss: 0.0139 - val_loss: 0.0325
Epoch 16/100
19/19 - 0s - 9ms/step - loss: 0.0136 - val_loss: 0.0305
Epoch 17/100
19/19 - 0s - 8ms/step - loss: 0.0128 - val_loss: 0.0292
Epoch 18/100
19/19 - 0s - 9ms/step - loss: 0.0126 - val_loss: 0.0303
Epoch 19/100
19/19 - 0s - 10ms/step - loss: 0.0118 - val_loss: 0.0298
Epoch 20/100
19/19 - 0s - 8ms/step - loss: 0.0134 - val_loss: 0.0307
Epoch 21/100
19/19 - 0s - 9ms/step - loss: 0.0127 - val_loss: 0.0311
Epoch 22/100
19/19 - 0s - 9ms/step - loss: 0.0131 - val_loss: 0.0315
Epoch 23/100
19/19 - 0s - 9ms/step - loss: 0.0123 - val_loss: 0.0303
Epoch 24/100
19/19 - 0s - 7ms/step - loss: 0.0127 - val_loss: 0.0303
Epoch 25/100
19/19 - 0s - 9ms/step - loss: 0.0129 - val_loss: 0.0307
Epoch 26/100
19/19 - 0s - 9ms/step - loss: 0.0117 - val_loss: 0.0310
Epoch 27/100
19/19 - 0s - 8ms/step - loss: 0.0109 - val_loss: 0.0307
Epoch 28/100
19/19 - 0s - 10ms/step - loss: 0.0117 - val_loss: 0.0298
Epoch 29/100
19/19 - 0s - 9ms/step - loss: 0.0110 - val_loss: 0.0302
Epoch 30/100
19/19 - 0s - 9ms/step - loss: 0.0130 - val_loss: 0.0302
Epoch 31/100
19/19 - 0s - 9ms/step - loss: 0.0119 - val_loss: 0.0305
Epoch 32/100
19/19 - 0s - 9ms/step - loss: 0.0111 - val_loss: 0.0307
Epoch 33/100
19/19 - 0s - 9ms/step - loss: 0.0115 - val_loss: 0.0297
Epoch 34/100
19/19 - 0s - 9ms/step - loss: 0.0110 - val_loss: 0.0297
Epoch 35/100
19/19 - 0s - 9ms/step - loss: 0.0124 - val_loss: 0.0304
Epoch 36/100
19/19 - 0s - 9ms/step - loss: 0.0104 - val_loss: 0.0305
Epoch 37/100
19/19 - 0s - 9ms/step - loss: 0.0104 - val_loss: 0.0313
<span class=" -Color -Color-Bold">10/10</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 11ms/step
<span class=" -Color -Color-Bold">2/2</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 6ms/step 
</pre></div>
</div>
<img alt="_images/a401635a853561c5d2cd515508c9974068ec223ffdfeb88412c902c320924008.png" src="_images/a401635a853561c5d2cd515508c9974068ec223ffdfeb88412c902c320924008.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE total: 15.2861
RMSE total: 21.6112
MAPE total: 13.84%
R-cuadrado (validaci칩n): 0.1768
</pre></div>
</div>
</div>
</div>
<p>El modelo de perceptr칩n multicapa (MLP) utilizado para la predicci칩n de ventas de pizzas ha mostrado resultados que merecen un an치lisis detallado. En t칠rminos de rendimiento, las m칠tricas obtenidas son las siguientes: el error absoluto medio (MAE) es de 15.8777, el error cuadr치tico medio (RMSE) se sit칰a en 22.6327, y el porcentaje de error absoluto medio (MAPE) es del 13.80%.</p>
<p>Una de las m칠tricas m치s destacadas es el R de la validaci칩n, que se ha registrado en 0.1251. Este valor indica que el modelo es capaz de explicar aproximadamente el 12.51% de la variabilidad en las ventas de pizzas. Aunque esto sugiere que hay un potencial para mejorar la capacidad del modelo en t칠rminos de ajuste, tambi칠n resalta que el MLP no ha logrado captar completamente las din치micas subyacentes en los datos. La tasa de error en las predicciones, representada por el MAE y el RMSE, tambi칠n sugiere que las predicciones no son completamente precisas, aunque el MAPE indica un nivel de error aceptable en t칠rminos porcentuales.</p>
<p>Es importante considerar que el MLP es un modelo flexible y puede mejorarse mediante t칠cnicas como la optimizaci칩n de hiperpar치metros, la regularizaci칩n o el aumento de la complejidad del modelo con capas adicionales o diferentes funciones de activaci칩n. Asimismo, explorar la inclusi칩n de caracter칤sticas adicionales, como variables externas que puedan influir en las ventas, podr칤a enriquecer el modelo y ofrecer una mayor capacidad de predicci칩n.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Invertir las transformaciones de escala en las predicciones de entrenamiento y validaci칩n</span>
<span class="n">pred_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_train</span><span class="p">)</span>
<span class="n">pred_val_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_val</span><span class="p">)</span>

<span class="c1"># Asegurarse de que real_total y pred_total sean unidimensionales</span>
<span class="n">real_train_total</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>
<span class="n">real_val_total</span> <span class="o">=</span> <span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Concatenar predicciones y valores reales, verificando las longitudes</span>
<span class="n">pred_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pred_train_quantity</span><span class="p">,</span> <span class="n">pred_val_quantity</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">real_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">real_train_total</span><span class="p">,</span> <span class="n">real_val_total</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Asegurarse de que real_total y pred_total tengan la misma longitud</span>
<span class="n">min_length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">real_total</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_total</span><span class="p">))</span>
<span class="n">real_total</span> <span class="o">=</span> <span class="n">real_total</span><span class="p">[:</span><span class="n">min_length</span><span class="p">]</span>
<span class="n">pred_total</span> <span class="o">=</span> <span class="n">pred_total</span><span class="p">[:</span><span class="n">min_length</span><span class="p">]</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">real_total</span> <span class="o">-</span> <span class="n">pred_total</span>

<span class="c1"># Imprimir longitudes para depuraci칩n</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de residuos: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de real_total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">real_total</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de pred_total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pred_total</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Generar fechas desde el inicio de la serie</span>
<span class="n">fecha_inicio</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
<span class="n">df_residuos</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;residuos&#39;</span><span class="p">:</span> <span class="n">residuos</span><span class="p">})</span>

<span class="c1"># Generar un rango de fechas que coincide con la longitud de residuos</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">fecha_inicio</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">residuos</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">)</span>

<span class="c1"># Verificar que las longitudes coincidan</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de fechas generadas: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Agregar una columna para identificar el trimestre</span>
<span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;trimestre&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_residuos</span><span class="p">[</span><span class="s1">&#39;fecha&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="c1"># Gr치fico de caja de los residuos por trimestres</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;trimestre&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;residuos&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_residuos</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Caja de los Residuos por Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Prueba de Jarque-Bera de scipy</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Jarque-Bera Test: Estad칤stico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribuci칩n normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># Gr치ficos de ACF y PACF</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gr치fico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n (ACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="c1"># Gr치fico de PACF</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n Parcial (PACF) de los Residuos&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Longitud de residuos: 344
Longitud de real_total: 344
Longitud de pred_total: 344
Longitud de fechas generadas: 344
</pre></div>
</div>
<img alt="_images/41288ae68f13c5f0e7c7ab1f1e28cfade2a58db280ad3c8f501bb0a3ec704b67.png" src="_images/41288ae68f13c5f0e7c7ab1f1e28cfade2a58db280ad3c8f501bb0a3ec704b67.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Jarque-Bera Test: Estad칤stico=715.1376457543048, p-valor=5.126645926826437e-156
Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/f1c1ff94edf1949ad91379c1da5f531e3a5d5f26f08b891f24ea4d8ca361b63a.png" src="_images/f1c1ff94edf1949ad91379c1da5f531e3a5d5f26f08b891f24ea4d8ca361b63a.png" />
</div>
</div>
<p>Los resultados del an치lisis de residuos del modelo MLP muestran que, aunque los errores son mayormente estables y aleatorios, persisten algunas limitaciones. En el boxplot, la mayor칤a de las cajas tienen tama침os similares y cercanos a cero, lo que sugiere estabilidad en los errores, pero la 칰ltima caja es un poco m치s grande y presenta puntos dispersos, indicando m치s variabilidad hacia el final del periodo de entrenamiento. En el ACF y PACF, todos los rezagos est치n dentro de la banda de significancia, lo que confirma la ausencia de autocorrelaci칩n significativa. Sin embargo, la prueba de Jarque-Bera revela que los residuos no siguen una distribuci칩n normal (p-valor=5.13e-156), lo cual sugiere que el modelo a칰n no captura del todo la estructura de los datos y podr칤a beneficiarse de ajustes adicionales.</p>
<section id="id4">
<h2>Analisis de los residuos de la prediccion<a class="headerlink" href="#id4" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calcular residuos de las predicciones</span>
<span class="n">residuos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">y_train_true</span> <span class="o">-</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">y_test_true</span> <span class="o">-</span> <span class="n">y_test_pred</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Realizar la prueba de Ljung-Box</span>
<span class="n">ljung_box_test</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuos</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">return_df</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prueba de Ljung-Box:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ljung_box_test</span><span class="p">)</span>

<span class="c1"># Realizar la prueba de Jarque-Bera</span>
<span class="n">jarque_bera_test</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Prueba de Jarque-Bera:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estad칤stico: </span><span class="si">{</span><span class="n">jarque_bera_test</span><span class="o">.</span><span class="n">statistic</span><span class="si">}</span><span class="s2">, p-valor: </span><span class="si">{</span><span class="n">jarque_bera_test</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prueba de Ljung-Box:
     lb_stat  lb_pvalue
10  8.637927   0.566775

Prueba de Jarque-Bera:
Estad칤stico: 651.3574678682289, p-valor: 3.626794756558717e-142
</pre></div>
</div>
</div>
</div>
<p>Los resultados de los residuos de la predicci칩n indican algunos aspectos importantes sobre el modelo. La prueba de Ljung-Box muestra un estad칤stico de 8.64 con un p-valor de 0.5668, lo cual sugiere que no hay autocorrelaci칩n significativa en los residuos. Esto es positivo, ya que indica que los errores de predicci칩n no presentan patrones secuenciales.</p>
<p>Sin embargo, la prueba de Jarque-Bera da un estad칤stico de 651.36 y un p-valor de 3.63e-142, lo que significa que los residuos no siguen una distribuci칩n normal. Esto podr칤a reflejar que el modelo no logra captar completamente la estructura subyacente de los datos, dejando algunas caracter칤sticas de los errores sin explicar. En conjunto, aunque no hay autocorrelaci칩n en los errores, el modelo podr칤a beneficiarse de ajustes adicionales para mejorar su capacidad predictiva.</p>
</section>
<section id="modelo-lstm">
<h2>Modelo LSTM<a class="headerlink" href="#modelo-lstm" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Bidirectional</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">LSTM</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">load_model</span>
<span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="kn">import</span> <span class="n">ModelCheckpoint</span><span class="p">,</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Paso 1: Leer y procesar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Escalar los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">)</span>

<span class="c1"># Paso 2: Crear secuencias para la LSTM</span>
<span class="k">def</span> <span class="nf">makeXy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">steps</span><span class="p">):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">steps</span><span class="p">])</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">steps</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Definir pasos de tiempo (7 d칤as para predecir el siguiente)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_scaled</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento y validaci칩n (80% entrenamiento, 20% validaci칩n)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Reshape a formato 3D: (muestras, pasos de tiempo, caracter칤sticas)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">X_val</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Paso 3: Crear el modelo Bidirectional LSTM con las configuraciones especificadas</span>
<span class="n">input_layer</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">lstm_layer1</span> <span class="o">=</span> <span class="n">Bidirectional</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))(</span><span class="n">input_layer</span><span class="p">)</span>  <span class="c1"># 75 unidades LSTM en la capa Bidirectional</span>
<span class="n">lstm_layer2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">lstm_layer1</span><span class="p">)</span>  <span class="c1"># 75 unidades LSTM en la segunda capa</span>
<span class="n">dropout_layer</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)(</span><span class="n">lstm_layer2</span><span class="p">)</span>  <span class="c1"># Dropout de 0.4</span>
<span class="n">output_layer</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">dropout_layer</span><span class="p">)</span>

<span class="c1"># Compilar el modelo con el optimizador adam</span>
<span class="n">ts_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_layer</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">ts_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>

<span class="c1"># Resumen del modelo</span>
<span class="n">ts_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="c1"># Paso 4: Entrenamiento del modelo con Early Stopping</span>
<span class="n">save_weights_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">,</span> <span class="s1">&#39;PizzaSales_LSTM_weights.</span><span class="si">{epoch:02d}</span><span class="s1">-</span><span class="si">{val_loss:.4f}</span><span class="s1">.keras&#39;</span><span class="p">)</span>
<span class="n">save_best</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">save_weights_at</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrenamiento con batch_size ajustado a 5</span>
<span class="n">history_pizza_LSTM</span> <span class="o">=</span> <span class="n">ts_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  
                                  <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">save_best</span><span class="p">,</span> <span class="n">early_stopping</span><span class="p">],</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Paso 5: Evaluar el mejor modelo</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;PizzaSales_LSTM_weights\.(\d+)-([\d\.]+)\.keras&quot;</span>
<span class="n">best_val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_model_file</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">val_loss</span> <span class="o">&lt;</span> <span class="n">best_val_loss</span><span class="p">:</span>
            <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">val_loss</span>
            <span class="n">best_model_file</span> <span class="o">=</span> <span class="n">file</span>

<span class="k">if</span> <span class="n">best_model_file</span><span class="p">:</span>
    <span class="n">best_model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">,</span> <span class="n">best_model_file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cargando el mejor modelo: </span><span class="si">{</span><span class="n">best_model_file</span><span class="si">}</span><span class="s2"> con val_loss: </span><span class="si">{</span><span class="n">best_val_loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">)</span>

<span class="c1"># Paso 6: Predicci칩n y evaluaci칩n</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">pred_sales</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
<span class="n">pred_sales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pred_sales</span><span class="p">)</span>

<span class="c1"># Definir el rango correcto para las ventas reales (valores reales de la validaci칩n)</span>
<span class="n">real_sales_val</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">][</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">)]</span>

<span class="c1"># Comprobar si las longitudes coinciden antes del c치lculo de MAE</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de predicciones: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pred_sales</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de valores reales: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Aseg칰rate de que las longitudes coinciden</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Calcular RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Calcular MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">real_sales_val</span> <span class="o">-</span> <span class="n">pred_sales</span><span class="p">)</span> <span class="o">/</span> <span class="n">real_sales_val</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAPE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mape</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>

<span class="c1"># Calcular R</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Visualizaci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">real_sales_val</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">pred_sales</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="s1">&#39;Predicted&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Actual vs Predicted Pizza Sales&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Quantity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "functional_3"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較
較<span style="font-weight: bold"> Layer (type)                    </span>較<span style="font-weight: bold"> Output Shape           </span>較<span style="font-weight: bold">       Param # </span>較
較뫡대較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較轎較較較較較較較較較較較較較較較較較較較較較較較較轎較較較較較較較較較較較較較較較較
較 input_layer_3 (<span style="color: #0087ff; text-decoration-color: #0087ff">InputLayer</span>)      較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">7</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)           較             <span style="color: #00af00; text-decoration-color: #00af00">0</span> 較
較럭較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較
較 bidirectional_2 (<span style="color: #0087ff; text-decoration-color: #0087ff">Bidirectional</span>) 較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">7</span>, <span style="color: #00af00; text-decoration-color: #00af00">150</span>)         較        <span style="color: #00af00; text-decoration-color: #00af00">46,200</span> 較
較럭較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較
較 lstm_5 (<span style="color: #0087ff; text-decoration-color: #0087ff">LSTM</span>)                   較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">75</span>)             較        <span style="color: #00af00; text-decoration-color: #00af00">67,800</span> 較
較럭較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較
較 dropout_3 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dropout</span>)             較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">75</span>)             較             <span style="color: #00af00; text-decoration-color: #00af00">0</span> 較
較럭較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較
較 dense_6 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                 較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              較            <span style="color: #00af00; text-decoration-color: #00af00">76</span> 較
較덕較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較억較較較較較較較較較較較較較較較較較較較較較較較較억較較較較較較較較較較較較較較較
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">114,076</span> (445.61 KB)
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">114,076</span> (445.61 KB)
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/50
56/56 - 7s - 121ms/step - loss: 0.1146 - val_loss: 0.1197
Epoch 2/50
56/56 - 2s - 40ms/step - loss: 0.0983 - val_loss: 0.1155
Epoch 3/50
56/56 - 2s - 32ms/step - loss: 0.0955 - val_loss: 0.1127
Epoch 4/50
56/56 - 1s - 21ms/step - loss: 0.0933 - val_loss: 0.1120
Epoch 5/50
56/56 - 2s - 29ms/step - loss: 0.0989 - val_loss: 0.1154
Epoch 6/50
56/56 - 1s - 18ms/step - loss: 0.0968 - val_loss: 0.1233
Epoch 7/50
56/56 - 1s - 12ms/step - loss: 0.0916 - val_loss: 0.1231
Epoch 8/50
56/56 - 1s - 12ms/step - loss: 0.0980 - val_loss: 0.1147
Epoch 9/50
56/56 - 1s - 12ms/step - loss: 0.0958 - val_loss: 0.1125
Cargando el mejor modelo: PizzaSales_LSTM_weights.15-0.1103.keras con val_loss: 0.1103
<span class=" -Color -Color-Bold">1/3</span> <span class=" -Color -Color-Green">較較較較較較</span><span class=" -Color -Color-White">較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">1s</span> 629ms/stepWARNING:tensorflow:5 out of the last 40 calls to &lt;function TensorFlowTrainer.make_predict_function.&lt;locals&gt;.one_step_on_data_distributed at 0x000001BC2E0B00D0&gt; triggered tf.function retracing. Tracing is expensive and the excessive number of tracings could be due to (1) creating @tf.function repeatedly in a loop, (2) passing tensors with different shapes, (3) passing Python objects instead of tensors. For (1), please define your @tf.function outside of the loop. For (2), @tf.function has reduce_retracing=True option that can avoid unnecessary retracing. For (3), please refer to https://www.tensorflow.org/guide/function#controlling_retracing and https://www.tensorflow.org/api_docs/python/tf/function for  more details.
<span class=" -Color -Color-Bold">3/3</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">1s</span> 307ms/step
Longitud de predicciones: 71
Longitud de valores reales: 71
MAE for the validation set: 20.8465
RMSE for the validation set: 31.8997
MAPE for the validation set: 14.87 %
R for the validation set: -0.0354
</pre></div>
</div>
<img alt="_images/2d027268d039032f779973ad3275b2488f54189cd2c3a78ccb4516042b02728d.png" src="_images/2d027268d039032f779973ad3275b2488f54189cd2c3a78ccb4516042b02728d.png" />
</div>
</div>
<p>Los resultados del modelo LSTM para la predicci칩n de ventas de pizza muestran 치reas de mejora. El Error Absoluto Medio (MAE) es de <strong>20.8465</strong>, lo que indica que, en promedio, las predicciones se desv칤an en aproximadamente 21 ventas. El Ra칤z del Error Cuadr치tico Medio (RMSE) de <strong>31.8997</strong> sugiere que el modelo tiene variaciones significativas en sus predicciones, penalizando m치s los errores grandes.</p>
<p>El Porcentaje de Error Absoluto Medio (MAPE) es de <strong>14.87%</strong>, lo que puede considerarse aceptable en algunos contextos, pero a칰n muestra margen de mejora. Sin embargo, el R de <strong>-0.0354</strong> indica que el modelo no se ajusta bien a los datos, sugiriendo que su rendimiento es inferior a simplemente utilizar la media de los valores reales.</p>
<p>En resumen, el modelo LSTM presenta un desempe침o que requiere atenci칩n. Se sugiere optimizar hiperpar치metros, incluir m치s datos relevantes y explorar otras arquitecturas para mejorar la precisi칩n de las predicciones.</p>
<section id="analisis-residuos-del-entrenamiento">
<h3>Analisis residuos del entrenamiento<a class="headerlink" href="#analisis-residuos-del-entrenamiento" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># An치lisis de residuos del entrenamiento</span>

<span class="c1"># Prueba de Jarque-Bera en los residuos del entrenamiento</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prueba de Jarque-Bera para los residuos del entrenamiento: Estad칤stico=</span><span class="si">{</span><span class="n">jb_stat</span><span class="si">}</span><span class="s2">, p-valor=</span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">jb_p_value</span> <span class="o">&gt;</span> <span class="mf">0.05</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos parecen seguir una distribuci칩n normal (p &gt; 0.05)&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)&quot;</span><span class="p">)</span>

<span class="c1"># Gr치ficos de ACF y PACF de los residuos del entrenamiento</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="c1"># Gr치fico de ACF</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n (ACF) de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>

<span class="c1"># Gr치fico de PACF</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Gr치fico de Autocorrelaci칩n Parcial (PACF) de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Paso 7: Predicci칩n y evaluaci칩n en el conjunto de validaci칩n</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">pred_sales</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">real_sales_val</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">][</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">)]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># M칠tricas de validaci칩n</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">))</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">real_sales_val</span> <span class="o">-</span> <span class="n">pred_sales</span><span class="p">)</span> <span class="o">/</span> <span class="n">real_sales_val</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Calcular los residuos del conjunto de entrenamiento</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">pred_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_train</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">real_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">residuos_train</span> <span class="o">=</span> <span class="n">real_train_quantity</span> <span class="o">-</span> <span class="n">pred_train_quantity</span>

<span class="c1"># Longitud de cada trimestre en d칤as (aproximadamente 90 d칤as)</span>
<span class="n">trimestre_dias</span> <span class="o">=</span> <span class="mi">90</span>

<span class="c1"># Dividir los residuos en trimestres</span>
<span class="n">num_trimestres</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuos_train</span><span class="p">)</span> <span class="o">//</span> <span class="n">trimestre_dias</span>
<span class="n">residuos_por_trimestre</span> <span class="o">=</span> <span class="p">[</span><span class="n">residuos_train</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="n">trimestre_dias</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">trimestre_dias</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trimestres</span><span class="p">)]</span>

<span class="c1"># Crear etiquetas para los trimestres</span>
<span class="n">trimestre_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Trimestre </span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_trimestres</span><span class="p">)]</span>

<span class="c1"># Visualizaci칩n de los residuos en un boxplot trimestral</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">residuos_por_trimestre</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_trimestres</span><span class="p">),</span> <span class="n">labels</span><span class="o">=</span><span class="n">trimestre_labels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot Trimestral de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestres&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Prueba de Jarque-Bera para los residuos del entrenamiento: Estad칤stico=282.6545671273233, p-valor=4.191221429062365e-62
Los residuos no siguen una distribuci칩n normal (p &lt;= 0.05)
</pre></div>
</div>
<img alt="_images/fb66106b3e5c1eb23cdeeb3bd57c90aacbf2c65da7c47146029969753771c69f.png" src="_images/fb66106b3e5c1eb23cdeeb3bd57c90aacbf2c65da7c47146029969753771c69f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">3/3</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 13ms/step 
<span class=" -Color -Color-Bold">9/9</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 9ms/step
</pre></div>
</div>
<img alt="_images/f37815b1849214a843b67f19277e5dcf36c3bf18533c0534ea2edcd687d3c487.png" src="_images/f37815b1849214a843b67f19277e5dcf36c3bf18533c0534ea2edcd687d3c487.png" />
</div>
</div>
</section>
<section id="id5">
<h3>Analisis de los residuos de la prediccion<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">real_sales_val</span> <span class="o">-</span> <span class="n">pred_sales</span>

<span class="c1"># Convertir los residuos a un array NumPy y asegurarte de que son de tipo float</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

<span class="c1"># Eliminar NaN, si existen</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">residuals</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">residuals</span><span class="p">)]</span>

<span class="c1"># Realizar la prueba de Jarque-Bera para los residuos</span>
<span class="n">jarque_bera_stat</span><span class="p">,</span> <span class="n">jarque_bera_pvalue</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resultados de la prueba de Jarque-Bera:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Estad칤stico: </span><span class="si">{</span><span class="n">jarque_bera_stat</span><span class="si">}</span><span class="s2">, p-valor: </span><span class="si">{</span><span class="n">jarque_bera_pvalue</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Resultados de la prueba de Jarque-Bera:
Estad칤stico: 138.64306551707668, p-valor: 7.835033286826069e-31
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-original">
<h1>Modelo original<a class="headerlink" href="#modelo-original" title="Link to this heading">#</a></h1>
<section id="modelo-de-prediccion-de-ventas-diarias-de-pizza-utilizando-la-distancia-de-wasserstein">
<h2>Modelo de Predicci칩n de Ventas Diarias de Pizza utilizando la Distancia de Wasserstein<a class="headerlink" href="#modelo-de-prediccion-de-ventas-diarias-de-pizza-utilizando-la-distancia-de-wasserstein" title="Link to this heading">#</a></h2>
<p>En este proyecto, hemos implementado un modelo de predicci칩n para las ventas diarias de pizza basado en la distancia de Wasserstein, una m칠trica dise침ada para comparar distribuciones de probabilidad. A diferencia de los modelos tradicionales como regresiones o modelos ARIMA, este enfoque aprovecha una t칠cnica basada en la similitud entre distribuciones de ventas pasadas para hacer predicciones ponderadas sobre las futuras ventas.</p>
<ol class="arabic simple">
<li><p>Configuraci칩n de las caracter칤sticas del modelo
La predicci칩n de ventas de pizza sigue patrones complejos, influenciados por diferentes factores temporales como la estacionalidad o tendencias a corto plazo. Por eso, decid칤 construir dos caracter칤sticas clave que capturan la din치mica temporal:</p></li>
</ol>
<p>Lag de 30 d칤as: El lag representa las ventas de hace 30 d칤as, introduciendo como predictor el comportamiento que las ventas tuvieron durante ese periodo en el pasado. El uso de lag permite capturar patrones c칤clicos o estacionales de mediano plazo. El valor de 30 d칤as lo eleg칤 despu칠s de analizar que podr칤a reflejar ciertos ciclos que afectan las ventas, como campa침as mensuales o eventos recurrentes.</p>
<p>Media m칩vil de 7 d칤as: Este predictor captura la tendencia a corto plazo, promediando las ventas de la 칰ltima semana. La media m칩vil de 7 d칤as suaviza los picos diarios, lo cual es importante en el contexto de ventas donde los fines de semana suelen tener comportamientos muy diferentes a los d칤as entre semana. Esto ayuda a crear una tendencia m치s general que refleja mejor el comportamiento reciente del mercado.</p>
<p>Estas dos caracter칤sticas permiten capturar tanto las fluctuaciones de corto como de mediano plazo en las ventas, mejorando la capacidad del modelo para detectar patrones repetitivos en las series temporales.</p>
<ol class="arabic simple" start="2">
<li><p>Preparaci칩n y divisi칩n de los datos
Despu칠s de agregar las caracter칤sticas, realic칠 la divisi칩n de los datos en dos conjuntos: uno de entrenamiento y otro de prueba. La estrategia fue utilizar los 칰ltimos 55 d칤as de datos como el conjunto de prueba, que corresponde aproximadamente a dos meses de ventas recientes.</p></li>
<li><p>Normalizaci칩n de las caracter칤sticas
Es importante que las caracter칤sticas (lag y media m칩vil) est칠n normalizadas, es decir, transformadas para que est칠n en una escala comparable. Esto es fundamental en nuestro caso porque, si bien el lag y la media m칩vil son proporcionales a las ventas, podr칤an tener magnitudes diferentes. La normalizaci칩n mediante StandardScaler ajusta las caracter칤sticas para que tengan media cero y desviaci칩n est치ndar uno, lo que asegura que las predicciones ponderadas no se vean dominadas por una caracter칤stica con valores m치s grandes.</p></li>
<li><p>Distancia de Wasserstein
La distancia de Wasserstein se usa com칰nmente en teor칤a de la probabilidad y otras 치reas para medir cu치n diferentes son dos distribuciones. Esta m칠trica, tambi칠n conocida como 띿istancia de la tierra, tiene varias aplicaciones en comparaci칩n de distribuciones y optimizaci칩n.</p></li>
</ol>
<p>쯇or qu칠 usarla? En nuestro caso, la distancia de Wasserstein nos permite comparar la similitud entre los patrones de ventas de diferentes d칤as en el conjunto de entrenamiento. La l칩gica detr치s de esta m칠trica es que los d칤as con distribuciones similares de ventas deber칤an tener comportamientos de ventas futuros similares. Usamos esta m칠trica para hacer predicciones ponderadas en funci칩n de la similitud de los patrones pasados y actuales.</p>
<ol class="arabic simple" start="5">
<li><p>Predicci칩n basada en Wasserstein
El proceso de predicci칩n que implement칠 funciona de la siguiente manera:</p></li>
</ol>
<p>Para cada d칤a en el conjunto de prueba, calculo la distancia de Wasserstein entre ese d칤a y todos los d칤as en el conjunto de entrenamiento. Esto me da una idea de qu칠 tan similares son las ventas de un d칤a de prueba con respecto a los patrones hist칩ricos.</p>
<p>Ponderaci칩n: A partir de la distancia calculada, genero un conjunto de pesos inversamente proporcionales a la distancia (es decir, cuanto m치s peque침a la distancia, mayor es el peso). La idea aqu칤 es que los d칤as que se parecen m치s (menor distancia) deber칤an tener mayor influencia en la predicci칩n.</p>
<p>Predicci칩n final: Con los pesos generados, realizo una predicci칩n ponderada. En otras palabras, se toman los valores de ventas pasadas (del conjunto de entrenamiento) y se ponderan por la similitud con el d칤a que se est치 prediciendo. As칤, los d칤as m치s similares tienen una mayor influencia en la predicci칩n final.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">wasserstein_distance</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Configuraci칩n final</span>
<span class="n">lag</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">window</span> <span class="o">=</span> <span class="mi">7</span>

<span class="c1"># Crear caracter칤sticas basadas en el tiempo</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;lag_</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;moving_average_</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Eliminar filas con valores nulos</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Dividir los datos en conjunto de entrenamiento y prueba</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[:</span><span class="o">-</span><span class="mi">55</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span>

<span class="c1"># Definir las caracter칤sticas (X) y la variable objetivo (y)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Normalizar las caracter칤sticas</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Funci칩n para predecir utilizando la distancia de Wasserstein</span>
<span class="k">def</span> <span class="nf">wasserstein_prediction</span><span class="p">(</span><span class="n">train_X</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_X</span><span class="p">):</span>
    <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_X</span><span class="p">)):</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_X</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">train_X</span><span class="p">)):</span>
            <span class="c1"># Calcular la distancia de Wasserstein</span>
            <span class="n">dist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">wasserstein_distance</span><span class="p">(</span><span class="n">train_y</span><span class="p">[</span><span class="n">j</span><span class="p">:</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">train_y</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> 

        <span class="c1"># Hacer la predicci칩n ponderada</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dist</span><span class="p">)</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weight</span> <span class="o">*</span> <span class="n">train_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weight</span><span class="p">)</span>
        <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>

<span class="c1"># Realizar predicciones</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">wasserstein_prediction</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test_scaled</span><span class="p">)</span>

<span class="c1"># Graficar los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de Entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos Reales (Conjunto de Prueba)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicciones Wasserstein vs Datos Reales - Ventas Diarias de Pizza&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Quantity (Escala Original)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calcular m칠tricas de error</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_test</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">))</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

<span class="c1"># Imprimir las m칠tricas finales</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAPE: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R final: </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e0a6c0c5d873ecefde5d7cacd639ca2d933261f649527aefa0cc36ff4044f630.png" src="_images/e0a6c0c5d873ecefde5d7cacd639ca2d933261f649527aefa0cc36ff4044f630.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAPE: 16.7205%
MAE: 22.6724
RMSE: 32.9382
MSE: 1084.9247
R final: 0.0641
</pre></div>
</div>
</div>
</div>
</section>
<section id="analisis-del-modelo">
<h2>Analisis del Modelo<a class="headerlink" href="#analisis-del-modelo" title="Link to this heading">#</a></h2>
<p>El modelo de predicci칩n de ventas diarias de pizza basado en la distancia de Wasserstein fue evaluado mediante una serie de m칠tricas que reflejan su rendimiento. Estas m칠tricas incluyen el MAPE, MAE, RMSE, MSE y el coeficiente de determinaci칩n (R), y ofrecen una visi칩n general sobre la precisi칩n y efectividad del modelo. A continuaci칩n, analizamos los resultados obtenidos.</p>
<p>La primera m칠trica a considerar es el MAPE (Error Porcentual Absoluto Medio), cuyo valor es del 16.72%. Este valor indica que el modelo, en promedio, se desv칤a un 16.72% de las ventas reales. Desde una perspectiva empresarial, un MAPE inferior al 20% puede considerarse un buen indicador de predicci칩n, especialmente en contextos donde las ventas fluct칰an diariamente por factores estacionales o promociones. Aunque existe margen para mejorar la precisi칩n, este resultado sugiere que el modelo ofrece una predicci칩n razonablemente aceptable en t칠rminos relativos.</p>
<p>Por otro lado, el MAE (Error Absoluto Medio) es de 22.67, lo que significa que el modelo se equivoca, en promedio, en 22.67 pizzas por d칤a. En t칠rminos absolutos, este error puede ser relevante dependiendo del volumen de ventas diarias. En un negocio donde se venden cientos de pizzas al d칤a, este nivel de error puede ser tolerable, aunque reducirlo ser칤a beneficioso para mejorar la precisi칩n en la planificaci칩n operativa.</p>
<p>El RMSE (Ra칤z del Error Cuadr치tico Medio) es de 32.94, una m칠trica que, al penalizar m치s los errores grandes, sugiere que, aunque el modelo realiza predicciones adecuadas en general, existen d칤as en los que los errores son mayores, lo que afecta esta m칠trica. Sin embargo, este valor sigue siendo razonable dentro del contexto de las ventas diarias de pizza, donde los patrones de demanda pueden ser dif칤ciles de predecir debido a fluctuaciones imprevisibles.</p>
<p>El MSE (Error Cuadr치tico Medio), que es el cuadrado del RMSE, es de 1084.92. Aunque esta m칠trica no es tan intuitiva, sigue destacando la presencia de algunos d칤as con errores significativos, que el modelo no ha capturado del todo bien. Sin embargo, dado que el modelo no utiliza factores adicionales como promociones o efectos clim치ticos, estos resultados pueden considerarse satisfactorios para un primer enfoque basado en caracter칤sticas b치sicas como el retardo y la media m칩vil.</p>
<p>Finalmente, el R (Coeficiente de Determinaci칩n), que mide la proporci칩n de la varianza de las ventas diarias explicada por el modelo, es de 0.0641. Aunque este valor indica que el modelo solo explica alrededor del 6.41% de la variabilidad en las ventas, es importante resaltar que esta m칠trica suele ser baja en series temporales con alta volatilidad o en modelos sin muchas variables explicativas. Si bien un R m치s alto ser칤a deseable, este resultado sigue siendo un avance frente a resultados previos y demuestra que el modelo tiene potencial de mejora, especialmente si se integran caracter칤sticas adicionales.</p>
</section>
<section id="id6">
<h2>Analisis de los residuos del entrenamiento<a class="headerlink" href="#id6" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.graphics.tsaplots</span> <span class="kn">import</span> <span class="n">plot_acf</span><span class="p">,</span> <span class="n">plot_pacf</span>

<span class="c1"># Supongamos que el resto del c칩digo anterior ya se ha ejecutado y tienes los residuos del entrenamiento</span>
<span class="n">residuals_train</span> <span class="o">=</span> <span class="n">y_train</span> <span class="o">-</span> <span class="n">wasserstein_prediction</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_train_scaled</span><span class="p">)</span>

<span class="c1"># Boxplot trimestral</span>
<span class="c1"># Crear una columna de per칤odo trimestral para los datos de entrenamiento</span>
<span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;quarter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;quarter&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Boxplot Trimestral de los Residuos del Modelo (Entrenamiento)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Trimestre&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residuos&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Prueba de Jarque-Bera</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estad칤stico de Jarque-Bera: </span><span class="si">{</span><span class="n">jb_stat</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, Valor p: </span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># ACF y PACF de los residuos</span>
<span class="n">max_lags</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Lags menores al 50% del tama침o de la muestra</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plot_acf</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;ACF de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plot_pacf</span><span class="p">(</span><span class="n">residuals_train</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">max_lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">())</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PACF de los Residuos del Entrenamiento&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_2228\3686295087.py:13: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  train_data[&#39;quarter&#39;] = train_data.index.to_period(&#39;Q&#39;)
</pre></div>
</div>
<img alt="_images/6f6534bd8677b9bcb3352a1d8e576e3b6a4000ad1d0943982b3f40632bd333dc.png" src="_images/6f6534bd8677b9bcb3352a1d8e576e3b6a4000ad1d0943982b3f40632bd333dc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Estad칤stico de Jarque-Bera: 1766.1930, Valor p: 0.0000
</pre></div>
</div>
<img alt="_images/5150d2bf857d66fe39e92cba900f7a8799605381434614fec4610c6015a593e9.png" src="_images/5150d2bf857d66fe39e92cba900f7a8799605381434614fec4610c6015a593e9.png" />
</div>
</div>
<p>El primer gr치fico, el <strong>Boxplot Trimestral de los Residuos del Modelo (Entrenamiento)</strong>, presenta la distribuci칩n de los residuos a lo largo de cuatro trimestres (2015Q1 - 2015Q4). En cada trimestre se observa un boxplot que permite analizar c칩mo var칤an los residuos. Los resultados son alentadores en cuanto a la simetr칤a de los residuos, ya que en cada trimestre la mediana se encuentra cercana a cero, lo que indica que el modelo no presenta un sesgo sistem치tico en sus predicciones. No obstante, los boxplots tambi칠n revelan la presencia de valores at칤picos (outliers), tanto por encima de 40 como por debajo de -20. Esto sugiere que el modelo, aunque logra un buen ajuste en general, tiene dificultades para capturar algunos puntos extremos o eventos inusuales en los datos, lo que podr칤a estar relacionado con fluctuaciones bruscas o eventos no capturados por las variables explicativas.</p>
<p>En cuanto a la dispersi칩n, se observa que los residuos est치n distribuidos de manera relativamente uniforme a lo largo de los trimestres, lo que sugiere que no hay un deterioro evidente del modelo en ning칰n periodo espec칤fico. Sin embargo, los outliers en cada trimestre indican que, en algunos casos, las predicciones del modelo difieren significativamente de los valores reales, lo que puede impactar su precisi칩n en situaciones espec칤ficas.</p>
<p>El segundo gr치fico presenta las funciones de <strong>ACF (Autocorrelation Function)</strong> y <strong>PACF (Partial Autocorrelation Function)</strong> de los residuos del entrenamiento. El an치lisis del ACF muestra que la mayor칤a de las correlaciones de los residuos con sus rezagos est치n dentro de las bandas de confianza, lo que es positivo, ya que indica que no hay patrones de autocorrelaci칩n fuertes en los residuos. Esto sugiere que el modelo ha capturado la mayor parte de la estructura temporal de los datos. No obstante, se observa una leve autocorrelaci칩n significativa en el primer rezago, lo que podr칤a indicar que hay alguna dependencia a corto plazo que no ha sido completamente modelada.</p>
<p>El gr치fico de PACF, por su parte, refuerza esta observaci칩n, ya que tambi칠n muestra un pico significativo en el primer rezago. Si bien no hay autocorrelaciones significativas en rezagos posteriores, este comportamiento en el primer rezago sugiere que el modelo podr칤a beneficiarse de ajustes adicionales para capturar mejor las relaciones a corto plazo en los datos.</p>
<p>Finalmente, el <strong>Estad칤stico de Jarque-Bera</strong> y su correspondiente valor p aportan informaci칩n crucial sobre la normalidad de los residuos. Con un estad칤stico de 1766.1930 y un valor p de 0.0000, queda claro que los residuos no siguen una distribuci칩n normal. Este resultado es significativo y confirma que los residuos presentan una desviaci칩n respecto a la normalidad, lo cual podr칤a estar vinculado con los outliers observados en el boxplot y las leves autocorrelaciones vistas en los gr치ficos de ACF y PACF. Este comportamiento sugiere que el modelo no captura perfectamente todas las caracter칤sticas de los datos, especialmente en situaciones extremas, y que podr칤a requerir ajustes adicionales para mejorar su precisi칩n en esos casos.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.diagnostic</span> <span class="kn">import</span> <span class="n">acorr_ljungbox</span>

<span class="c1"># Calcular los residuos</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">wasserstein_prediction</span><span class="p">(</span><span class="n">X_train_scaled</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test_scaled</span><span class="p">)</span>
<span class="n">residuals</span> <span class="o">=</span> <span class="n">y_test</span> <span class="o">-</span> <span class="n">predictions</span>

<span class="c1"># Prueba de Jarque-Bera</span>
<span class="n">jb_stat</span><span class="p">,</span> <span class="n">jb_p_value</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">jarque_bera</span><span class="p">(</span><span class="n">residuals</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estad칤stico de Jarque-Bera: </span><span class="si">{</span><span class="n">jb_stat</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, Valor p: </span><span class="si">{</span><span class="n">jb_p_value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># Prueba de Ljung-Box</span>
<span class="n">ljung_box_result</span> <span class="o">=</span> <span class="n">acorr_ljungbox</span><span class="p">(</span><span class="n">residuals</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
<span class="n">ljung_box_stat</span> <span class="o">=</span> <span class="n">ljung_box_result</span><span class="p">[</span><span class="s1">&#39;lb_stat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ljung_box_p_value</span> <span class="o">=</span> <span class="n">ljung_box_result</span><span class="p">[</span><span class="s1">&#39;lb_pvalue&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estad칤stico de Ljung-Box (lag=10): </span><span class="si">{</span><span class="n">ljung_box_stat</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, Valor p: </span><span class="si">{</span><span class="n">ljung_box_p_value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Estad칤stico de Jarque-Bera: 71.2008, Valor p: 0.0000
Estad칤stico de Ljung-Box (lag=10): 14.3442, Valor p: 0.1579
</pre></div>
</div>
</div>
</div>
<p>El an치lisis de los residuos del modelo muestra aspectos importantes sobre su rendimiento.</p>
<p>El Estad칤stico de Jarque-Bera de 71.2008 con un valor p de 0.0000 indica que los residuos no siguen una distribuci칩n normal. Al tener un valor p extremadamente bajo, se rechaza la hip칩tesis de normalidad, lo que sugiere que los residuos presentan cierta asimetr칤a o curtosis. Aunque este valor es significativamente menor en comparaci칩n con resultados anteriores, sigue indicando que el modelo produce residuos alejados de la distribuci칩n normal, posiblemente por la presencia de valores at칤picos o eventos extremos.</p>
<p>Por otro lado, el Estad칤stico de Ljung-Box con un lag de 10 arroja un valor de 14.3442 y un valor p de 0.1579. Esto indica que no hay autocorrelaci칩n significativa en los primeros 10 rezagos de los residuos, lo que es positivo para el modelo. La falta de autocorrelaci칩n sugiere que el modelo ha capturado correctamente la estructura temporal de la serie hasta ese punto, generando residuos independientes.</p>
<hr class="docutils" />
<p>El modelo <strong>XGBoost</strong> aplicado a la predicci칩n de ventas diarias de pizza ha demostrado ser un enfoque eficaz, obteniendo resultados positivos que lo destacan como una herramienta 칰til para la toma de decisiones. A continuaci칩n, se detallan los resultados obtenidos junto con las razones por las cuales este modelo es beneficioso.</p>
<section id="resultados-del-modelo">
<h3>Resultados del Modelo<a class="headerlink" href="#resultados-del-modelo" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><strong>MAPE</strong>: <strong>16.11%</strong><br />
Este porcentaje indica que, en promedio, las predicciones del modelo se desv칤an un 16.11% de los valores reales. Este nivel de precisi칩n es aceptable para la industria de alimentos, donde las variaciones en la demanda pueden ser influenciadas por m칰ltiples factores.</p></li>
<li><p><strong>MAE</strong>: <strong>19.5215</strong><br />
La media del error absoluto de aproximadamente 19.52 unidades sugiere que el modelo est치 haciendo predicciones que, en promedio, se desv칤an en menos de 20 ventas de las cifras reales. Esto es crucial para planificar la producci칩n y optimizar el inventario.</p></li>
<li><p><strong>RMSE</strong>: <strong>28.3771</strong><br />
Con un error cuadr치tico medio de 28.38, el modelo resalta que, aunque hay algunos errores m치s significativos, el rendimiento general es razonable. Este indicador es especialmente 칰til en el contexto de la gesti칩n de recursos, ya que permite anticipar posibles desajustes en las operaciones.</p></li>
<li><p><strong>R</strong>: <strong>0.3053</strong><br />
Este valor sugiere que el modelo explica aproximadamente el 30.53% de la variabilidad en las ventas diarias. Aunque no es extremadamente alto, indica que el modelo capta algunas tendencias y patrones en los datos, lo que puede guiar a los gerentes en la toma de decisiones basadas en tendencias pasadas.</p></li>
</ul>
</section>
<section id="beneficios-del-modelo">
<h3>Beneficios del Modelo<a class="headerlink" href="#beneficios-del-modelo" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p><strong>Adaptabilidad a los Datos</strong>: XGBoost es un modelo que se adapta bien a conjuntos de datos con caracter칤sticas no lineales, lo que es com칰n en las series temporales de ventas. Esto permite capturar patrones estacionales y tendencias que otros modelos m치s simples podr칤an pasar por alto.</p></li>
<li><p><strong>Optimizaci칩n de Recursos</strong>: Con resultados que muestran un error relativamente bajo, el modelo permite una mejor planificaci칩n de la producci칩n y gesti칩n del inventario. Al predecir la demanda de manera m치s precisa, se pueden reducir costos asociados a la sobreproducci칩n o al desabastecimiento.</p></li>
<li><p><strong>Facilidad de Interpretaci칩n</strong>: XGBoost ofrece caracter칤sticas que permiten entender qu칠 variables son m치s influyentes en las predicciones. Esto proporciona a los gerentes informaci칩n valiosa para ajustar estrategias de marketing y promociones basadas en datos hist칩ricos.</p></li>
<li><p><strong>Escalabilidad</strong>: Dado que el modelo se basa en 치rboles de decisi칩n, es escalable y puede manejar grandes vol칰menes de datos sin un deterioro significativo en el rendimiento, lo que es fundamental en el entorno din치mico de las ventas.</p></li>
</ol>
</section>
<section id="conclusiones">
<h3>Conclusiones<a class="headerlink" href="#conclusiones" title="Link to this heading">#</a></h3>
<p>En resumen, el modelo XGBoost no solo proporciona predicciones relativamente precisas, sino que tambi칠n ofrece beneficios significativos para la gesti칩n operativa. Con un rendimiento que refleja una comprensi칩n adecuada de las tendencias en las ventas, este modelo puede servir como base para futuras mejoras y refinamientos, contribuyendo a la optimizaci칩n de las operaciones y a la satisfacci칩n del cliente.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="eleccion-mejor-modelo">
<h1>Eleccion mejor modelo<a class="headerlink" href="#eleccion-mejor-modelo" title="Link to this heading">#</a></h1>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Modelo</p></th>
<th class="head"><p>MAE</p></th>
<th class="head"><p>RMSE</p></th>
<th class="head"><p>MSE</p></th>
<th class="head"><p>MAPE</p></th>
<th class="head"><p>R</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SARIMA</p></td>
<td><p>21.08</p></td>
<td><p>31.85</p></td>
<td><p>1014.74</p></td>
<td><p>nan%</p></td>
<td><p>0.12</p></td>
</tr>
<tr class="row-odd"><td><p>Suavizado Exponencial</p></td>
<td><p>22.04</p></td>
<td><p>33.61</p></td>
<td><p>1129.33</p></td>
<td><p>16.59%</p></td>
<td><p>0.00</p></td>
</tr>
<tr class="row-even"><td><p>Holt-Winters</p></td>
<td><p>20.63</p></td>
<td><p>31.62</p></td>
<td><p>999.56</p></td>
<td><p>15.96%</p></td>
<td><p>0.13</p></td>
</tr>
<tr class="row-odd"><td><p>Red Neuronal Recurrente</p></td>
<td><p>23.60</p></td>
<td><p>33.65</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>0.22</p></td>
</tr>
<tr class="row-even"><td><p>MLP</p></td>
<td><p>15.88</p></td>
<td><p>22.63</p></td>
<td><p>-</p></td>
<td><p>13.80%</p></td>
<td><p>0.13</p></td>
</tr>
<tr class="row-odd"><td><p>LSTM</p></td>
<td><p>20.85</p></td>
<td><p>31.90</p></td>
<td><p>-</p></td>
<td><p>14.87%</p></td>
<td><p>-0.04</p></td>
</tr>
<tr class="row-even"><td><p>XGBoost</p></td>
<td><p>19.52</p></td>
<td><p>28.38</p></td>
<td><p>805.26</p></td>
<td><p>16.11%</p></td>
<td><p>0.31</p></td>
</tr>
</tbody>
</table>
</div>
<p>El modelo XGBoost se destaca como la mejor opci칩n para predecir las ventas diarias de pizza en comparaci칩n con otros modelos, seg칰n los resultados presentados en la tabla. En primer lugar, XGBoost presenta un R de <strong>0.31</strong>, lo que indica que el modelo explica aproximadamente el 31% de la variabilidad de los datos. Este es un resultado superior en comparaci칩n con otros modelos, como el LSTM (-0.04) y el suavizado exponencial (0.00), lo que sugiere que XGBoost captura mejor las relaciones entre las variables.</p>
<p>Adem치s, con un MAE de <strong>19.52</strong> y un RMSE de <strong>28.38</strong>, el modelo muestra errores de predicci칩n m치s bajos en comparaci칩n con modelos como el suavizado exponencial (MAE de 22.04, RMSE de 33.61) y el LSTM (MAE de 20.85, RMSE de 31.90). Esto indica que las predicciones del XGBoost son m치s cercanas a los valores reales. Su MAPE de <strong>16.11%</strong> tambi칠n es relativamente bajo en comparaci칩n con el suavizado exponencial (16.59%) y el LSTM (14.87%), lo que implica que la precisi칩n de las predicciones es s칩lida en t칠rminos relativos.</p>
<p>Otra ventaja de XGBoost es su eficacia en el manejo de caracter칤sticas que pueden no tener una relaci칩n lineal con la variable objetivo. En este caso, las caracter칤sticas temporales, como los rezagos y la media m칩vil, pueden ser complejas y no lineales, lo que hace que XGBoost, al ser un modelo de 치rbol, sea muy adecuado para esta tarea. Adem치s, es conocido por su eficiencia computacional y por evitar el sobreajuste gracias a su regularizaci칩n, lo que permite obtener un modelo robusto sin necesidad de un gran ajuste de hiperpar치metros.</p>
<p>En resumen, el XGBoost se presenta como la mejor opci칩n para nuestro problema de predicci칩n de ventas de pizza, gracias a su capacidad para capturar relaciones complejas en los datos y su rendimiento superior en las m칠tricas de error, lo que sugiere que ofrece predicciones m치s precisas y confiables en comparaci칩n con otros modelos evaluados.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="markdown.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Markdown Files</p>
      </div>
    </a>
    <a class="right-next"
       href="markdown-notebooks.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebooks with MyST Markdown</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">游늵 Entrega del Trabajo Final</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jefry-llerena-y-david-lizcano">Jefry Llerena y David Lizcano</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asignatura-series-de-tiempo">Asignatura: Series de Tiempo</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#maestria-en-analitica-de-datos">Maestr칤a en Anal칤tica de Datos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">An치lisis y Predicci칩n de las Series Temporales de las Ventas de Pizza</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas">An치lisis y Modelizaci칩n de Ventas Diarias de Pizzas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducci칩n</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-del-proyecto">Estructura del Proyecto</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-datos-10">1. An치lisis Exploratorio de Datos (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark-20">2. Modelos Benchmark (20%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposicion-10">3. Exposici칩n (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original-60">4. Modelo Original (60%)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-los-datos">Analisis exploratorio de los datos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-normalidad-y-grafico-boxplot-para-el-eda">Grafico de normalidad y grafico Boxplot para el EDA</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-acf"><strong>An치lisis de ACF:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-pacf"><strong>An치lisis de PACF:</strong></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-final"><strong>Conclusi칩n Final:</strong></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prueba-shapiro-wilk-diagnostico-de-curtosis-y-otras-pruebas-de-estacionaliad">Prueba Shapiro Wilk, diagnostico de curtosis y otras pruebas de estacionaliad</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#grafico-de-suavizacion-diaria-semanal-de-los-datos-y-grafico-de-medias-y-desviaciones-de-la-serie">Grafico de suavizacion diaria, semanal de los datos y grafico de medias y desviaciones de la serie</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark">Modelos benchmark</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-sarima">Modelo Sarima</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-residuos-del-entrenamiento">Analisis de los residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-los-residuos-de-la-prediccion">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-suavizado-exponencial">Modelo de suavizado exponencial</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-de-entrenamiento">Analisis de residuos de entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-de-la-prediccion">Analisis de residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-holtwinters">Modelo Holtwinters</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-residuos-del-entrenamiento">Analisis de residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Analisis de residuos de la prediccion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-red-neuronal-recuerrente">Modelo red neuronal recuerrente</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Analisis de los residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-mlp">Modelo MLP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Analisis de los residuos de la prediccion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-lstm">Modelo LSTM</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-residuos-del-entrenamiento">Analisis residuos del entrenamiento</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Analisis de los residuos de la prediccion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original">Modelo original</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-prediccion-de-ventas-diarias-de-pizza-utilizando-la-distancia-de-wasserstein">Modelo de Predicci칩n de Ventas Diarias de Pizza utilizando la Distancia de Wasserstein</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-del-modelo">Analisis del Modelo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Analisis de los residuos del entrenamiento</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-del-modelo">Resultados del Modelo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#beneficios-del-modelo">Beneficios del Modelo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones">Conclusiones</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eleccion-mejor-modelo">Eleccion mejor modelo</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      춸 Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>