
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>游늵 Entrega del Trabajo Final &#8212; My sample book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Notebooks with MyST Markdown" href="markdown-notebooks.html" />
    <link rel="prev" title="Markdown Files" href="markdown.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="My sample book - Home"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="My sample book - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to your Jupyter Book
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">游늵 Entrega del Trabajo Final</a></li>






<li class="toctree-l1"><a class="reference internal" href="markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fnotebooks.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/notebooks.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>游늵 Entrega del Trabajo Final</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">游늵 Entrega del Trabajo Final</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jeffry-llerena-y-david-lizcano">Jeffry Llerena y David Lizcano</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asignatura-series-de-tiempo">Asignatura: Series de Tiempo</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#maestria-en-analitica-de-datos">Maestr칤a en Anal칤tica de Datos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">An치lisis y Predicci칩n de las Series Temporales de las Ventas de Pizza</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas">An치lisis y Modelizaci칩n de Ventas Diarias de Pizzas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducci칩n</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-del-proyecto">Estructura del Proyecto</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-datos-eda">1. An치lisis Exploratorio de Datos (EDA)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark-20">2. Modelos Benchmark (20%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposicion-10">3. Exposici칩n (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original-60">4. Modelo Original (60%)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-los-datos">Analisis exploratorio de los datos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-acf"><strong>An치lisis de ACF:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-pacf"><strong>An치lisis de PACF:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-final"><strong>Conclusi칩n Final:</strong></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark">Modelos benchmark</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-sarima">Modelo Sarima</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-suavizado-exponencial">Modelo de suavizado exponencial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-holtwinters">Modelo Holtwinters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-red-neuronal-recuerrente">Modelo red neuronal recuerrente</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-mlp">Modelo MLP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-lstm">Modelo LSTM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original">Modelo original</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-del-modelo">Resultados del Modelo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beneficios-del-modelo">Beneficios del Modelo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones">Conclusiones</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eleccion-mejor-modelo">Eleccion mejor modelo</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="entrega-del-trabajo-final">
<h1>游늵 Entrega del Trabajo Final<a class="headerlink" href="#entrega-del-trabajo-final" title="Link to this heading">#</a></h1>
<section id="jeffry-llerena-y-david-lizcano">
<h2>Jeffry Llerena y David Lizcano<a class="headerlink" href="#jeffry-llerena-y-david-lizcano" title="Link to this heading">#</a></h2>
<section id="asignatura-series-de-tiempo">
<h3>Asignatura: Series de Tiempo<a class="headerlink" href="#asignatura-series-de-tiempo" title="Link to this heading">#</a></h3>
<section id="maestria-en-analitica-de-datos">
<h4>Maestr칤a en Anal칤tica de Datos<a class="headerlink" href="#maestria-en-analitica-de-datos" title="Link to this heading">#</a></h4>
</section>
</section>
</section>
<hr class="docutils" />
<section id="analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">
<h2>An치lisis y Predicci칩n de las Series Temporales de las Ventas de Pizza<a class="headerlink" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza" title="Link to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analisis-y-modelizacion-de-ventas-diarias-de-pizzas">
<h1>An치lisis y Modelizaci칩n de Ventas Diarias de Pizzas<a class="headerlink" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas" title="Link to this heading">#</a></h1>
<section id="introduccion">
<h2>Introducci칩n<a class="headerlink" href="#introduccion" title="Link to this heading">#</a></h2>
<p>Este proyecto se centra en el an치lisis y modelizaci칩n de una serie de tiempo que representa las ventas diarias de pizzas en un restaurante durante un a침o. El objetivo principal es aplicar diferentes t칠cnicas de series de tiempo para predecir las ventas futuras y mejorar la precisi칩n de las estimaciones, lo que permitir치 optimizar la gesti칩n operativa del restaurante.</p>
</section>
<section id="estructura-del-proyecto">
<h2>Estructura del Proyecto<a class="headerlink" href="#estructura-del-proyecto" title="Link to this heading">#</a></h2>
<p>El trabajo est치 estructurado en cuatro componentes clave:</p>
<section id="analisis-exploratorio-de-datos-eda">
<h3>1. An치lisis Exploratorio de Datos (EDA)<a class="headerlink" href="#analisis-exploratorio-de-datos-eda" title="Link to this heading">#</a></h3>
<p>Se realiza una exploraci칩n inicial de los datos para identificar patrones de comportamiento, tendencias y estacionalidades en las ventas. Esta fase orienta la selecci칩n de los modelos a utilizar.</p>
</section>
<section id="modelos-benchmark-20">
<h3>2. Modelos Benchmark (20%)<a class="headerlink" href="#modelos-benchmark-20" title="Link to this heading">#</a></h3>
<p>Se implementan modelos cl치sicos como:</p>
<ul class="simple">
<li><p><strong>Suavizado Exponencial (ES)</strong></p></li>
<li><p><strong>Holt-Winters</strong></p></li>
<li><p><strong>ARIMA</strong></p></li>
<li><p><strong>Redes Neuronales Artificiales (ANNs)</strong></p></li>
</ul>
<p>Estos modelos establecen una l칤nea base de comparaci칩n.</p>
</section>
<section id="exposicion-10">
<h3>3. Exposici칩n (10%)<a class="headerlink" href="#exposicion-10" title="Link to this heading">#</a></h3>
<p>Se presenta el proceso seguido y los resultados obtenidos en clase del sabado 27</p>
</section>
<section id="modelo-original-60">
<h3>4. Modelo Original (60%)<a class="headerlink" href="#modelo-original-60" title="Link to this heading">#</a></h3>
<p>El n칰cleo del proyecto radica en desarrollar un modelo propio que logre superar la precisi칩n de los modelos benchmark, optimizando as칤 las predicciones de ventas.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">combinations</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">adfuller</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.stattools</span> <span class="kn">import</span> <span class="n">acf</span><span class="p">,</span> <span class="n">pacf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.arima_model</span> <span class="kn">import</span> <span class="n">ARIMA</span> <span class="k">as</span> <span class="n">ARIMA</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.tsa.api</span> <span class="k">as</span> <span class="nn">smt</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="analisis-exploratorio-de-los-datos">
<h1>Analisis exploratorio de los datos<a class="headerlink" href="#analisis-exploratorio-de-los-datos" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>

<span class="c1"># Eliminar filas con valores faltantes</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>


<span class="c1"># Verificar cu치ntas observaciones hay en la serie diaria</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N칰mero de observaciones: </span><span class="si">{</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Ajustar el periodo seg칰n el n칰mero de observaciones</span>
<span class="n">periodo</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">24</span> <span class="k">else</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usando periodo: </span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Usar descomposici칩n aditiva</span>
<span class="n">dec</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">seasonal_decompose</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">model</span><span class="o">=</span><span class="s1">&#39;additive&#39;</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="n">periodo</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>N칰mero de observaciones: 358
Usando periodo: 12
</pre></div>
</div>
<img alt="_images/3912b732d171934dbebc46c5a0446c18d6bd03f937c2c41a079cd13ae0b40bcb.png" src="_images/3912b732d171934dbebc46c5a0446c18d6bd03f937c2c41a079cd13ae0b40bcb.png" />
</div>
</div>
<p>Serie original (total_quantity): Aqu칤 se reflejan las fluctuaciones diarias de las ventas de pizzas en el restaurante durante dos a침os. Se notan variaciones importantes y picos, que probablemente corresponden a d칤as de alta demanda como fines de semana o eventos especiales.</p>
<p>Tendencia (Trend): La tendencia muestra que las ventas han tenido periodos de crecimiento y decrecimiento. Aunque hay un incremento durante ciertos meses, se ve una ca칤da hacia el final del periodo, lo que podr칤a estar relacionado con una disminuci칩n estacional en la demanda o alg칰n factor externo.</p>
<p>Componente estacional (Seasonal): El componente estacional sugiere que las ventas tienen un comportamiento c칤clico muy claro. Esto podr칤a estar vinculado a los patrones de consumo regulares, como los fines de semana o feriados, donde se repiten picos de ventas en ciertos d칤as de la semana o en 칠pocas del a침o.</p>
<p>Residuos (Resid): Los residuos representan las variaciones no explicadas por la tendencia y la estacionalidad. Aunque la mayor칤a de los puntos est치n cercanos a cero, hay algunos residuos m치s grandes que podr칤an indicar eventos excepcionales o factores fuera de lo habitual que afectaron las ventas, como promociones o cambios inesperados en la demanda.</p>
<p>En conjunto, esta descomposici칩n sugiere que las ventas de pizzas siguen un patr칩n estacional fuerte, con una tendencia que ha experimentado cambios a lo largo del tiempo y unos residuos que parecen estar mayormente distribuidos de manera aleatoria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Funci칩n para realizar la prueba de Dickey-Fuller y graficar la media m칩vil y desviaci칩n est치ndar</span>
<span class="k">def</span> <span class="nf">test_stationarity</span><span class="p">(</span><span class="n">timeseries</span><span class="p">):</span>
    <span class="c1"># Calcular la media m칩vil y la desviaci칩n est치ndar m칩vil</span>
    <span class="n">MA</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># Ajusta la ventana si es necesario</span>
    <span class="n">MSTD</span> <span class="o">=</span> <span class="n">timeseries</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>  <span class="c1"># Ajusta la ventana si es necesario</span>

    <span class="c1"># Graficar los valores originales, la media m칩vil y la desviaci칩n est치ndar</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">orig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">timeseries</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Original&#39;</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MA</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rolling Mean&#39;</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">MSTD</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Rolling Std&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Rolling Mean &amp; Standard Deviation&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Realizar la prueba de Dickey-Fuller</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Results of Dickey-Fuller Test:&#39;</span><span class="p">)</span>
    <span class="n">dftest</span> <span class="o">=</span> <span class="n">adfuller</span><span class="p">(</span><span class="n">timeseries</span><span class="o">.</span><span class="n">dropna</span><span class="p">(),</span> <span class="n">autolag</span><span class="o">=</span><span class="s1">&#39;AIC&#39;</span><span class="p">)</span>
    <span class="n">dfoutput</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dftest</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Test Statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;#Lags Used&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of Observations Used&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dftest</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dfoutput</span><span class="p">[</span><span class="s1">&#39;Critical Value (</span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dfoutput</span><span class="p">)</span>

<span class="c1"># Aplicar la prueba de Dickey-Fuller y graficar los estad칤sticos m칩viles</span>
<span class="n">test_stationarity</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0a7ed9d08eeb601e136cb84d295a8793fbd92140540bf8e39e8672551aa5c4ee.png" src="_images/0a7ed9d08eeb601e136cb84d295a8793fbd92140540bf8e39e8672551aa5c4ee.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Results of Dickey-Fuller Test:
Test Statistic                  -5.220180
p-value                          0.000008
#Lags Used                      15.000000
Number of Observations Used    342.000000
Critical Value (1%)             -3.449616
Critical Value (5%)             -2.870028
Critical Value (10%)            -2.571292
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Con esto, parece que hay suficiente evidencia para rechazar la hip칩tesis nula de que la serie temporal tiene una ra칤z unitaria, lo que sugiere que la serie es estacionaria. El estad칤stico de prueba es mucho menor que los valores cr칤ticos, y el p-valor es muy bajo, as칤 que estoy bastante seguro de que puedo considerar la serie como estacionaria. Esto es un buen indicio para los siguientes pasos en el an치lisis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Gr치fico de l칤nea</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cantidad Total de Pizzas Vendidas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ventas Diarias de Pizza&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cantidad Vendida&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Histograma</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Distribuci칩n de Cantidades Vendidas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Cantidad Vendida&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frecuencia&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8a1d371582c9947da0cee4ec27ba3b6aa2a5e745a98d857cfa0d2fb7bc55e755.png" src="_images/8a1d371582c9947da0cee4ec27ba3b6aa2a5e745a98d857cfa0d2fb7bc55e755.png" />
<img alt="_images/3cb7f71a32bf21c06eb96e55a95912c55dfb654b6ddc6d6ef156e3e166c7a419.png" src="_images/3cb7f71a32bf21c06eb96e55a95912c55dfb654b6ddc6d6ef156e3e166c7a419.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">statsmodels.tsa.api</span> <span class="k">as</span> <span class="nn">smt</span>
<span class="c1"># Funci칩n para graficar la serie de tiempo y las funciones ACF y PACF</span>
<span class="k">def</span> <span class="nf">tsplot</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="s1">&#39;bmh&#39;</span><span class="p">):</span>
    <span class="c1"># Convertir a Series si no lo es ya</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="c1"># Eliminar valores nulos en la serie</span>
    <span class="n">y_clean</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1"># Verificar que la serie no est칠 vac칤a despu칠s de eliminar nulos</span>
    <span class="k">if</span> <span class="n">y_clean</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La serie de tiempo est치 vac칤a despu칠s de eliminar valores nulos.&quot;</span><span class="p">)</span>

    <span class="c1"># Calcular el n칰mero m치ximo de lags permitido</span>
    <span class="n">max_lags</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_clean</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">lags</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">lags</span><span class="p">,</span> <span class="n">max_lags</span><span class="p">)</span> <span class="k">if</span> <span class="n">lags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_lags</span>

    <span class="c1"># Aplicar estilo y generar los gr치ficos</span>
    <span class="k">with</span> <span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">context</span><span class="p">(</span><span class="n">style</span><span class="p">):</span>    
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
        <span class="n">layout</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">ts_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">colspan</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">acf_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
        <span class="n">pacf_ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Graficar la serie de tiempo</span>
        <span class="n">y_clean</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ts_ax</span><span class="p">)</span>
        
        <span class="c1"># Prueba de Dickey-Fuller</span>
        <span class="n">p_value</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">tsa</span><span class="o">.</span><span class="n">stattools</span><span class="o">.</span><span class="n">adfuller</span><span class="p">(</span><span class="n">y_clean</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ts_ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Time Series Analysis Plots</span><span class="se">\n</span><span class="s1"> Dickey-Fuller: p=</span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_value</span><span class="p">))</span>
        
        <span class="c1"># Graficar ACF y PACF</span>
        <span class="n">smt</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_acf</span><span class="p">(</span><span class="n">y_clean</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">acf_ax</span><span class="p">)</span>
        <span class="n">smt</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_pacf</span><span class="p">(</span><span class="n">y_clean</span><span class="p">,</span> <span class="n">lags</span><span class="o">=</span><span class="n">lags</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">pacf_ax</span><span class="p">)</span>
        
        <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="c1"># Leer el archivo Excel y preparar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN y rellenar valores faltantes con interpolaci칩n</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Verificar cu치ntas observaciones hay en la serie diaria</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N칰mero de observaciones: </span><span class="si">{</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Ajustar el periodo seg칰n el n칰mero de observaciones</span>
<span class="n">periodo</span> <span class="o">=</span> <span class="mi">12</span> <span class="k">if</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">24</span> <span class="k">else</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Usando periodo: </span><span class="si">{</span><span class="n">periodo</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Graficar la serie de tiempo, ACF y PACF, ajustando los lags al tama침o de la muestra</span>
<span class="n">tsplot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">lags</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_9040\159718561.py:55: FutureWarning: Series.interpolate with object dtype is deprecated and will raise in a future version. Call obj.infer_objects(copy=False) before interpolating instead.
  df_grouped_quantity_daily[&#39;total_quantity&#39;] = df_grouped_quantity_daily[&#39;total_quantity&#39;].interpolate(method=&#39;linear&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>N칰mero de observaciones: 365
Usando periodo: 12
</pre></div>
</div>
<img alt="_images/c031967a46f16629303ae1d73abd9dcff3a7b23ac56e6d23cfadffce2ca1adf5.png" src="_images/c031967a46f16629303ae1d73abd9dcff3a7b23ac56e6d23cfadffce2ca1adf5.png" />
</div>
</div>
<p>Con los resultados de la prueba <strong>Dickey-Fuller</strong>, que confirman que la serie es estacionaria, el an치lisis de las gr치ficas de <strong>ACF</strong> y <strong>PACF</strong> se puede ajustar de la siguiente manera:</p>
<section id="analisis-de-acf">
<h2><strong>An치lisis de ACF:</strong><a class="headerlink" href="#analisis-de-acf" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>La ACF muestra un comportamiento de r치pida ca칤da, con las autocorrelaciones dentro de las bandas de significancia, salvo por algunos rezagos que parecen apenas cruzar la l칤nea. Considerando que los datos ya son estacionarios y que los <strong>rezagos menores que cruzan la banda de significancia probablemente no sean significativos</strong> (como lo sugieren las fluctuaciones), esto podr칤a indicar que no hay una dependencia fuerte entre los rezagos.</p></li>
<li><p>Dado que la prueba <strong>Dickey-Fuller</strong> confirm칩 la estacionariedad, estas peque침as autocorrelaciones son m치s bien fluctuaciones aleatorias y no un patr칩n estructurado. En otras palabras, no hay evidencia de autocorrelaciones importantes m치s all치 del primer rezago (que descartamos por tu preferencia de no considerarlo).</p></li>
</ul>
</section>
<section id="analisis-de-pacf">
<h2><strong>An치lisis de PACF:</strong><a class="headerlink" href="#analisis-de-pacf" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>En la PACF, despu칠s de descartar el primer rezago, observamos que los rezagos posteriores caen r치pidamente y no muestran un patr칩n significativo. Esto refuerza la idea de que un modelo <strong>AR(1)</strong> podr칤a ser suficiente para capturar las dependencias presentes en los datos.</p></li>
<li><p>El hecho de que los rezagos en la PACF no muestren valores significativos sugiere que no es necesario incluir t칠rminos autoregresivos adicionales. La prueba <strong>Dickey-Fuller</strong> apoya esta conclusi칩n, ya que no hay evidencia de una ra칤z unitaria que pudiera requerir un modelo m치s complejo.</p></li>
</ul>
</section>
<section id="conclusion-final">
<h2><strong>Conclusi칩n Final:</strong><a class="headerlink" href="#conclusion-final" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>La serie es estacionaria, como lo confirma el test de <strong>Dickey-Fuller</strong>. Las peque침as autocorrelaciones observadas en los gr치ficos de ACF y PACF probablemente no sean significativas, lo que sugiere que no hay dependencia estructurada en los rezagos m치s all치 de lo que puede ser capturado por un modelo <strong>AR(1)</strong>.</p></li>
<li><p>Si bien las fluctuaciones en las autocorrelaciones podr칤an indicar alg칰n componente estacional, este no parece ser muy fuerte. Sin embargo, si se sospecha de estacionalidad, un modelo <strong>SARIMA</strong> podr칤a explorarse para capturar este comportamiento, pero de momento un <strong>ARIMA(1, d, 0)</strong> podr칤a ser adecuado.</p></li>
</ul>
<p>Este an치lisis refuerza la idea de que los rezagos no son significativos y que el modelo que mejor se ajusta a estos datos es uno simple, como <strong>AR(1)</strong>.</p>
<hr class="docutils" />
<p>En este cuadro iba el codigo del proceso que tiene como objetivo encontrar el modelo SARIMA 칩ptimo para predecir la cantidad de ventas diarias de pizza. Se parte de la lectura de los datos de ventas y su agrupaci칩n por fecha para obtener la cantidad total diaria de pizzas vendidas. Luego, se lleva a cabo un proceso de limpieza, interpolaci칩n de valores faltantes y transformaci칩n logar칤tmica de los datos para estabilizar la varianza. A continuaci칩n, se aplica diferenciaci칩n para convertir la serie en estacionaria.</p>
<p>Para la selecci칩n del modelo SARIMA, se utiliza una metodolog칤a automatizada que eval칰a diferentes combinaciones de par치metros (p, d, q) y estacionales (P, D, Q, m) con el fin de identificar la mejor configuraci칩n posible. Una vez determinados los par치metros 칩ptimos, se ajusta el modelo SARIMA definitivo para las predicciones.</p>
<p><strong>Nota:</strong> No se incluye el c칩digo directamente en este informe ya que se encontr칩 el mejor modelo previamente, y a침adirlo al Jupyter Notebook har칤a m치s complejo su montaje sin aportar valor adicional a la exposici칩n del trabajo.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelos-benchmark">
<h1>Modelos benchmark<a class="headerlink" href="#modelos-benchmark" title="Link to this heading">#</a></h1>
<hr class="docutils" />
<section id="modelo-sarima">
<h2>Modelo Sarima<a class="headerlink" href="#modelo-sarima" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pmdarima</span> <span class="k">as</span> <span class="nn">pm</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.statespace.sarimax</span> <span class="kn">import</span> <span class="n">SARIMAX</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Rellenar valores faltantes (opcional)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Aseg칰rate de que la serie de tiempo no tenga valores nulos</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Transformaci칩n logar칤tmica de los datos para estabilizar la varianza</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span>


<span class="c1"># Dividir los datos: Conjunto de entrenamiento y prueba (칰ltimos 55 d칤as)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[:</span><span class="o">-</span><span class="mi">55</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span>

<span class="c1"># Ajustar el modelo SARIMA con los par치metros dados al conjunto de entrenamiento</span>
<span class="n">sarima_model</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">],</span> 
                       <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> 
                       <span class="n">seasonal_order</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">sarima_result</span> <span class="o">=</span> <span class="n">sarima_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">disp</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Hacer predicciones para los pr칩ximos 14 d칤as (conjunto de prueba)</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">get_forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="mi">55</span><span class="p">)</span>
<span class="n">pred_conf</span> <span class="o">=</span> <span class="n">predictions</span><span class="o">.</span><span class="n">conf_int</span><span class="p">()</span>

<span class="c1"># Convertir las predicciones logar칤tmicas de vuelta a escala original</span>
<span class="n">predicted_means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">predictions</span><span class="o">.</span><span class="n">predicted_mean</span><span class="p">)</span>

<span class="c1"># Graficar los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Graficar los datos originales (solo hasta la 칰ltima fecha del conjunto de entrenamiento)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de Entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Graficar los datos reales del conjunto de prueba</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos Reales (Conjunto de Prueba)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Graficar las predicciones</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="c1"># Agregar la zona de confianza</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pred_conf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]),</span> 
                 <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">pred_conf</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Configurar el gr치fico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicciones SARIMAX vs Datos Reales - Ventas Diarias de Pizza (Conjunto de Prueba: 2 Semanas)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Quantity (Escala Original)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># Mostrar el gr치fico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># AIC y BIC del modelo SARIMA</span>
<span class="n">aic</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">aic</span>
<span class="n">bic</span> <span class="o">=</span> <span class="n">sarima_result</span><span class="o">.</span><span class="n">bic</span>

<span class="c1"># Calcular las m칠tricas de error (MAE, RMSE)</span>
<span class="c1"># Para esto necesitamos comparar las predicciones con los valores reales (en escala original)</span>
<span class="c1"># Convertir los datos reales de test a escala original</span>
<span class="n">test_data_original_scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;log_total_quantity&#39;</span><span class="p">])</span>

<span class="c1"># MAE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">)</span>

<span class="c1"># RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">))</span>



<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Supongamos que ya tienes un dataframe llamado df con las columnas &#39;order_date&#39; y &#39;quantity&#39;</span>
<span class="c1"># Agrupar por fecha y sumar la cantidad diaria</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span>

<span class="c1"># Convertir la columna total_quantity en una serie</span>
<span class="n">total_quantity</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span>

<span class="c1"># Obtener los 칰ltimos 55 valores de total_quantity</span>
<span class="n">y_observado</span> <span class="o">=</span> <span class="n">total_quantity</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># Aseg칰rate de convertir a array</span>
<span class="n">y_predicho</span> <span class="o">=</span> <span class="n">predicted_means</span>                   <span class="c1"># Valores predichos</span>

<span class="c1"># Verifica que ambas series tengan la misma longitud</span>
<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_observado</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_predicho</span><span class="p">):</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;La longitud de y_observado y y_predicho debe ser la misma.&quot;</span><span class="p">)</span>

<span class="c1"># Calcular la media de los valores observados</span>
<span class="n">media_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y_observado</span><span class="p">)</span>

<span class="c1"># Calcular SS_tot (Suma total de cuadrados)</span>
<span class="n">SS_tot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_observado</span> <span class="o">-</span> <span class="n">media_y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Calcular SS_res (Suma de cuadrados de los residuos)</span>
<span class="n">SS_res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y_observado</span> <span class="o">-</span> <span class="n">y_predicho</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Calcular R^2</span>
<span class="n">R_squared</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">SS_res</span> <span class="o">/</span> <span class="n">SS_tot</span><span class="p">)</span>


<span class="c1"># Calcular MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">test_data_original_scale</span> <span class="o">-</span> <span class="n">predicted_means</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_data_original_scale</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Calcular MSE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data_original_scale</span><span class="p">,</span> <span class="n">predicted_means</span><span class="p">)</span>

<span class="c1"># Imprimir los resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC: </span><span class="si">{</span><span class="n">aic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC: </span><span class="si">{</span><span class="n">bic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE: </span><span class="si">{</span><span class="n">mape</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:473: ValueWarning: A date index has been provided, but it has no associated frequency information and so will be ignored when e.g. forecasting.
  self._init_dates(dates, freq)
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:966: UserWarning: Non-stationary starting autoregressive parameters found. Using zeros as starting parameters.
  warn(&#39;Non-stationary starting autoregressive parameters&#39;
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:978: UserWarning: Non-invertible starting MA parameters found. Using zeros as starting parameters.
  warn(&#39;Non-invertible starting MA parameters found.&#39;
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\statespace\sarimax.py:997: UserWarning: Non-stationary starting seasonal autoregressive Using zeros as starting parameters.
  warn(&#39;Non-stationary starting seasonal autoregressive&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\base\model.py:607: ConvergenceWarning: Maximum Likelihood optimization failed to converge. Check mle_retvals
  warnings.warn(&quot;Maximum Likelihood optimization failed to &quot;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:837: ValueWarning: No supported index is available. Prediction results will be given with an integer index beginning at `start`.
  return get_prediction_index(
C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\base\tsa_model.py:837: FutureWarning: No supported index is available. In the next version, calling this method in a model without a supported index will result in an exception.
  return get_prediction_index(
</pre></div>
</div>
<img alt="_images/d6097943ed60bf0168317b943647c18fc4ff4ec53e256edcc0a3e7f2a9278d01.png" src="_images/d6097943ed60bf0168317b943647c18fc4ff4ec53e256edcc0a3e7f2a9278d01.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC: -268.8597669914309
BIC: -224.29497332531847
MAE: 21.078274466230365
RMSE: 31.85499764381842
MSE: 1014.7408748876773
MAPE: nan%
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\AppData\Local\Temp\ipykernel_9040\3235105369.py:128: RuntimeWarning: &#39;&lt;&#39; not supported between instances of &#39;int&#39; and &#39;Timestamp&#39;, sort order is undefined for incomparable objects.
  mape = np.mean(np.abs((test_data_original_scale - predicted_means) / test_data_original_scale)) * 100
</pre></div>
</div>
</div>
</div>
<p>El modelo utilizado para predecir las ventas diarias de pizza es un <strong>SARIMAX</strong> con un orden de ( (1, 0, 3) ) y un orden estacional de ( (3, 0, 4, 7) ). Se aplic칩 una transformaci칩n logar칤tmica para estabilizar la varianza y se dividieron los datos en un conjunto de entrenamiento y otro de prueba.</p>
<p>Los resultados del modelo son positivos: el AIC es de -268.86 y el BIC de -224.29, lo que indica un buen ajuste y parsimonia. Las m칠tricas de error muestran un MAE de 21.08 y un RMSE de 31.85, lo que sugiere que las predicciones son razonablemente precisas. El MSE es de 1014.74, proporcionando otra medida del error cuadr치tico medio, aunque el MAPE es indeterminado (nan%). En general, el modelo captura bien la estacionalidad y tendencia en los datos, aunque a칰n hay espacio para mejorar la explicaci칩n de la variabilidad en las ventas.</p>
</section>
<section id="modelo-de-suavizado-exponencial">
<h2>Modelo de suavizado exponencial<a class="headerlink" href="#modelo-de-suavizado-exponencial" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Rellenar valores faltantes (opcional)</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

<span class="c1"># Definir la funci칩n de suavizado exponencial</span>
<span class="k">def</span> <span class="nf">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">lambda_</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">ytilde</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ytilde</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">start</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)):</span>
        <span class="n">ytilde</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">lambda_</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lambda_</span><span class="p">)</span> <span class="o">*</span> <span class="n">ytilde</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">ytilde</span>

<span class="c1"># Aplicar el suavizado exponencial a los datos de ventas de pizza</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">lambda_</span> <span class="o">=</span> <span class="mf">0.13</span>

<span class="c1"># Calcular el 칤ndice de divisi칩n (85% para entrenar, 15% para predecir)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento y prueba</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Suavizado sobre el conjunto de entrenamiento</span>
<span class="n">pizza_smooth1_train</span> <span class="o">=</span> <span class="n">firstsmooth</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">lambda_</span><span class="o">=</span><span class="n">lambda_</span><span class="p">)</span>

<span class="c1"># Hacer predicciones para el 칰ltimo 15% (suavizado exponencial simple)</span>
<span class="n">pizza_smooth1_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">),</span> <span class="n">pizza_smooth1_train</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Calcular el RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Calcular el MAE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Calcular el AIC y BIC</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>  <span class="c1"># N칰mero de observaciones de prueba</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># N칰mero de par치metros (lambda y nivel inicial)</span>
<span class="n">aic_ses</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">k</span>
<span class="n">bic_ses</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span> <span class="o">+</span> <span class="n">k</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>



<span class="c1"># Graficar los datos de entrenamiento, prueba y las predicciones</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ventas de Pizza (Entrenamiento)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">pizza_smooth1_train</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SES $\lambda=</span><span class="si">{</span><span class="n">lambda_</span><span class="si">}</span><span class="s1">$ (Entrenamiento)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="c1"># Mostrar el comportamiento real del 칰ltimo 15%</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">train_size</span><span class="p">:],</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ventas de Pizza (Real - 칔ltimo 15%)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Mostrar las predicciones del 칰ltimo 15%</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">train_size</span><span class="p">:],</span> <span class="n">pizza_smooth1_test</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicci칩n SES (칔ltimo 15%)&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cantidad de Ventas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>

<span class="c1"># Calcular el MSE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE</span>
<span class="c1"># Aseg칰rate de manejar divisiones por cero en el c치lculo</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_test</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>

<span class="c1"># Imprimir las m칠tricas</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE del modelo SES: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE del modelo SES: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE del modelo SES: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE del modelo SES: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>

<span class="c1"># Calcular el R entre los valores reales (y_test) y las predicciones (pizza_smooth1_test)</span>
<span class="n">r_squared</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">pizza_smooth1_test</span><span class="p">)</span>

<span class="c1"># Imprimir el R</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R del modelo SES: </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8dae767b719eaf282e9351a007824f5fccf1800f1f3e30273d4ed11b7ddbe2fe.png" src="_images/8dae767b719eaf282e9351a007824f5fccf1800f1f3e30273d4ed11b7ddbe2fe.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAE del modelo SES: 22.037037037037038
RMSE del modelo SES: 33.605555096342826
MSE del modelo SES: 1129.3333333333333
MAPE del modelo SES: 16.59%
R del modelo SES: -0.0000
</pre></div>
</div>
</div>
</div>
<p>En este an치lisis, se utiliz칩 un modelo de suavizado exponencial simple (SES) para predecir las ventas diarias de pizza. Los datos se cargaron desde un archivo Excel y se agruparon por fecha, manejando los valores faltantes mediante interpolaci칩n. Se aplic칩 el suavizado exponencial con un par치metro (\lambda = 0.13).</p>
<p>Los datos se dividieron en un conjunto de entrenamiento (85%) y otro de prueba (15%). Las m칠tricas de error del modelo fueron:</p>
<ul class="simple">
<li><p><strong>MAE</strong>: 22.04, indicando que las predicciones se desv칤an, en promedio, en 22 ventas.</p></li>
<li><p><strong>RMSE</strong>: 33.61, sugiriendo que los errores son m치s significativos que lo indicado por el MAE.</p></li>
<li><p><strong>MSE</strong>: 1129.33, reflejando una alta variabilidad en las predicciones.</p></li>
<li><p><strong>MAPE</strong>: 16.59%, mostrando que las predicciones se desv칤an un 16.59% de los valores reales.</p></li>
<li><p><strong>R</strong>: -0.0000, indicando que el modelo no explica la variabilidad en los datos.</p></li>
</ul>
<p>Las predicciones se visualizaron junto con las ventas reales, lo que mostr칩 c칩mo se ajustan a los datos. Aunque el SES ofrece un enfoque b치sico, sus m칠tricas sugieren que se podr칤an explorar modelos m치s complejos para mejorar la precisi칩n en las predicciones.</p>
</section>
<section id="modelo-holtwinters">
<h2>Modelo Holtwinters<a class="headerlink" href="#modelo-holtwinters" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">statsmodels.tsa.holtwinters</span> <span class="kn">import</span> <span class="n">ExponentialSmoothing</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha, permitiendo que pandas infiera el formato</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad de ventas diarias (Quantity)</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_ventas</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Ordenar por fecha en caso de que no est칠 ordenado</span>
<span class="n">df_grouped</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span>

<span class="c1"># Definir el tama침o del conjunto de prueba (칰ltimo 15%)</span>
<span class="n">test_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_grouped</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.15</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento (85%) y prueba (15%)</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[:</span><span class="o">-</span><span class="n">test_size</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped</span><span class="p">[</span><span class="o">-</span><span class="n">test_size</span><span class="p">:]</span>

<span class="c1"># Ajustar el modelo Holt-Winters con los par치metros especificados</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> 
                             <span class="n">seasonal</span><span class="o">=</span><span class="s1">&#39;add&#39;</span><span class="p">,</span>  <span class="c1"># Estacionalidad aditiva</span>
                             <span class="n">seasonal_periods</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>  <span class="c1"># Per칤odo estacional de 7 d칤as (semanal)</span>
                             <span class="n">trend</span><span class="o">=</span><span class="s1">&#39;mul&#39;</span><span class="p">)</span>  <span class="c1"># Tendencia multiplicativa</span>
<span class="n">hw_model</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Calcular el AIC y BIC del modelo Holt-Winters</span>
<span class="n">aic</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">aic</span>
<span class="n">bic</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">bic</span>

<span class="c1"># Realizar predicci칩n para el tama침o del conjunto de prueba</span>
<span class="n">forecast</span> <span class="o">=</span> <span class="n">hw_model</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">test_size</span><span class="p">)</span>

<span class="c1"># Calcular MAE y RMSE</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">))</span>

<span class="c1"># Calcular el R entre los valores reales y las predicciones</span>
<span class="n">r_squared</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>



<span class="c1"># Graficar los datos originales, el conjunto de prueba y la predicci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Datos de entrenamiento</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

<span class="c1"># Conjunto de prueba</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Conjunto de prueba real&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>

<span class="c1"># Predicci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicci칩n Holt-Winters&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="c1"># Etiquetas y t칤tulo</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Predicci칩n de Ventas usando Holt-Winters con conjunto de prueba&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Fecha&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Total de Ventas&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="c1"># Rotar etiquetas del eje X</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

<span class="c1"># Mostrar el gr치fico</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calcular MSE y MAPE</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">],</span> <span class="n">forecast</span><span class="p">)</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">forecast</span><span class="p">)</span> <span class="o">/</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_ventas&#39;</span><span class="p">]))</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># MAPE en porcentaje</span>

<span class="c1"># Imprimir las m칠tricas calculadas</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AIC del modelo Holt-Winters: </span><span class="si">{</span><span class="n">aic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;BIC del modelo Holt-Winters: </span><span class="si">{</span><span class="n">bic</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mae</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">rmse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MSE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mse</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAPE del modelo Holt-Winters: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>  <span class="c1"># Formato en porcentaje</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R del modelo Holt-Winters: </span><span class="si">{</span><span class="n">r_squared</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\Davidlizcanom2486\miniconda3\envs\ts_venv\lib\site-packages\statsmodels\tsa\holtwinters\model.py:84: RuntimeWarning: overflow encountered in matmul
  return err.T @ err
</pre></div>
</div>
<img alt="_images/31168de975d11623353e638be7d4dc8f987a0ca1b8ddb60a523ccc64e58f0c18.png" src="_images/31168de975d11623353e638be7d4dc8f987a0ca1b8ddb60a523ccc64e58f0c18.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AIC del modelo Holt-Winters: 1843.6791393360718
BIC del modelo Holt-Winters: 1884.6025688787533
MAE del modelo Holt-Winters: 20.62662396543103
RMSE del modelo Holt-Winters: 31.61585815514776
MSE del modelo Holt-Winters: 999.562486886423
MAPE del modelo Holt-Winters: 15.96%
R del modelo Holt-Winters: 0.1259
</pre></div>
</div>
</div>
</div>
<p>El modelo Holt-Winters se ha implementado para pronosticar las ventas de pizza utilizando datos diarios, permitiendo capturar tanto la tendencia como la estacionalidad. Los resultados del modelo indican un <strong>AIC</strong> de 1843.68 y un <strong>BIC</strong> de 1884.60, lo que sugiere un ajuste razonable a los datos, aunque valores m치s bajos son preferibles para la comparaci칩n con otros modelos. En cuanto a los errores de predicci칩n, el <strong>MAE</strong> es de 20.63, lo que indica que, en promedio, las predicciones del modelo se desv칤an de las ventas reales en aproximadamente 20.63 unidades, sugiriendo un error moderado. El <strong>RMSE</strong> es de 31.62, lo que refleja que las desviaciones de las predicciones son significativas, aunque no extremas. Adem치s, el <strong>MSE</strong> es de 999.56, se침alando un error considerable en las predicciones.</p>
<p>Respecto a la precisi칩n del modelo, el <strong>MAPE</strong> es del 15.96%, lo que indica un error promedio de aproximadamente 15.96% en las predicciones, un nivel que podr칤a considerarse aceptable en algunas aplicaciones, pero que podr칤a ser mejorado. Por 칰ltimo, el <strong>R</strong> es de 0.1259, lo que sugiere que el modelo explica solo alrededor del 12.59% de la variabilidad total de las ventas. Esto implica que hay otros factores o variaciones en los datos que el modelo no est치 capturando adecuadamente. En conclusi칩n, aunque el modelo Holt-Winters ha proporcionado un ajuste moderado a los datos de ventas de pizza, los errores de predicci칩n sugieren que se puede mejorar, y el bajo valor de R indica que no est치 capturando bien la variabilidad en los datos, lo que podr칤a llevar a explorar otros enfoques de modelado o la inclusi칩n de variables adicionales para mejorar el pron칩stico.</p>
</section>
<section id="modelo-red-neuronal-recuerrente">
<h2>Modelo red neuronal recuerrente<a class="headerlink" href="#modelo-red-neuronal-recuerrente" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>

<span class="c1"># Leer el archivo y procesar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Convertimos la serie de tiempo a un array</span>
<span class="n">time_series</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Normalizar los datos para que est칠n en un rango adecuado</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">time_series_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">time_series</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Crear el dataset para la RNN con look_back = 28</span>
<span class="k">def</span> <span class="nf">create_dataset</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">look_back</span><span class="o">=</span><span class="mi">28</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span> <span class="o">-</span> <span class="n">look_back</span><span class="p">):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">series</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">look_back</span> <span class="o">=</span> <span class="mi">28</span>  <span class="c1"># Ajuste de par치metro</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">create_dataset</span><span class="p">(</span><span class="n">time_series_scaled</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>

<span class="c1"># Reshape para el formato adecuado</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Dividir el conjunto de datos en entrenamiento y prueba (85% entrenamiento, 15% prueba)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Definir la red RNN y entrenarla con hidden_size = 20 y learning_rate = 0.005</span>
<span class="k">def</span> <span class="nf">relu</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">relu_derivative</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">RNN_BPTT</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span> <span class="n">truncation</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">=</span> <span class="n">learning_rate</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">truncation</span> <span class="o">=</span> <span class="n">truncation</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>  
        <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">relu</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
        
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span>

    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">dU</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">U</span><span class="p">)</span>
        <span class="n">dW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="n">dV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="p">)</span>
        <span class="n">db</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span>
        <span class="n">dc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="n">dh_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_hat</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>  <span class="c1"># Derivada de la p칠rdida (MSE)</span>
            <span class="n">dV</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">dy</span><span class="p">)</span>
            <span class="n">dc</span> <span class="o">+=</span> <span class="n">dy</span>
            <span class="n">dh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">dh_next</span>
            <span class="n">dh_raw</span> <span class="o">=</span> <span class="n">dh</span> <span class="o">*</span> <span class="n">relu_derivative</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="n">dU</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">dh_raw</span><span class="p">)</span>
            <span class="n">dW</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">[</span><span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dh_raw</span><span class="p">)</span>
            <span class="n">db</span> <span class="o">+=</span> <span class="n">dh_raw</span>
            <span class="n">dh_next</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">dh_raw</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        
        <span class="c1"># Clipping de gradientes para evitar explosi칩n</span>
        <span class="k">for</span> <span class="n">dparam</span> <span class="ow">in</span> <span class="p">[</span><span class="n">dU</span><span class="p">,</span> <span class="n">dW</span><span class="p">,</span> <span class="n">dV</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">dc</span><span class="p">]:</span>
            <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">dparam</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">dparam</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">U</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dW</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">db</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">-=</span> <span class="bp">self</span><span class="o">.</span><span class="n">learning_rate</span> <span class="o">*</span> <span class="n">dc</span>

    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backward</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">output</span><span class="p">))</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Epoch </span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">, Loss: </span><span class="si">{</span><span class="n">loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Inicializar la red con los par치metros indicados</span>
<span class="n">input_size</span> <span class="o">=</span> <span class="n">look_back</span>
<span class="n">hidden_size</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Ajuste de par치metro</span>
<span class="n">output_size</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.005</span>  <span class="c1"># Ajuste de par치metro</span>
<span class="n">rnn</span> <span class="o">=</span> <span class="n">RNN_BPTT</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">)</span>
<span class="n">rnn</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

<span class="c1"># Hacer predicciones en el conjunto de entrenamiento y prueba</span>
<span class="n">predictions_train</span> <span class="o">=</span> <span class="n">rnn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">predictions_test</span> <span class="o">=</span> <span class="n">rnn</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Desnormalizar las predicciones para obtener los valores originales</span>
<span class="n">predictions_train_descaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)</span>
<span class="n">predictions_test_descaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">predictions_test</span><span class="p">)</span>

<span class="c1"># Graficar las predicciones y la serie original</span>
<span class="k">def</span> <span class="nf">plot_predictions</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">predictions_train</span><span class="p">,</span> <span class="n">predictions_test</span><span class="p">,</span> <span class="n">look_back</span><span class="p">):</span>
    <span class="n">predictions_train</span> <span class="o">=</span> <span class="n">predictions_train</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">predictions_test</span> <span class="o">=</span> <span class="n">predictions_test</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Crear una serie de tiempo para las predicciones alineada con la serie original</span>
    <span class="n">prediction_train_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
    <span class="n">prediction_train_shifted</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># Inicializar con NaN para dejar huecos</span>
    <span class="n">prediction_train_shifted</span><span class="p">[</span><span class="n">look_back</span><span class="p">:</span><span class="n">look_back</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)]</span> <span class="o">=</span> <span class="n">predictions_train</span>  <span class="c1"># Desplazar predicciones del conjunto de entrenamiento</span>

    <span class="n">prediction_test_shifted</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">time_series</span><span class="p">)</span>
    <span class="n">prediction_test_shifted</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>  <span class="c1"># Inicializar con NaN para dejar huecos</span>
    <span class="n">prediction_test_shifted</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">predictions_train</span><span class="p">)</span> <span class="o">+</span> <span class="n">look_back</span><span class="p">:]</span> <span class="o">=</span> <span class="n">predictions_test</span>  <span class="c1"># Desplazar predicciones del conjunto de prueba</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Serie de tiempo original&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction_train_shifted</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicciones - Entrenamiento&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">prediction_test_shifted</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Predicciones - Prueba&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Comparaci칩n de la serie de tiempo y las predicciones (Entrenamiento vs Prueba)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Tiempo&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Cantidad total&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Graficar las predicciones</span>
<span class="n">plot_predictions</span><span class="p">(</span><span class="n">time_series</span><span class="p">,</span> <span class="n">predictions_train_descaled</span><span class="p">,</span> <span class="n">predictions_test_descaled</span><span class="p">,</span> <span class="n">look_back</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Calcular el R^2</span>
<span class="k">def</span> <span class="nf">calculate_r_squared</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el MSE</span>
<span class="k">def</span> <span class="nf">calculate_mse</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el RMSE</span>
<span class="k">def</span> <span class="nf">calculate_rmse</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">))</span>

<span class="c1"># Calcular el AIC</span>
<span class="k">def</span> <span class="nf">calculate_aic</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">aic</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">num_params</span>
    <span class="k">return</span> <span class="n">aic</span>

<span class="c1"># Calcular el BIC</span>
<span class="k">def</span> <span class="nf">calculate_bic</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">):</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_true</span><span class="p">)</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span>
    <span class="n">sse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">resid</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">bic</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sse</span><span class="o">/</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">num_params</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bic</span>

<span class="c1"># Predicciones desnormalizadas (usadas para evaluar en la escala original)</span>
<span class="n">y_train_pred</span> <span class="o">=</span> <span class="n">predictions_train_descaled</span>
<span class="n">y_test_pred</span> <span class="o">=</span> <span class="n">predictions_test_descaled</span>

<span class="c1"># Valores reales (sin escalar, para compararlos correctamente con las predicciones desnormalizadas)</span>
<span class="n">y_train_true</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">)</span>
<span class="n">y_test_true</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)</span>

<span class="c1"># N칰mero de par치metros del modelo RNN: U, W, V, b, c</span>
<span class="n">num_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">V</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">rnn</span><span class="o">.</span><span class="n">c</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Calcular m칠tricas para el conjunto de entrenamiento</span>
<span class="n">r2_train</span> <span class="o">=</span> <span class="n">calculate_r_squared</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">mse_train</span> <span class="o">=</span> <span class="n">calculate_mse</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">rmse_train</span> <span class="o">=</span> <span class="n">calculate_rmse</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">aic_train</span> <span class="o">=</span> <span class="n">calculate_aic</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>
<span class="n">bic_train</span> <span class="o">=</span> <span class="n">calculate_bic</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>

<span class="c1"># Calcular m칠tricas para el conjunto de prueba</span>
<span class="n">r2_test</span> <span class="o">=</span> <span class="n">calculate_r_squared</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">mse_test</span> <span class="o">=</span> <span class="n">calculate_mse</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">rmse_test</span> <span class="o">=</span> <span class="n">calculate_rmse</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">aic_test</span> <span class="o">=</span> <span class="n">calculate_aic</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>
<span class="n">bic_test</span> <span class="o">=</span> <span class="n">calculate_bic</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">,</span> <span class="n">num_params</span><span class="p">)</span>



<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Unir las predicciones y los valores reales de entrenamiento y prueba</span>
<span class="n">y_pred_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">predictions_train_descaled</span><span class="p">,</span> <span class="n">predictions_test_descaled</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">y_true_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_train</span><span class="p">),</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">y_test</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Calcular el R^2 para el conjunto total</span>
<span class="n">r2_total</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_true_total</span><span class="p">,</span> <span class="n">y_pred_total</span><span class="p">)</span>

<span class="c1"># Mostrar el R^2 total</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R^2 total: </span><span class="si">{</span><span class="n">r2_total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span>

<span class="c1"># Calcular el MAE</span>
<span class="k">def</span> <span class="nf">calculate_mae</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Calcular el MAPE</span>
<span class="k">def</span> <span class="nf">calculate_mape</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_true</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_true</span> <span class="o">-</span> <span class="n">y_pred</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_true</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># MAPE como porcentaje</span>

<span class="c1"># Calcular m칠tricas para el conjunto de entrenamiento</span>
<span class="n">mae_train</span> <span class="o">=</span> <span class="n">calculate_mae</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>
<span class="n">mape_train</span> <span class="o">=</span> <span class="n">calculate_mape</span><span class="p">(</span><span class="n">y_train_true</span><span class="p">,</span> <span class="n">y_train_pred</span><span class="p">)</span>

<span class="c1"># Calcular m칠tricas para el conjunto de prueba</span>
<span class="n">mae_test</span> <span class="o">=</span> <span class="n">calculate_mae</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>
<span class="n">mape_test</span> <span class="o">=</span> <span class="n">calculate_mape</span><span class="p">(</span><span class="n">y_test_true</span><span class="p">,</span> <span class="n">y_test_pred</span><span class="p">)</span>




<span class="c1"># Mostrar las m칠tricas totales</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">M칠tricas totales:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R^2 total: </span><span class="si">{</span><span class="n">r2_total</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;RMSE: </span><span class="si">{</span><span class="n">rmse_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MAE: </span><span class="si">{</span><span class="n">mae_test</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 0, Loss: 0.12164039761673912
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 100, Loss: 0.013481994651011244
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 200, Loss: 0.012244168062757663
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 300, Loss: 0.011484378084508577
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 400, Loss: 0.011117012316791635
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 500, Loss: 0.010855423461059527
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 600, Loss: 0.010659728140398417
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 700, Loss: 0.01048143168729008
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 800, Loss: 0.010344995700001988
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 900, Loss: 0.010163722849897259
</pre></div>
</div>
<img alt="_images/75d22d37cda491d3fd0d38c64c5084c64ba42c73b1e1415fc2a526c3eb8d9fcc.png" src="_images/75d22d37cda491d3fd0d38c64c5084c64ba42c73b1e1415fc2a526c3eb8d9fcc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R^2 total: 0.21340202634783434

M칠tricas totales:
R^2 total: 0.21340202634783434
RMSE: 34.53441127085229
MAE: 24.94745958799281
</pre></div>
</div>
</div>
</div>
<p>La evaluaci칩n de la red neuronal recurrente (RNN) revel칩 un coeficiente de determinaci칩n (R) de 0.2179, lo que significa que el modelo es capaz de explicar aproximadamente el 21.79% de la variabilidad observada en las ventas de pizza. Esto indica que, aunque la RNN logra capturar alguna relaci칩n entre los datos, una gran parte de la variabilidad, que corresponde al 78.21%, sigue sin ser explicada, lo que puede sugerir la influencia de factores externos o patrones no identificados en los datos.</p>
<p>Adem치s, se calcularon m칠tricas adicionales que complementan la evaluaci칩n del rendimiento del modelo. El error cuadr치tico medio (RMSE) fue de 33.65, lo que refleja la magnitud promedio de los errores en las predicciones. Este valor sugiere que las predicciones de ventas de pizza pueden desviarse significativamente de los valores reales. Por otro lado, el error absoluto medio (MAE) fue de 23.60, indicando que, en promedio, el modelo se desvi칩 de las ventas reales por esta cantidad.</p>
<p>En conjunto, estas m칠tricas proporcionan una visi칩n general del rendimiento de la RNN, sugiriendo que, aunque el modelo tiene alguna capacidad predictiva, tambi칠n enfrenta limitaciones significativas en su precisi칩n y en la explicaci칩n de la variabilidad de las ventas.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-mlp">
<h1>Modelo MLP<a class="headerlink" href="#modelo-mlp" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">mean_absolute_error</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.models</span> <span class="kn">import</span> <span class="n">Model</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.layers</span> <span class="kn">import</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Dropout</span>
<span class="kn">from</span> <span class="nn">tensorflow.keras.callbacks</span> <span class="kn">import</span> <span class="n">EarlyStopping</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Resamplear la serie de tiempo a una frecuencia diaria y eliminar los valores nulos</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

<span class="c1"># Reemplazar ceros con NaN y luego eliminar filas con NaN</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">})</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Escalar los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Asegurarse de eliminar posibles NaN en las series</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Dividir en conjuntos de entrenamiento y validaci칩n (85% entrenamiento, 15% validaci칩n)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.85</span><span class="p">)</span>
<span class="n">df_train</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">train_size</span><span class="p">]</span>
<span class="n">df_val</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Crear las ventanas de tiempo (7 d칤as)</span>
<span class="k">def</span> <span class="nf">makeXy</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">nb_timesteps</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb_timesteps</span><span class="p">,</span> <span class="n">ts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">nb_timesteps</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;scaled_quantity&#39;</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>

<span class="c1"># Definir el modelo MLP con los mejores hiperpar치metros</span>
<span class="n">input_layer</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,))</span>
<span class="n">dense1</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">input_layer</span><span class="p">)</span>  <span class="c1"># units_1 = 256</span>
<span class="n">dense2</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">96</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">dense1</span><span class="p">)</span>        <span class="c1"># units_2 = 96</span>
<span class="n">dense3</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">48</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">)(</span><span class="n">dense2</span><span class="p">)</span>        <span class="c1"># units_3 = 48</span>
<span class="n">dropout_layer</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)(</span><span class="n">dense3</span><span class="p">)</span>                 <span class="c1"># dropout = 0.3</span>
<span class="n">output_layer</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">dropout_layer</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_layer</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_squared_error&#39;</span><span class="p">)</span>

<span class="c1"># Implementar Early Stopping</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrenar el modelo</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">early_stopping</span><span class="p">])</span>

<span class="c1"># Predecir los valores en el conjunto de entrenamiento y validaci칩n</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">pred_train_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_train</span><span class="p">)</span>

<span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">pred_val_quantity</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">pred_val</span><span class="p">)</span>

<span class="c1"># Concatenar las predicciones y los valores reales (entrenamiento + validaci칩n)</span>
<span class="n">pred_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">pred_train_quantity</span><span class="p">,</span> <span class="n">pred_val_quantity</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">real_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>



<span class="c1"># Graficar resultados (entrenamiento + validaci칩n)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Graficar el conjunto de entrenamiento</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">df_train</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Entrenamiento Real&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_train</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">pred_train_quantity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Entrenamiento Predicho&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># Graficar el conjunto de validaci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_val</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validaci칩n Real&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_val</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">7</span><span class="p">:],</span> <span class="n">pred_val_quantity</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Validaci칩n Predicho&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Ventas Reales vs Predichas (Entrenamiento y Validaci칩n)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ventas de Pizzas&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calcular MAE y RMSE para todo el conjunto</span>
<span class="n">mae_total</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">real_total</span><span class="p">,</span> <span class="n">pred_total</span><span class="p">)</span>
<span class="n">rmse_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">real_total</span><span class="p">,</span> <span class="n">pred_total</span><span class="p">))</span>

<span class="c1"># Calcular MAPE</span>
<span class="n">mape_total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">real_total</span> <span class="o">-</span> <span class="n">pred_total</span><span class="p">)</span> <span class="o">/</span> <span class="n">real_total</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>



<span class="n">r2_val</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">df_val</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">pred_val_quantity</span><span class="p">)</span>

<span class="c1"># Imprimir los resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAE total: </span><span class="si">{</span><span class="n">mae_total</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RMSE total: </span><span class="si">{</span><span class="n">rmse_total</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAPE total: </span><span class="si">{</span><span class="n">mape_total</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R-cuadrado (validaci칩n): </span><span class="si">{</span><span class="n">r2_val</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 2s - 110ms/step - loss: 0.0314 - val_loss: 0.0373
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 2/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 21ms/step - loss: 0.0197 - val_loss: 0.0345
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 3/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 6ms/step - loss: 0.0180 - val_loss: 0.0333
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 4/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0157 - val_loss: 0.0325
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 5/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0163 - val_loss: 0.0319
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 6/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0140 - val_loss: 0.0321
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 7/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0152 - val_loss: 0.0312
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 8/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0147 - val_loss: 0.0324
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 9/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0148 - val_loss: 0.0332
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 10/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 6ms/step - loss: 0.0143 - val_loss: 0.0313
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 11/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0148 - val_loss: 0.0307
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 12/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0140 - val_loss: 0.0315
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 13/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0145 - val_loss: 0.0310
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 14/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 10ms/step - loss: 0.0143 - val_loss: 0.0309
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 15/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 6ms/step - loss: 0.0139 - val_loss: 0.0326
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 16/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 6ms/step - loss: 0.0139 - val_loss: 0.0309
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 17/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0120 - val_loss: 0.0335
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 18/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 6ms/step - loss: 0.0150 - val_loss: 0.0314
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 19/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 10ms/step - loss: 0.0139 - val_loss: 0.0313
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 20/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0126 - val_loss: 0.0299
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 21/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0113 - val_loss: 0.0305
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 22/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 10ms/step - loss: 0.0122 - val_loss: 0.0300
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 23/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 6ms/step - loss: 0.0125 - val_loss: 0.0323
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 24/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0121 - val_loss: 0.0307
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 25/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0130 - val_loss: 0.0307
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 26/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0115 - val_loss: 0.0311
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 27/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0126 - val_loss: 0.0300
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 28/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0125 - val_loss: 0.0301
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 29/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0109 - val_loss: 0.0305
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 30/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0124 - val_loss: 0.0300
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 31/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0116 - val_loss: 0.0293
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 32/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0111 - val_loss: 0.0311
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 33/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0122 - val_loss: 0.0295
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 34/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0118 - val_loss: 0.0305
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 35/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0122 - val_loss: 0.0298
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 36/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0107 - val_loss: 0.0293
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 37/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0108 - val_loss: 0.0294
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 38/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0113 - val_loss: 0.0305
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 39/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0107 - val_loss: 0.0288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 40/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0104 - val_loss: 0.0293
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 41/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0106 - val_loss: 0.0297
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 42/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 10ms/step - loss: 0.0108 - val_loss: 0.0290
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 43/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0104 - val_loss: 0.0296
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 44/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 7ms/step - loss: 0.0104 - val_loss: 0.0305
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 45/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0113 - val_loss: 0.0292
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 46/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0101 - val_loss: 0.0290
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 47/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0105 - val_loss: 0.0288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 48/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 5ms/step - loss: 0.0103 - val_loss: 0.0303
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 49/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 6ms/step - loss: 0.0110 - val_loss: 0.0291
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 50/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0106 - val_loss: 0.0285
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 51/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0110 - val_loss: 0.0291
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 52/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0103 - val_loss: 0.0284
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 53/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0096 - val_loss: 0.0278
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 54/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 10ms/step - loss: 0.0102 - val_loss: 0.0292
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 55/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0094 - val_loss: 0.0290
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 56/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 10ms/step - loss: 0.0106 - val_loss: 0.0285
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 57/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 16ms/step - loss: 0.0103 - val_loss: 0.0289
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 58/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0102 - val_loss: 0.0294
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 59/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0096 - val_loss: 0.0286
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 60/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 18ms/step - loss: 0.0100 - val_loss: 0.0281
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 61/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0092 - val_loss: 0.0289
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 62/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0092 - val_loss: 0.0283
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 63/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0096 - val_loss: 0.0300
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 64/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0090 - val_loss: 0.0288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 65/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0099 - val_loss: 0.0281
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 66/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0089 - val_loss: 0.0289
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 67/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0095 - val_loss: 0.0287
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 68/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 7ms/step - loss: 0.0092 - val_loss: 0.0288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 69/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0093 - val_loss: 0.0282
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 70/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 10ms/step - loss: 0.0087 - val_loss: 0.0294
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 71/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 7ms/step - loss: 0.0089 - val_loss: 0.0285
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 72/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 9ms/step - loss: 0.0090 - val_loss: 0.0292
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 73/100
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19/19 - 0s - 8ms/step - loss: 0.0088 - val_loss: 0.0289
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold"> 1/10</span> <span class=" -Color -Color-Green">較較</span><span class=" -Color -Color-White">較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 74ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">10/10</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 7ms/step 
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">10/10</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 9ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Bold">1/2</span> <span class=" -Color -Color-Green">較較較較較較較較較較</span><span class=" -Color -Color-White">較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 31ms/step
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
<span class=" -Color -Color-Bold">2/2</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">0s</span> 0s/step  
</pre></div>
</div>
</div>
</div>
<p>El modelo de perceptr칩n multicapa (MLP) utilizado para la predicci칩n de ventas de pizzas ha mostrado resultados que merecen un an치lisis detallado. En t칠rminos de rendimiento, las m칠tricas obtenidas son las siguientes: el error absoluto medio (MAE) es de 15.8777, el error cuadr치tico medio (RMSE) se sit칰a en 22.6327, y el porcentaje de error absoluto medio (MAPE) es del 13.80%.</p>
<p>Una de las m칠tricas m치s destacadas es el R de la validaci칩n, que se ha registrado en 0.1251. Este valor indica que el modelo es capaz de explicar aproximadamente el 12.51% de la variabilidad en las ventas de pizzas. Aunque esto sugiere que hay un potencial para mejorar la capacidad del modelo en t칠rminos de ajuste, tambi칠n resalta que el MLP no ha logrado captar completamente las din치micas subyacentes en los datos. La tasa de error en las predicciones, representada por el MAE y el RMSE, tambi칠n sugiere que las predicciones no son completamente precisas, aunque el MAPE indica un nivel de error aceptable en t칠rminos porcentuales.</p>
<p>Es importante considerar que el MLP es un modelo flexible y puede mejorarse mediante t칠cnicas como la optimizaci칩n de hiperpar치metros, la regularizaci칩n o el aumento de la complejidad del modelo con capas adicionales o diferentes funciones de activaci칩n. Asimismo, explorar la inclusi칩n de caracter칤sticas adicionales, como variables externas que puedan influir en las ventas, podr칤a enriquecer el modelo y ofrecer una mayor capacidad de predicci칩n.</p>
<section id="modelo-lstm">
<h2>Modelo LSTM<a class="headerlink" href="#modelo-lstm" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">Dense</span><span class="p">,</span> <span class="n">Input</span><span class="p">,</span> <span class="n">Dropout</span><span class="p">,</span> <span class="n">Bidirectional</span>
<span class="kn">from</span> <span class="nn">keras.layers</span> <span class="kn">import</span> <span class="n">LSTM</span>
<span class="kn">from</span> <span class="nn">keras.models</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">load_model</span>
<span class="kn">from</span> <span class="nn">keras.callbacks</span> <span class="kn">import</span> <span class="n">ModelCheckpoint</span><span class="p">,</span> <span class="n">EarlyStopping</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Paso 1: Leer y procesar los datos</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">df_grouped_quantity</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">0</span><span class="p">:</span> <span class="kc">None</span><span class="p">})</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="c1"># Escalar los datos</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">(</span><span class="n">feature_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">df_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">df_grouped_quantity_daily</span><span class="p">)</span>

<span class="c1"># Paso 2: Crear secuencias para la LSTM</span>
<span class="k">def</span> <span class="nf">makeXy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">-</span> <span class="n">steps</span><span class="p">):</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">steps</span><span class="p">])</span>
        <span class="n">y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">steps</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Definir pasos de tiempo (7 d칤as para predecir el siguiente)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">makeXy</span><span class="p">(</span><span class="n">df_scaled</span><span class="p">,</span> <span class="n">steps</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span>

<span class="c1"># Dividir los datos en entrenamiento y validaci칩n (80% entrenamiento, 20% validaci칩n)</span>
<span class="n">train_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.8</span><span class="p">)</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_val</span> <span class="o">=</span> <span class="n">X</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">X</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>
<span class="n">y_train</span><span class="p">,</span> <span class="n">y_val</span> <span class="o">=</span> <span class="n">y</span><span class="p">[:</span><span class="n">train_size</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">train_size</span><span class="p">:]</span>

<span class="c1"># Reshape a formato 3D: (muestras, pasos de tiempo, caracter칤sticas)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">X_val</span> <span class="o">=</span> <span class="n">X_val</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">X_val</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>

<span class="c1"># Paso 3: Crear el modelo Bidirectional LSTM con las configuraciones especificadas</span>
<span class="n">input_layer</span> <span class="o">=</span> <span class="n">Input</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">lstm_layer1</span> <span class="o">=</span> <span class="n">Bidirectional</span><span class="p">(</span><span class="n">LSTM</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">True</span><span class="p">))(</span><span class="n">input_layer</span><span class="p">)</span>  <span class="c1"># 75 unidades LSTM en la capa Bidirectional</span>
<span class="n">lstm_layer2</span> <span class="o">=</span> <span class="n">LSTM</span><span class="p">(</span><span class="mi">75</span><span class="p">,</span> <span class="n">return_sequences</span><span class="o">=</span><span class="kc">False</span><span class="p">)(</span><span class="n">lstm_layer1</span><span class="p">)</span>  <span class="c1"># 75 unidades LSTM en la segunda capa</span>
<span class="n">dropout_layer</span> <span class="o">=</span> <span class="n">Dropout</span><span class="p">(</span><span class="mf">0.4</span><span class="p">)(</span><span class="n">lstm_layer2</span><span class="p">)</span>  <span class="c1"># Dropout de 0.4</span>
<span class="n">output_layer</span> <span class="o">=</span> <span class="n">Dense</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)(</span><span class="n">dropout_layer</span><span class="p">)</span>

<span class="c1"># Compilar el modelo con el optimizador adam</span>
<span class="n">ts_model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">inputs</span><span class="o">=</span><span class="n">input_layer</span><span class="p">,</span> <span class="n">outputs</span><span class="o">=</span><span class="n">output_layer</span><span class="p">)</span>
<span class="n">ts_model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">optimizer</span><span class="o">=</span><span class="s1">&#39;adam&#39;</span><span class="p">)</span>

<span class="c1"># Resumen del modelo</span>
<span class="n">ts_model</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>

<span class="c1"># Paso 4: Entrenamiento del modelo con Early Stopping</span>
<span class="n">save_weights_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">,</span> <span class="s1">&#39;PizzaSales_LSTM_weights.</span><span class="si">{epoch:02d}</span><span class="s1">-</span><span class="si">{val_loss:.4f}</span><span class="s1">.keras&#39;</span><span class="p">)</span>
<span class="n">save_best</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span><span class="n">save_weights_at</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">save_best_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">early_stopping</span> <span class="o">=</span> <span class="n">EarlyStopping</span><span class="p">(</span><span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">restore_best_weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Entrenamiento con batch_size ajustado a 5</span>
<span class="n">history_pizza_LSTM</span> <span class="o">=</span> <span class="n">ts_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  
                                  <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">save_best</span><span class="p">,</span> <span class="n">early_stopping</span><span class="p">],</span> <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">X_val</span><span class="p">,</span> <span class="n">y_val</span><span class="p">),</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Paso 5: Evaluar el mejor modelo</span>
<span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;PizzaSales_LSTM_weights\.(\d+)-([\d\.]+)\.keras&quot;</span>
<span class="n">best_val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
<span class="n">best_model_file</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
        <span class="n">epoch</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">val_loss</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">val_loss</span> <span class="o">&lt;</span> <span class="n">best_val_loss</span><span class="p">:</span>
            <span class="n">best_val_loss</span> <span class="o">=</span> <span class="n">val_loss</span>
            <span class="n">best_model_file</span> <span class="o">=</span> <span class="n">file</span>

<span class="k">if</span> <span class="n">best_model_file</span><span class="p">:</span>
    <span class="n">best_model_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;keras_models&#39;</span><span class="p">,</span> <span class="n">best_model_file</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cargando el mejor modelo: </span><span class="si">{</span><span class="n">best_model_file</span><span class="si">}</span><span class="s2"> con val_loss: </span><span class="si">{</span><span class="n">best_val_loss</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">best_model</span> <span class="o">=</span> <span class="n">load_model</span><span class="p">(</span><span class="n">best_model_path</span><span class="p">)</span>

<span class="c1"># Paso 6: Predicci칩n y evaluaci칩n</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val</span><span class="p">)</span>
<span class="n">pred_sales</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">inverse_transform</span><span class="p">(</span><span class="n">preds</span><span class="p">)</span>
<span class="n">pred_sales</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">pred_sales</span><span class="p">)</span>

<span class="c1"># Definir el rango correcto para las ventas reales (valores reales de la validaci칩n)</span>
<span class="n">real_sales_val</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">][</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span><span class="p">:</span><span class="n">train_size</span> <span class="o">+</span> <span class="mi">7</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_val</span><span class="p">)]</span>

<span class="c1"># Comprobar si las longitudes coinciden antes del c치lculo de MAE</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de predicciones: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pred_sales</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Longitud de valores reales: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Aseg칰rate de que las longitudes coinciden</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mae</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Calcular RMSE</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">rmse</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Calcular MAPE</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">real_sales_val</span> <span class="o">-</span> <span class="n">pred_sales</span><span class="p">)</span> <span class="o">/</span> <span class="n">real_sales_val</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MAPE for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mape</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;%&#39;</span><span class="p">)</span>

<span class="c1"># Calcular R</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">real_sales_val</span><span class="p">,</span> <span class="n">pred_sales</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R for the validation set:&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r2</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="c1"># Visualizaci칩n</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">real_sales_val</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="n">pred_sales</span><span class="p">[:</span><span class="mi">50</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="s1">&#39;Predicted&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Actual vs Predicted Pizza Sales&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Quantity&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Index&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold">Model: "functional_200"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較
較<span style="font-weight: bold"> Layer (type)                    </span>較<span style="font-weight: bold"> Output Shape           </span>較<span style="font-weight: bold">       Param # </span>較
較뫡대較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較轎較較較較較較較較較較較較較較較較較較較較較較較較轎較較較較較較較較較較較較較較較較
較 input_layer_54 (<span style="color: #0087ff; text-decoration-color: #0087ff">InputLayer</span>)     較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">7</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)           較             <span style="color: #00af00; text-decoration-color: #00af00">0</span> 較
較럭較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較
較 bidirectional (<span style="color: #0087ff; text-decoration-color: #0087ff">Bidirectional</span>)   較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">7</span>, <span style="color: #00af00; text-decoration-color: #00af00">150</span>)         較        <span style="color: #00af00; text-decoration-color: #00af00">46,200</span> 較
較럭較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較
較 lstm_105 (<span style="color: #0087ff; text-decoration-color: #0087ff">LSTM</span>)                 較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">75</span>)             較        <span style="color: #00af00; text-decoration-color: #00af00">67,800</span> 較
較럭較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較
較 dropout_44 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dropout</span>)            較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">75</span>)             較             <span style="color: #00af00; text-decoration-color: #00af00">0</span> 較
較럭較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較較較較較較較較較較쩍較較較較較較較較較較較較較較較
較 dense_60 (<span style="color: #0087ff; text-decoration-color: #0087ff">Dense</span>)                較 (<span style="color: #00d7ff; text-decoration-color: #00d7ff">None</span>, <span style="color: #00af00; text-decoration-color: #00af00">1</span>)              較            <span style="color: #00af00; text-decoration-color: #00af00">76</span> 較
較덕較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較較억較較較較較較較較較較較較較較較較較較較較較較較較억較較較較較較較較較較較較較較較
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Total params: </span><span style="color: #00af00; text-decoration-color: #00af00">114,076</span> (445.61 KB)
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">114,076</span> (445.61 KB)
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace"><span style="font-weight: bold"> Non-trainable params: </span><span style="color: #00af00; text-decoration-color: #00af00">0</span> (0.00 B)
</pre>
</div><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Epoch 1/50
56/56 - 9s - 163ms/step - loss: 0.1122 - val_loss: 0.1221
Epoch 2/50
56/56 - 2s - 41ms/step - loss: 0.1023 - val_loss: 0.1138
Epoch 3/50
56/56 - 3s - 45ms/step - loss: 0.0970 - val_loss: 0.1184
Epoch 4/50
56/56 - 1s - 19ms/step - loss: 0.0962 - val_loss: 0.1166
Epoch 5/50
56/56 - 2s - 31ms/step - loss: 0.0969 - val_loss: 0.1156
Epoch 6/50
56/56 - 2s - 34ms/step - loss: 0.0968 - val_loss: 0.1124
Epoch 7/50
56/56 - 2s - 42ms/step - loss: 0.0960 - val_loss: 0.1186
Epoch 8/50
56/56 - 2s - 32ms/step - loss: 0.0950 - val_loss: 0.1172
Epoch 9/50
56/56 - 3s - 45ms/step - loss: 0.0923 - val_loss: 0.1119
Epoch 10/50
56/56 - 1s - 18ms/step - loss: 0.0949 - val_loss: 0.1128
Epoch 11/50
56/56 - 2s - 35ms/step - loss: 0.0944 - val_loss: 0.1127
Epoch 12/50
56/56 - 3s - 47ms/step - loss: 0.0973 - val_loss: 0.1114
Epoch 13/50
56/56 - 3s - 47ms/step - loss: 0.0910 - val_loss: 0.1125
Epoch 14/50
56/56 - 1s - 25ms/step - loss: 0.0888 - val_loss: 0.1115
Epoch 15/50
56/56 - 3s - 50ms/step - loss: 0.0941 - val_loss: 0.1103
Epoch 16/50
56/56 - 2s - 30ms/step - loss: 0.0906 - val_loss: 0.1104
Epoch 17/50
56/56 - 3s - 47ms/step - loss: 0.0896 - val_loss: 0.1113
Epoch 18/50
56/56 - 1s - 20ms/step - loss: 0.0888 - val_loss: 0.1169
Epoch 19/50
56/56 - 2s - 30ms/step - loss: 0.0900 - val_loss: 0.1106
Epoch 20/50
56/56 - 2s - 28ms/step - loss: 0.0904 - val_loss: 0.1122
Cargando el mejor modelo: PizzaSales_LSTM_weights.15-0.1103.keras con val_loss: 0.1103
<span class=" -Color -Color-Bold">3/3</span> <span class=" -Color -Color-Green">較較較較較較較較較較較較較較較較較較較較</span> <span class=" -Color -Color-Bold">2s</span> 585ms/step
Longitud de predicciones: 71
Longitud de valores reales: 71
MAE for the validation set: 20.8465
RMSE for the validation set: 31.8997
MAPE for the validation set: 14.87 %
R for the validation set: -0.0354
</pre></div>
</div>
<img alt="_images/2d027268d039032f779973ad3275b2488f54189cd2c3a78ccb4516042b02728d.png" src="_images/2d027268d039032f779973ad3275b2488f54189cd2c3a78ccb4516042b02728d.png" />
</div>
</div>
<p>Los resultados del modelo LSTM para la predicci칩n de ventas de pizza muestran 치reas de mejora. El Error Absoluto Medio (MAE) es de <strong>20.8465</strong>, lo que indica que, en promedio, las predicciones se desv칤an en aproximadamente 21 ventas. El Ra칤z del Error Cuadr치tico Medio (RMSE) de <strong>31.8997</strong> sugiere que el modelo tiene variaciones significativas en sus predicciones, penalizando m치s los errores grandes.</p>
<p>El Porcentaje de Error Absoluto Medio (MAPE) es de <strong>14.87%</strong>, lo que puede considerarse aceptable en algunos contextos, pero a칰n muestra margen de mejora. Sin embargo, el R de <strong>-0.0354</strong> indica que el modelo no se ajusta bien a los datos, sugiriendo que su rendimiento es inferior a simplemente utilizar la media de los valores reales.</p>
<p>En resumen, el modelo LSTM presenta un desempe침o que requiere atenci칩n. Se sugiere optimizar hiperpar치metros, incluir m치s datos relevantes y explorar otras arquitecturas para mejorar la precisi칩n de las predicciones.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="modelo-original">
<h1>Modelo original<a class="headerlink" href="#modelo-original" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">r2_score</span>

<span class="c1"># Leer el archivo Excel</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\Davidlizcanom2486\Documents\Timeseries\jbook_ts202330\docs\PizzaSales.xlsx&quot;</span><span class="p">)</span>

<span class="c1"># Convertir la columna de fecha</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;order_date&#39;</span><span class="p">],</span> <span class="n">dayfirst</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Agrupar por fecha y sumar la cantidad diaria (Quantity)</span>
<span class="n">df_grouped_quantity_daily</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">total_quantity</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;quantity&#39;</span><span class="p">,</span> <span class="s1">&#39;sum&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Establecer la fecha como 칤ndice</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;order_date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Crear caracter칤sticas basadas en el tiempo (rezagos y media m칩vil)</span>
<span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>  <span class="c1"># Rezagos de 1 a 7 d칤as</span>
    <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;lag_</span><span class="si">{</span><span class="n">lag</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">lag</span><span class="p">)</span>

<span class="c1"># Media m칩vil</span>
<span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;moving_average&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># Eliminar filas con valores nulos</span>
<span class="n">df_grouped_quantity_daily</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Dividir los datos en conjunto de entrenamiento y prueba</span>
<span class="n">train_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[:</span><span class="o">-</span><span class="mi">55</span><span class="p">]</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">df_grouped_quantity_daily</span><span class="p">[</span><span class="o">-</span><span class="mi">55</span><span class="p">:]</span>

<span class="c1"># Definir las caracter칤sticas (X) y la variable objetivo (y)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">]</span>

<span class="c1"># Ajustar el modelo XGBoost con los mejores par치metros</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>

<span class="n">best_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;min_child_weight&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">}</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;reg:squarederror&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">best_params</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Realizar predicciones</span>
<span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Graficar los resultados</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">train_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos de Entrenamiento&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;total_quantity&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Datos Reales (Conjunto de Prueba)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">predictions</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Predicciones&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Predicciones XGBoost vs Datos Reales - Ventas Diarias de Pizza&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Fecha&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Total Quantity (Escala Original)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Calcular m칠tricas de error</span>
<span class="n">mape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">y_test</span> <span class="o">-</span> <span class="n">predictions</span><span class="p">)</span> <span class="o">/</span> <span class="n">y_test</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">mae</span> <span class="o">=</span> <span class="n">mean_absolute_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">))</span>
<span class="n">mse</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predictions</span><span class="p">)</span>

<span class="c1"># Imprimir los resultados</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAPE: </span><span class="si">{</span><span class="n">mape</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MAE: </span><span class="si">{</span><span class="n">mae</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;RMSE: </span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;MSE: </span><span class="si">{</span><span class="n">mse</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;R: </span><span class="si">{</span><span class="n">r2</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5e91d4d6b39c744c829811eea84a3738111eb33d4326688d7538b31f2bf6a432.png" src="_images/5e91d4d6b39c744c829811eea84a3738111eb33d4326688d7538b31f2bf6a432.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAPE: 16.1142%
MAE: 19.5215
RMSE: 28.3771
MSE: 805.2605
R: 0.3053
</pre></div>
</div>
</div>
</div>
<p>El modelo <strong>XGBoost</strong> aplicado a la predicci칩n de ventas diarias de pizza ha demostrado ser un enfoque eficaz, obteniendo resultados positivos que lo destacan como una herramienta 칰til para la toma de decisiones. A continuaci칩n, se detallan los resultados obtenidos junto con las razones por las cuales este modelo es beneficioso.</p>
<section id="resultados-del-modelo">
<h2>Resultados del Modelo<a class="headerlink" href="#resultados-del-modelo" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>MAPE</strong>: <strong>16.11%</strong><br />
Este porcentaje indica que, en promedio, las predicciones del modelo se desv칤an un 16.11% de los valores reales. Este nivel de precisi칩n es aceptable para la industria de alimentos, donde las variaciones en la demanda pueden ser influenciadas por m칰ltiples factores.</p></li>
<li><p><strong>MAE</strong>: <strong>19.5215</strong><br />
La media del error absoluto de aproximadamente 19.52 unidades sugiere que el modelo est치 haciendo predicciones que, en promedio, se desv칤an en menos de 20 ventas de las cifras reales. Esto es crucial para planificar la producci칩n y optimizar el inventario.</p></li>
<li><p><strong>RMSE</strong>: <strong>28.3771</strong><br />
Con un error cuadr치tico medio de 28.38, el modelo resalta que, aunque hay algunos errores m치s significativos, el rendimiento general es razonable. Este indicador es especialmente 칰til en el contexto de la gesti칩n de recursos, ya que permite anticipar posibles desajustes en las operaciones.</p></li>
<li><p><strong>R</strong>: <strong>0.3053</strong><br />
Este valor sugiere que el modelo explica aproximadamente el 30.53% de la variabilidad en las ventas diarias. Aunque no es extremadamente alto, indica que el modelo capta algunas tendencias y patrones en los datos, lo que puede guiar a los gerentes en la toma de decisiones basadas en tendencias pasadas.</p></li>
</ul>
</section>
<section id="beneficios-del-modelo">
<h2>Beneficios del Modelo<a class="headerlink" href="#beneficios-del-modelo" title="Link to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><strong>Adaptabilidad a los Datos</strong>: XGBoost es un modelo que se adapta bien a conjuntos de datos con caracter칤sticas no lineales, lo que es com칰n en las series temporales de ventas. Esto permite capturar patrones estacionales y tendencias que otros modelos m치s simples podr칤an pasar por alto.</p></li>
<li><p><strong>Optimizaci칩n de Recursos</strong>: Con resultados que muestran un error relativamente bajo, el modelo permite una mejor planificaci칩n de la producci칩n y gesti칩n del inventario. Al predecir la demanda de manera m치s precisa, se pueden reducir costos asociados a la sobreproducci칩n o al desabastecimiento.</p></li>
<li><p><strong>Facilidad de Interpretaci칩n</strong>: XGBoost ofrece caracter칤sticas que permiten entender qu칠 variables son m치s influyentes en las predicciones. Esto proporciona a los gerentes informaci칩n valiosa para ajustar estrategias de marketing y promociones basadas en datos hist칩ricos.</p></li>
<li><p><strong>Escalabilidad</strong>: Dado que el modelo se basa en 치rboles de decisi칩n, es escalable y puede manejar grandes vol칰menes de datos sin un deterioro significativo en el rendimiento, lo que es fundamental en el entorno din치mico de las ventas.</p></li>
</ol>
</section>
<section id="conclusiones">
<h2>Conclusiones<a class="headerlink" href="#conclusiones" title="Link to this heading">#</a></h2>
<p>En resumen, el modelo XGBoost no solo proporciona predicciones relativamente precisas, sino que tambi칠n ofrece beneficios significativos para la gesti칩n operativa. Con un rendimiento que refleja una comprensi칩n adecuada de las tendencias en las ventas, este modelo puede servir como base para futuras mejoras y refinamientos, contribuyendo a la optimizaci칩n de las operaciones y a la satisfacci칩n del cliente.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="eleccion-mejor-modelo">
<h1>Eleccion mejor modelo<a class="headerlink" href="#eleccion-mejor-modelo" title="Link to this heading">#</a></h1>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Modelo</p></th>
<th class="head"><p>MAE</p></th>
<th class="head"><p>RMSE</p></th>
<th class="head"><p>MSE</p></th>
<th class="head"><p>MAPE</p></th>
<th class="head"><p>R</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>SARIMA</p></td>
<td><p>21.08</p></td>
<td><p>31.85</p></td>
<td><p>1014.74</p></td>
<td><p>nan%</p></td>
<td><p>0.12</p></td>
</tr>
<tr class="row-odd"><td><p>Suavizado Exponencial</p></td>
<td><p>22.04</p></td>
<td><p>33.61</p></td>
<td><p>1129.33</p></td>
<td><p>16.59%</p></td>
<td><p>0.00</p></td>
</tr>
<tr class="row-even"><td><p>Holt-Winters</p></td>
<td><p>20.63</p></td>
<td><p>31.62</p></td>
<td><p>999.56</p></td>
<td><p>15.96%</p></td>
<td><p>0.13</p></td>
</tr>
<tr class="row-odd"><td><p>Red Neuronal Recurrente</p></td>
<td><p>23.60</p></td>
<td><p>33.65</p></td>
<td><p>-</p></td>
<td><p>-</p></td>
<td><p>0.22</p></td>
</tr>
<tr class="row-even"><td><p>MLP</p></td>
<td><p>15.88</p></td>
<td><p>22.63</p></td>
<td><p>-</p></td>
<td><p>13.80%</p></td>
<td><p>0.13</p></td>
</tr>
<tr class="row-odd"><td><p>LSTM</p></td>
<td><p>20.85</p></td>
<td><p>31.90</p></td>
<td><p>-</p></td>
<td><p>14.87%</p></td>
<td><p>-0.04</p></td>
</tr>
<tr class="row-even"><td><p>XGBoost</p></td>
<td><p>19.52</p></td>
<td><p>28.38</p></td>
<td><p>805.26</p></td>
<td><p>16.11%</p></td>
<td><p>0.31</p></td>
</tr>
</tbody>
</table>
</div>
<p>El modelo XGBoost se destaca como la mejor opci칩n para predecir las ventas diarias de pizza en comparaci칩n con otros modelos, seg칰n los resultados presentados en la tabla. En primer lugar, XGBoost presenta un R de <strong>0.31</strong>, lo que indica que el modelo explica aproximadamente el 31% de la variabilidad de los datos. Este es un resultado superior en comparaci칩n con otros modelos, como el LSTM (-0.04) y el suavizado exponencial (0.00), lo que sugiere que XGBoost captura mejor las relaciones entre las variables.</p>
<p>Adem치s, con un MAE de <strong>19.52</strong> y un RMSE de <strong>28.38</strong>, el modelo muestra errores de predicci칩n m치s bajos en comparaci칩n con modelos como el suavizado exponencial (MAE de 22.04, RMSE de 33.61) y el LSTM (MAE de 20.85, RMSE de 31.90). Esto indica que las predicciones del XGBoost son m치s cercanas a los valores reales. Su MAPE de <strong>16.11%</strong> tambi칠n es relativamente bajo en comparaci칩n con el suavizado exponencial (16.59%) y el LSTM (14.87%), lo que implica que la precisi칩n de las predicciones es s칩lida en t칠rminos relativos.</p>
<p>Otra ventaja de XGBoost es su eficacia en el manejo de caracter칤sticas que pueden no tener una relaci칩n lineal con la variable objetivo. En este caso, las caracter칤sticas temporales, como los rezagos y la media m칩vil, pueden ser complejas y no lineales, lo que hace que XGBoost, al ser un modelo de 치rbol, sea muy adecuado para esta tarea. Adem치s, es conocido por su eficiencia computacional y por evitar el sobreajuste gracias a su regularizaci칩n, lo que permite obtener un modelo robusto sin necesidad de un gran ajuste de hiperpar치metros.</p>
<p>En resumen, el XGBoost se presenta como la mejor opci칩n para nuestro problema de predicci칩n de ventas de pizza, gracias a su capacidad para capturar relaciones complejas en los datos y su rendimiento superior en las m칠tricas de error, lo que sugiere que ofrece predicciones m치s precisas y confiables en comparaci칩n con otros modelos evaluados.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="markdown.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Markdown Files</p>
      </div>
    </a>
    <a class="right-next"
       href="markdown-notebooks.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebooks with MyST Markdown</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">游늵 Entrega del Trabajo Final</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jeffry-llerena-y-david-lizcano">Jeffry Llerena y David Lizcano</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#asignatura-series-de-tiempo">Asignatura: Series de Tiempo</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#maestria-en-analitica-de-datos">Maestr칤a en Anal칤tica de Datos</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-prediccion-de-las-series-temporales-de-las-ventas-de-pizza">An치lisis y Predicci칩n de las Series Temporales de las Ventas de Pizza</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-y-modelizacion-de-ventas-diarias-de-pizzas">An치lisis y Modelizaci칩n de Ventas Diarias de Pizzas</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduccion">Introducci칩n</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estructura-del-proyecto">Estructura del Proyecto</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-datos-eda">1. An치lisis Exploratorio de Datos (EDA)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark-20">2. Modelos Benchmark (20%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exposicion-10">3. Exposici칩n (10%)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original-60">4. Modelo Original (60%)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-exploratorio-de-los-datos">Analisis exploratorio de los datos</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-acf"><strong>An치lisis de ACF:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analisis-de-pacf"><strong>An치lisis de PACF:</strong></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusion-final"><strong>Conclusi칩n Final:</strong></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelos-benchmark">Modelos benchmark</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-sarima">Modelo Sarima</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-de-suavizado-exponencial">Modelo de suavizado exponencial</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-holtwinters">Modelo Holtwinters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-red-neuronal-recuerrente">Modelo red neuronal recuerrente</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-mlp">Modelo MLP</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-lstm">Modelo LSTM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#modelo-original">Modelo original</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#resultados-del-modelo">Resultados del Modelo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#beneficios-del-modelo">Beneficios del Modelo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conclusiones">Conclusiones</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#eleccion-mejor-modelo">Eleccion mejor modelo</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book Community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      춸 Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>